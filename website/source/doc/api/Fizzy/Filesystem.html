<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Module: Fizzy::Filesystem
  
    &mdash; fizzy documentation
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "Fizzy::Filesystem";
  relpath = '../';
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../_index.html">Index (F)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../Fizzy.html" title="Fizzy (module)">Fizzy</a></span></span>
     &raquo; 
    <span class="title">Filesystem</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Module: Fizzy::Filesystem
  
  
  
</h1>
<div class="box_info">
  

  
  
  
  
  <dl>
      <dt>Includes:</dt>
      <dd><span class='object_link'><a href="Execution.html" title="Fizzy::Execution (module)">Execution</a></span>, <span class='object_link'><a href="IO.html" title="Fizzy::IO (module)">IO</a></span></dd>
  </dl>
  
  

  
  <dl>
    <dt>Included in:</dt>
    <dd><span class='object_link'><a href="BaseCommand.html" title="Fizzy::BaseCommand (class)">BaseCommand</a></span>, <span class='object_link'><a href="Sync/Git.html" title="Fizzy::Sync::Git (class)">Sync::Git</a></span>, <span class='object_link'><a href="Vars/Setup.html" title="Fizzy::Vars::Setup (class)">Vars::Setup</a></span></dd>
  </dl>
  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>src/core/filesystem.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>Utilities to interact with the filesystem.</p>


  </div>
</div>
<div class="tags">
  

</div>






  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#existing_dir-instance_method" title="#existing_dir (instance method)">#<strong>existing_dir</strong>(path, writable: true)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Check if the provided <code>path</code> is an existing directory.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#find_yaml_path-instance_method" title="#find_yaml_path (instance method)">#<strong>find_yaml_path</strong>(path)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Find a YAML file prefixed by <code>path</code> (guess extension name).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#prepare_storage-instance_method" title="#prepare_storage (instance method)">#<strong>prepare_storage</strong>(root_path, valid_meta: true, valid_cfg: true, valid_inst: true, meta_name: nil, cur_cfg_name: nil, cur_inst_name: nil)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Return an object (<code>OpenStruct</code>), which contains all of the well-known paths.</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="Execution.html" title="Fizzy::Execution (module)">Execution</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Execution.html#exec_cmd-instance_method" title="Fizzy::Execution#exec_cmd (method)">#exec_cmd</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="IO.html" title="Fizzy::IO (module)">IO</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="IO.html#ask-instance_method" title="Fizzy::IO#ask (method)">#ask</a></span>, <span class='object_link'><a href="IO.html#debug-instance_method" title="Fizzy::IO#debug (method)">#debug</a></span>, <span class='object_link'><a href="IO.html#error-instance_method" title="Fizzy::IO#error (method)">#error</a></span>, <span class='object_link'><a href="IO.html#info-instance_method" title="Fizzy::IO#info (method)">#info</a></span>, <span class='object_link'><a href="IO.html#tell-instance_method" title="Fizzy::IO#tell (method)">#tell</a></span>, <span class='object_link'><a href="IO.html#warning-instance_method" title="Fizzy::IO#warning (method)">#warning</a></span>, <span class='object_link'><a href="IO.html#%E2%9C%94-instance_method" title="Fizzy::IO#✔ (method)">#✔</a></span>, <span class='object_link'><a href="IO.html#%E2%9C%98-instance_method" title="Fizzy::IO#✘ (method)">#✘</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="ANSIColors.html" title="Fizzy::ANSIColors (module)">ANSIColors</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="ANSIColors.html#bg_colors-class_method" title="Fizzy::ANSIColors.bg_colors (method)">bg_colors</a></span>, <span class='object_link'><a href="ANSIColors.html#clear_colors-class_method" title="Fizzy::ANSIColors.clear_colors (method)">clear_colors</a></span>, <span class='object_link'><a href="ANSIColors.html#colorize-instance_method" title="Fizzy::ANSIColors#colorize (method)">#colorize</a></span>, <span class='object_link'><a href="ANSIColors.html#colorize-class_method" title="Fizzy::ANSIColors.colorize (method)">colorize</a></span>, <span class='object_link'><a href="ANSIColors.html#default_close_tag_regexp-class_method" title="Fizzy::ANSIColors.default_close_tag_regexp (method)">default_close_tag_regexp</a></span>, <span class='object_link'><a href="ANSIColors.html#default_open_tag_regexp-class_method" title="Fizzy::ANSIColors.default_open_tag_regexp (method)">default_open_tag_regexp</a></span>, <span class='object_link'><a href="ANSIColors.html#fg_colors-class_method" title="Fizzy::ANSIColors.fg_colors (method)">fg_colors</a></span>, <span class='object_link'><a href="ANSIColors.html#spec_to_color-class_method" title="Fizzy::ANSIColors.spec_to_color (method)">spec_to_color</a></span></p>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="existing_dir-instance_method">
  
    #<strong>existing_dir</strong>(path, writable: true)  &#x21d2; <tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Check if the provided <code>path</code> is an existing directory.</p>

<p>If <code>writable</code> is true, also check if <code>path</code> points to a writable
directory.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


26
27
28
29
30</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'src/core/filesystem.rb', line 26</span>

<span class='kw'>def</span> <span class='id identifier rubyid_existing_dir'>existing_dir</span><span class='lparen'>(</span><span class='id identifier rubyid_path'>path</span><span class='comma'>,</span> <span class='label'>writable:</span> <span class='kw'>true</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_dir_path'>dir_path</span> <span class='op'>=</span> <span class='id identifier rubyid_path'>path</span>
  <span class='id identifier rubyid_dir_path'>dir_path</span> <span class='op'>=</span> <span class='id identifier rubyid_dir_path'>dir_path</span><span class='period'>.</span><span class='id identifier rubyid_dirname'>dirname</span> <span class='kw'>until</span> <span class='id identifier rubyid_dir_path'>dir_path</span><span class='period'>.</span><span class='id identifier rubyid_directory?'>directory?</span>
  <span class='lparen'>(</span><span class='id identifier rubyid_writable'>writable</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_dir_path'>dir_path</span><span class='period'>.</span><span class='id identifier rubyid_writable?'>writable?</span><span class='rparen'>)</span> <span class='op'>?</span> <span class='kw'>nil</span> <span class='op'>:</span> <span class='id identifier rubyid_dir_path'>dir_path</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="find_yaml_path-instance_method">
  
    #<strong>find_yaml_path</strong>(path)  &#x21d2; <tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Find a YAML file prefixed by <code>path</code> (guess extension name).</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


10
11
12
13
14
15
16
17
18
19</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'src/core/filesystem.rb', line 10</span>

<span class='kw'>def</span> <span class='id identifier rubyid_find_yaml_path'>find_yaml_path</span><span class='lparen'>(</span><span class='id identifier rubyid_path'>path</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_path'>path</span><span class='period'>.</span><span class='id identifier rubyid_file?'>file?</span>
    <span class='id identifier rubyid_path'>path</span>
  <span class='kw'>else</span>
    <span class='qwords_beg'>%w(</span><span class='tstring_content'>yml</span><span class='words_sep'> </span><span class='tstring_content'>yaml</span><span class='words_sep'>)</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ext'>ext</span><span class='op'>|</span>
      <span class='id identifier rubyid_p'>p</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../Pathname.html" title="Pathname (class)">Pathname</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_path'>path</span><span class='embexpr_end'>}</span><span class='tstring_content'>.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ext'>ext</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_p'>p</span> <span class='kw'>if</span> <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_file?'>file?</span>
    <span class='kw'>end</span><span class='period'>.</span><span class='id identifier rubyid_compact'>compact</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="prepare_storage-instance_method">
  
    #<strong>prepare_storage</strong>(root_path, valid_meta: true, valid_cfg: true, valid_inst: true, meta_name: nil, cur_cfg_name: nil, cur_inst_name: nil)  &#x21d2; <tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Return an object (<code>OpenStruct</code>), which contains all of the well-known
paths.</p>

<p>Before adding a path, some validations are executed to ensure that path
points to a correct thing.</p>

<p>You can skip some validations and filling some paths:
- <code>valid_cfg</code>:
  - If <code>false</code> don’t validate and fill paths related to the configuration.
  - If <code>readonly</code>, don’t validate writability for configuration.
- <code>valid_inst</code>:
  - If <code>false</code> don’t validate and fill paths related to the configuration
    instances.
  - If <code>true</code>, be sure to provide the argument <code>cur_inst_name</code>, which
    should contain the name of the current instance (the instance that
    should be used).
  - If <code>readonly</code>, don’t validate writability for instance.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'src/core/filesystem.rb', line 50</span>

<span class='kw'>def</span> <span class='id identifier rubyid_prepare_storage'>prepare_storage</span><span class='lparen'>(</span><span class='id identifier rubyid_root_path'>root_path</span><span class='comma'>,</span>
                    <span class='label'>valid_meta:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>valid_cfg:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>valid_inst:</span> <span class='kw'>true</span><span class='comma'>,</span>
                    <span class='label'>meta_name:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>cur_cfg_name:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>cur_inst_name:</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_root_path'>root_path</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../Pathname.html" title="Pathname (class)">Pathname</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_root_path'>root_path</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_expand_variables'><span class='object_link'><a href="../Pathname.html#expand_variables-instance_method" title="Pathname#expand_variables (method)">expand_variables</a></span></span><span class='period'>.</span><span class='id identifier rubyid_expand_path'>expand_path</span>

  <span class='comment'># Paths based on internal conventions.
</span>  <span class='id identifier rubyid_parent_path'>parent_path</span> <span class='op'>=</span> <span class='id identifier rubyid_root_path'>root_path</span><span class='period'>.</span><span class='id identifier rubyid_dirname'>dirname</span>

  <span class='id identifier rubyid_cfg_path'>cfg_path</span> <span class='op'>=</span> <span class='id identifier rubyid_root_path'>root_path</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>cfg</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_cur_cfg_path'>cur_cfg_path</span> <span class='op'>=</span> <span class='id identifier rubyid_cfg_path'>cfg_path</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='id identifier rubyid_cur_cfg_name'>cur_cfg_name</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_cur_cfg_name'>cur_cfg_name</span>
  <span class='id identifier rubyid_cur_cfg_vars_path'>cur_cfg_vars_path</span> <span class='op'>=</span> <span class='id identifier rubyid_cur_cfg_path'>cur_cfg_path</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>vars</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_cur_cfg_path'>cur_cfg_path</span>
  <span class='id identifier rubyid_cur_cfg_elems_path'>cur_cfg_elems_path</span> <span class='op'>=</span> <span class='id identifier rubyid_cur_cfg_path'>cur_cfg_path</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>elems</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_cur_cfg_path'>cur_cfg_path</span>
  <span class='id identifier rubyid_cur_cfg_meta_path'>cur_cfg_meta_path</span> <span class='op'>=</span> <span class='id identifier rubyid_find_yaml_path'>find_yaml_path</span><span class='lparen'>(</span><span class='id identifier rubyid_cur_cfg_path'>cur_cfg_path</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='id identifier rubyid_meta_name'>meta_name</span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_cur_cfg_path'>cur_cfg_path</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_meta_name'>meta_name</span>

  <span class='id identifier rubyid_inst_path'>inst_path</span> <span class='op'>=</span> <span class='id identifier rubyid_root_path'>root_path</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>inst</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_cur_inst_path'>cur_inst_path</span> <span class='op'>=</span> <span class='id identifier rubyid_inst_path'>inst_path</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='id identifier rubyid_cur_inst_name'>cur_inst_name</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_cur_inst_name'>cur_inst_name</span>
  <span class='id identifier rubyid_cur_inst_vars_path'>cur_inst_vars_path</span> <span class='op'>=</span> <span class='id identifier rubyid_cur_inst_path'>cur_inst_path</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>vars</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_cur_inst_path'>cur_inst_path</span>
  <span class='id identifier rubyid_cur_inst_elems_path'>cur_inst_elems_path</span> <span class='op'>=</span> <span class='id identifier rubyid_cur_inst_path'>cur_inst_path</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>elems</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_cur_inst_path'>cur_inst_path</span>
  <span class='id identifier rubyid_cur_inst_meta_path'>cur_inst_meta_path</span> <span class='op'>=</span> <span class='id identifier rubyid_find_yaml_path'>find_yaml_path</span><span class='lparen'>(</span><span class='id identifier rubyid_cur_inst_path'>cur_inst_path</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='id identifier rubyid_meta_name'>meta_name</span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_cur_inst_path'>cur_inst_path</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_meta_name'>meta_name</span>

  <span class='comment'># Validate `root_path`.
</span>  <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_root_path'>root_path</span><span class='period'>.</span><span class='id identifier rubyid_directory?'>directory?</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_parent_path'>parent_path</span><span class='period'>.</span><span class='id identifier rubyid_writable?'>writable?</span>
    <span class='id identifier rubyid_error'>error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Cannot create directory: `</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_root_path'>root_path</span><span class='embexpr_end'>}</span><span class='tstring_content'>`.</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_root_path'>root_path</span><span class='period'>.</span><span class='id identifier rubyid_file?'>file?</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_ask'>ask</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>`</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_root_path'>root_path</span><span class='embexpr_end'>}</span><span class='tstring_content'>` already exists but is a regular file. Remove</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_exec_cmd'>exec_cmd</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rm </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_root_path'>root_path</span><span class='period'>.</span><span class='id identifier rubyid_shell_escape'>shell_escape</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
               <span class='label'>as_su:</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_owned?'>owned?</span><span class='lparen'>(</span><span class='id identifier rubyid_root_path'>root_path</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_error'>error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>File `</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_root_path'>root_path</span><span class='embexpr_end'>}</span><span class='tstring_content'>` already exists but is needed as fizzy </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
            <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>root directory. Aborting.</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># XXX This check is for preventing errors when we don&#39;t want to create the
</span>  <span class='comment'>#     directory structure. Should we add a dedicate argument?
</span>  <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_valid_cfg'>valid_cfg</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_valid_inst'>valid_inst</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_root_path'>root_path</span><span class='period'>.</span><span class='id identifier rubyid_directory?'>directory?</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_root_path'>root_path</span><span class='period'>.</span><span class='id identifier rubyid_writable?'>writable?</span>
    <span class='id identifier rubyid_error'>error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>No write permissions in Fizzy storage at path `</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_root_path'>root_path</span><span class='embexpr_end'>}</span><span class='tstring_content'>`.</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_valid_cfg'>valid_cfg</span>
    <span class='kw'>unless</span> <span class='id identifier rubyid_root_path'>root_path</span><span class='period'>.</span><span class='id identifier rubyid_directory?'>directory?</span>
      <span class='id identifier rubyid_error'>error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>The Fizzy root directory `</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_root_path'>root_path</span><span class='embexpr_end'>}</span><span class='tstring_content'>` doesn&#39;t exist </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
            <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>(maybe you need to run: `fizzy cfg sync`).</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_cur_cfg_path'>cur_cfg_path</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>||</span> <span class='op'>!</span><span class='id identifier rubyid_cur_cfg_path'>cur_cfg_path</span><span class='period'>.</span><span class='id identifier rubyid_directory?'>directory?</span> <span class='op'>||</span> <span class='op'>!</span><span class='lparen'>(</span><span class='id identifier rubyid_valid_cfg'>valid_cfg</span> <span class='op'>==</span> <span class='symbol'>:readonly</span> <span class='op'>||</span> <span class='id identifier rubyid_cur_cfg_path'>cur_cfg_path</span><span class='period'>.</span><span class='id identifier rubyid_writable?'>writable?</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_error'>error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>The current configuration `</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cur_cfg_name'>cur_cfg_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>` is invalid: </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
            <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>it&#39;s not a valid directory.</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_valid_meta'>valid_meta</span> <span class='op'>&amp;&amp;</span> <span class='lparen'>(</span><span class='id identifier rubyid_cur_cfg_meta_path'>cur_cfg_meta_path</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>||</span> <span class='op'>!</span><span class='id identifier rubyid_cur_cfg_meta_path'>cur_cfg_meta_path</span><span class='period'>.</span><span class='id identifier rubyid_file?'>file?</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_error'>error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>The meta file path `</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cur_cfg_meta_path'>cur_cfg_meta_path</span><span class='embexpr_end'>}</span><span class='tstring_content'>` is invalid.</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_cur_cfg_vars_path'>cur_cfg_vars_path</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>||</span> <span class='op'>!</span><span class='id identifier rubyid_cur_cfg_vars_path'>cur_cfg_vars_path</span><span class='period'>.</span><span class='id identifier rubyid_directory?'>directory?</span>
      <span class='id identifier rubyid_error'>error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>The variables directory `</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cur_cfg_vars_path'>cur_cfg_vars_path</span><span class='embexpr_end'>}</span><span class='tstring_content'>` is invalid.</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_valid_inst'>valid_inst</span>
    <span class='kw'>unless</span> <span class='id identifier rubyid_root_path'>root_path</span><span class='period'>.</span><span class='id identifier rubyid_directory?'>directory?</span>
      <span class='id identifier rubyid_error'>error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>The Fizzy root directory `</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_root_path'>root_path</span><span class='embexpr_end'>}</span><span class='tstring_content'>` doesn&#39;t exist </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
            <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>(maybe you need to run: `fizzy cfg sync`).</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_cur_inst_path'>cur_inst_path</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>||</span> <span class='op'>!</span><span class='id identifier rubyid_cur_inst_path'>cur_inst_path</span><span class='period'>.</span><span class='id identifier rubyid_directory?'>directory?</span> <span class='op'>||</span> <span class='op'>!</span><span class='lparen'>(</span><span class='id identifier rubyid_valid_inst'>valid_inst</span> <span class='op'>==</span> <span class='symbol'>:readonly</span> <span class='op'>||</span> <span class='id identifier rubyid_cur_inst_path'>cur_inst_path</span><span class='period'>.</span><span class='id identifier rubyid_writable?'>writable?</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_error'>error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>The current instance `</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cur_inst_name'>cur_inst_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>` is invalid: it&#39;s </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
            <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>not a valid directory.</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_valid_meta'>valid_meta</span> <span class='op'>&amp;&amp;</span> <span class='lparen'>(</span><span class='id identifier rubyid_cur_inst_meta_path'>cur_inst_meta_path</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>||</span> <span class='op'>!</span><span class='id identifier rubyid_cur_inst_meta_path'>cur_inst_meta_path</span><span class='period'>.</span><span class='id identifier rubyid_file?'>file?</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_error'>error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>The meta file path `</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cur_inst_meta_path'>cur_inst_meta_path</span><span class='embexpr_end'>}</span><span class='tstring_content'>` is invalid.</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_cur_inst_vars_path'>cur_inst_vars_path</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>||</span> <span class='op'>!</span><span class='id identifier rubyid_cur_inst_vars_path'>cur_inst_vars_path</span><span class='period'>.</span><span class='id identifier rubyid_directory?'>directory?</span>
      <span class='id identifier rubyid_error'>error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>The variables directory `</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cur_inst_vars_path'>cur_inst_vars_path</span><span class='embexpr_end'>}</span><span class='tstring_content'>` is invalid.</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># Create non-existing internal directories.
</span>  <span class='const'>FileUtils</span><span class='period'>.</span><span class='id identifier rubyid_mkdir_p'>mkdir_p</span><span class='lparen'>(</span><span class='id identifier rubyid_root_path'>root_path</span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_root_path'>root_path</span><span class='period'>.</span><span class='id identifier rubyid_directory?'>directory?</span>
  <span class='lbracket'>[</span><span class='id identifier rubyid_cfg_path'>cfg_path</span><span class='comma'>,</span> <span class='id identifier rubyid_inst_path'>inst_path</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_dir_path'>dir_path</span><span class='op'>|</span>
    <span class='kw'>unless</span> <span class='id identifier rubyid_dir_path'>dir_path</span><span class='period'>.</span><span class='id identifier rubyid_directory?'>directory?</span>
      <span class='const'>FileUtils</span><span class='period'>.</span><span class='id identifier rubyid_mkdir_p'>mkdir_p</span><span class='lparen'>(</span><span class='id identifier rubyid_dir_path'>dir_path</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_exec_cmd'>exec_cmd</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>chmod a+w </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_dir_path'>dir_path</span><span class='period'>.</span><span class='id identifier rubyid_shell_escape'>shell_escape</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
               <span class='label'>as_su:</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_owned?'>owned?</span><span class='lparen'>(</span><span class='id identifier rubyid_dir_path'>dir_path</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_cur_inst_path'>cur_inst_path</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_cur_inst_path'>cur_inst_path</span><span class='period'>.</span><span class='id identifier rubyid_directory?'>directory?</span>
    <span class='const'>FileUtils</span><span class='period'>.</span><span class='id identifier rubyid_mkdir_p'>mkdir_p</span><span class='lparen'>(</span><span class='id identifier rubyid_cur_inst_path'>cur_inst_path</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># Return the known storage paths.
</span>  <span class='const'>OpenStruct</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
    <span class='label'>root:</span>          <span class='id identifier rubyid_root_path'>root_path</span><span class='comma'>,</span>
    <span class='label'>cfg:</span>           <span class='id identifier rubyid_cfg_path'>cfg_path</span><span class='comma'>,</span>
    <span class='label'>cur_cfg:</span>       <span class='id identifier rubyid_cur_cfg_path'>cur_cfg_path</span><span class='comma'>,</span>
    <span class='label'>cur_cfg_vars:</span>  <span class='id identifier rubyid_cur_cfg_vars_path'>cur_cfg_vars_path</span><span class='comma'>,</span>
    <span class='label'>cur_cfg_elems:</span> <span class='id identifier rubyid_cur_cfg_elems_path'>cur_cfg_elems_path</span><span class='comma'>,</span>
    <span class='label'>cur_cfg_meta:</span>  <span class='id identifier rubyid_cur_cfg_meta_path'>cur_cfg_meta_path</span><span class='comma'>,</span>
    <span class='label'>inst:</span>          <span class='id identifier rubyid_inst_path'>inst_path</span><span class='comma'>,</span>
    <span class='label'>cur_inst:</span>      <span class='id identifier rubyid_cur_inst_path'>cur_inst_path</span><span class='comma'>,</span>
    <span class='label'>cur_inst_vars:</span> <span class='id identifier rubyid_cur_inst_vars_path'>cur_inst_vars_path</span><span class='comma'>,</span>
    <span class='label'>cur_inst_elems:</span> <span class='id identifier rubyid_cur_inst_elems_path'>cur_inst_elems_path</span><span class='comma'>,</span>
    <span class='label'>cur_inst_meta:</span> <span class='id identifier rubyid_cur_inst_meta_path'>cur_inst_meta_path</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Tue Jul 18 15:55:15 2017 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.9 (ruby-2.2.7).
</div>

    </div>
  </body>
</html>