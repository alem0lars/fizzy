<!DOCTYPE html>
<html xmlns='http://www.w3.org/1999/xhtml'>
  <head>
    <title>Code coverage for Build</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <script src='./assets/0.10.0/application.js' type='text/javascript'></script>    
    <link href='./assets/0.10.0/application.css' media='screen, projection, print' rel='stylesheet' type='text/css'>
    <link rel="shortcut icon" type="image/png" href="./assets/0.10.0/favicon_red.png" />
    <link rel="icon" type="image/png" href="./assets/0.10.0/favicon.png" />
  </head>
  
  <body>
    <div id="loading">
      <img src="./assets/0.10.0/loading.gif" alt="loading"/>
    </div>
    <div id="wrapper" style="display:none;">
      <div class="timestamp">Generated <abbr class="timeago" title="2016-10-07T11:50:21+02:00">2016-10-07T11:50:21+02:00</abbr></div>
      <ul class="group_tabs"></ul>

      <div id="content">
        <div class="file_list_container" id="AllFiles">
  <h2>
    <span class="group_name">All Files</span>
    (<span class="covered_percent"><span class="red">31.11%</span></span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.5
       </span>
    </span> hits/line)
  </h2>
  <a name="AllFiles"></a>
  <div>
    <b>1</b> files in total.
    <b>1167</b> relevant lines. 
    <span class="green"><b>363</b> lines covered</span> and
    <span class="red"><b>804</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
      <tr>
        <td class="strong"><a href="#8df3fc0926bf8089302a2d1ce6aba26fe929fd4e" class="src_link" title="fizzy.rb">fizzy.rb</a></td>
        <td class="red strong">31.11 %</td>
        <td>2879</td>
        <td>1167</td>
        <td>363</td>
        <td>804</td>
        <td>0.5</td>
      </tr>
      
    </tbody>
  </table>
</div>


        
      </div>
    
      <div id="footer">
        Generated by <a href="http://github.com/colszowka/simplecov">simplecov</a> v0.12.0 
        and simplecov-html v0.10.0<br/>
        using RSpec
      </div>
    
      <div class="source_files">
      
        <div class="source_table" id="8df3fc0926bf8089302a2d1ce6aba26fe929fd4e">
  <div class="header">
    <h3>fizzy.rb</h3>
    <h4><span class="red">31.11 %</span> covered</h4>
    <div>
      <b>1167</b> relevant lines. 
      <span class="green"><b>363</b> lines covered</span> and
      <span class="red"><b>804</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="never" data-hits="" data-linenumber="1">
          
          
          <code class="ruby">#!/usr/bin/env ruby</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"># File header ─────────────────────────────────────────────────────────────────┐</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">#                                                                              │</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"># File informations:                                                           │</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"># - Name:    fizzy                                                             │</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"># - Summary: The hassle free configuration manager                             │</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"># - Authors:                                                                   │</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">#   - Alessandro Molari &lt;molari.alessandro@gmail.com&gt; (alem0lars)              │</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"># - Contributors:                                                              │</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">#   - Luca Molari &lt;molari.luca@gmail.com&gt; (lmolr)                              │</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">#   Special thanks:                                                            │</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">#   - Thor project (https://github.com/erikhuda/thor)                          │</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">#   - Hash#deep_merge (http://www.ruby-forum.com/topic/142809)                 │</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">#                                                                              │</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">#                                                                              │</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby"># Project informations:                                                        │</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">#   - Homepage:        https://github.com/alem0lars/fizzy                      │</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">#   - Getting started: see README.md in the project root folder                │</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">#                                                                              │</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby"># License: Apache v2.0 (see below)                                             │</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">#                                                                              │</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby"># ─────────────────────────────────────────────────────────────────────────────┤</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">#                                                                              │</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby"># Licensed to the Apache Software Foundation (ASF) under one more contributor  │</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"># license agreements.  See the NOTICE file distributed with this work for      │</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby"># additional information regarding copyright ownership. The ASF licenses this  │</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby"># file to you under the Apache License, Version 2.0 (the &quot;License&quot;); you may   │</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"># not use this file except in compliance with the License.                     │</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby"># You may obtain a copy of the License at                                      │</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">#                                                                              │</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">#   http://www.apache.org/licenses/LICENSE-2.0                                 │</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">#                                                                              │</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby"># Unless required by applicable law or agreed to in writing, software          │</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT    │</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby"># WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.             │</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby"># See the License for the specific language governing permissions and          │</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby"># limitations under the License.                                               │</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">#                                                                              │</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby"># ─────────────────────────────────────────────────────────────────────────────┘</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby"># ────────────────────────────────────────────────────────────────── Requires ──</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby"># Core modules.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="46">
          <span class="hits">1</span>
          
          <code class="ruby">require &quot;fileutils&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="47">
          <span class="hits">1</span>
          
          <code class="ruby">require &quot;find&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="48">
          <span class="hits">1</span>
          
          <code class="ruby">require &quot;forwardable&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="49">
          <span class="hits">1</span>
          
          <code class="ruby">require &quot;json&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="50">
          <span class="hits">1</span>
          
          <code class="ruby">require &quot;net/http&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="51">
          <span class="hits">1</span>
          
          <code class="ruby">require &quot;ostruct&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="52">
          <span class="hits">1</span>
          
          <code class="ruby">require &quot;pathname&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="53">
          <span class="hits">1</span>
          
          <code class="ruby">require &quot;securerandom&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="54">
          <span class="hits">1</span>
          
          <code class="ruby">require &quot;shellwords&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="55">
          <span class="hits">1</span>
          
          <code class="ruby">require &quot;strscan&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="56">
          <span class="hits">1</span>
          
          <code class="ruby">require &quot;uri&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="57">
          <span class="hits">1</span>
          
          <code class="ruby">require &quot;yaml&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby"># Try to require `thor` or raise an exception.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="60">
          <span class="hits">1</span>
          
          <code class="ruby">begin</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="61">
          <span class="hits">1</span>
          
          <code class="ruby">  require &quot;thor&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">rescue</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="63">
          
          
          <code class="ruby">  puts(&quot;\e[31m☠ The gem `thor` is not installed. &quot; +</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">       &quot;To install run: `gem install thor`. Aborting.\e[0m&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="65">
          
          
          <code class="ruby">  exit(-1)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby"># Top-level namespace.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="69">
          <span class="hits">1</span>
          
          <code class="ruby">module Fizzy</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby"># ───────────────────────────────────────────────────────────── Configuration ──</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="74">
          <span class="hits">1</span>
          
          <code class="ruby">Fizzy::CFG = OpenStruct.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby"># Fizzy version.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="77">
          <span class="hits">1</span>
          
          <code class="ruby">Fizzy::CFG.version = &quot;2.2.0&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby"># URL for reporting fizzy issues.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="80">
          <span class="hits">1</span>
          
          <code class="ruby">Fizzy::CFG.issues_url = &quot;https://github.com/alem0lars/fizzy/issues&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby"># Default editor.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="83">
          <span class="hits">1</span>
          
          <code class="ruby">Fizzy::CFG.editor = ENV[&quot;EDITOR&quot;] || &quot;vim&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby"># Debug mode.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="86">
          <span class="hits">1</span>
          
          <code class="ruby">Fizzy::CFG.debug = ENV[&quot;FIZZY_DEBUG&quot;] =~ /^(?:true|yes)$/</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby"># The operating-system which fizzy is running on.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="89">
          <span class="hits">1</span>
          
          <code class="ruby">Fizzy::CFG.os = case RUBY_PLATFORM</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="90">
          <span class="hits">1</span>
          
          <code class="ruby">                  when /darwin/ then :osx</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="91">
          
          
          <code class="ruby">                  when /linux/  then :linux</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="92">
          
          
          <code class="ruby">                  else               :windows</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby"># Remote URL for fizzy static files (must end with a slash).</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="96">
          <span class="hits">1</span>
          
          <code class="ruby">Fizzy::CFG.static_files_base_url =</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby">  URI(&quot;https://raw.githubusercontent.com/alem0lars/fizzy/master/&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="98">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="99">
          
          
          <code class="ruby"># Default fizzy root directory (holding all of the fizzy stuff).</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="100">
          <span class="hits">1</span>
          
          <code class="ruby">Fizzy::CFG.default_fizzy_dir = Pathname.new(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby">  ENV[&quot;FIZZY_DIR&quot;] ||</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby">  case Fizzy::CFG.os</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="103">
          
          
          <code class="ruby">    when :linux   then &quot;/usr/share/fizzy&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="104">
          <span class="hits">1</span>
          
          <code class="ruby">    when :osx     then &quot;~/Library/Application Support/fizzy&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="105">
          
          
          <code class="ruby">    when :windows then &quot;~/fizzy&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="106">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="107">
          
          
          <code class="ruby">).expand_path</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby"># Default meta file name.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="110">
          <span class="hits">1</span>
          
          <code class="ruby">Fizzy::CFG.default_meta_name = &quot;meta.yml&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="111">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="112">
          
          
          <code class="ruby"># Variables inheritance.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="113">
          <span class="hits">1</span>
          
          <code class="ruby">Fizzy::CFG.vars = OpenStruct.new(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="114">
          
          
          <code class="ruby">  yaml_regexp: /^#\s*=&gt;\s*inherits\s*(:\s+)?(?&lt;parents&gt;.+)\s*&lt;=\s*#\s*/,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="115">
          
          
          <code class="ruby">  json_regexp: /^\/\*\s*=&gt;\s*inherits\s*(:\s+)?(?&lt;parents&gt;.+)\s*&lt;=\s*\*\/\s*/,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="116">
          
          
          <code class="ruby">  parent_dummy_regexp: /none|nothing/i</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="117">
          
          
          <code class="ruby">)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="119">
          <span class="hits">1</span>
          
          <code class="ruby">Fizzy::CFG.instantiate_exclude_pattern = /\.git|README/</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="120">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="121">
          
          
          <code class="ruby"># ───────────────────────────────────────────────────────────── String ← Exts ──</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="122">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="123">
          <span class="hits">1</span>
          
          <code class="ruby">class String</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="124">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="125">
          
          
          <code class="ruby">  # Escapes the underlying object so that it can be safely used in a Bourne</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="126">
          
          
          <code class="ruby">  # shell commandline.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="127">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="128">
          <span class="hits">1</span>
          
          <code class="ruby">  def shell_escape</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="129">
          
          
          <code class="ruby">    Shellwords.shellescape(self)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="130">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="131">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="132">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="133">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="134">
          
          
          <code class="ruby"># ─────────────────────────────────────────────────────────────── Hash ← Exts ──</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="135">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="136">
          <span class="hits">1</span>
          
          <code class="ruby">class Hash</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="137">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="138">
          
          
          <code class="ruby">  # Extract `n` sample key/value pairs from the underlying `Hash`.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="139">
          <span class="hits">1</span>
          
          <code class="ruby">  def sample(n=1)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="140">
          
          
          <code class="ruby">    Hash[self.to_a.sample(n)]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="141">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="142">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="143">
          
          
          <code class="ruby">  # Perform recursive merge of the current `Hash` (`self`) with the provided one</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="144">
          
          
          <code class="ruby">  # (the `second` argument).</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="145">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="146">
          
          
          <code class="ruby">  # The merge have knows how to recurse in both `Hash`es and `Array`s.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="147">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="148">
          <span class="hits">1</span>
          
          <code class="ruby">  def deep_merge(second)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="149">
          
          
          <code class="ruby">    merger = proc do |key, v1, v2|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="150">
          
          
          <code class="ruby">      if Hash === v1 &amp;&amp; Hash === v2</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="151">
          
          
          <code class="ruby">        v1.merge(v2, &amp;merger)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="152">
          
          
          <code class="ruby">      elsif Array === v1 &amp;&amp; Array === v2</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="153">
          
          
          <code class="ruby">        (Set.new(v1) + Set.new(v2)).to_a</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="154">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="155">
          
          
          <code class="ruby">        v2</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="156">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="157">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="158">
          
          
          <code class="ruby">    self.merge(second, &amp;merger)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="159">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="160">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="161">
          <span class="hits">1</span>
          
          <code class="ruby">  def fqkeys(prefix=&quot;&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="162">
          
          
          <code class="ruby">    self.inject([]) do |acc, (k, v)|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="163">
          
          
          <code class="ruby">      prefix_new = prefix.empty? ? k.to_s : &quot;#{prefix}.#{k}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="164">
          
          
          <code class="ruby">      acc + (v.is_a?(Hash) ? v.fqkeys(prefix_new) : [prefix_new])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="165">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="166">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="167">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="168">
          <span class="hits">1</span>
          
          <code class="ruby">  def slice(*keys)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="169">
          
          
          <code class="ruby">    self.select{|k, _| keys.include?(k)}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="170">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="171">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="172">
          
          
          <code class="ruby">  # ────────────────────────────────────────────────────────────────────────────</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="173">
          
          
          <code class="ruby">  # ☞ Convert keys</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="174">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="175">
          
          
          <code class="ruby">  # Return a new `Hash` with all keys converted to `String`s.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="176">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="177">
          <span class="hits">1</span>
          
          <code class="ruby">  def deep_stringify_keys</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="178">
          
          
          <code class="ruby">    deep_transform_keys{ |key| key.to_s }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="179">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="180">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="181">
          
          
          <code class="ruby">  # Destructively convert all keys to `String`s.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="182">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="183">
          <span class="hits">1</span>
          
          <code class="ruby">  def deep_stringify_keys!</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="184">
          
          
          <code class="ruby">    deep_transform_keys!{ |key| key.to_s }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="185">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="186">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="187">
          
          
          <code class="ruby">  # Return a new `Hash` with all keys converted to `Symbol`s, as long as they</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="188">
          
          
          <code class="ruby">  # respond to `to_sym`.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="189">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="190">
          <span class="hits">1</span>
          
          <code class="ruby">  def deep_symbolize_keys</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="191">
          
          
          <code class="ruby">    deep_transform_keys{ |key| key.to_sym rescue key }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="192">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="193">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="194">
          
          
          <code class="ruby">  # Destructively convert all keys to `Symbol`s, as long as they respond to</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="195">
          
          
          <code class="ruby">  # `to_sym`.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="196">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="197">
          <span class="hits">1</span>
          
          <code class="ruby">  def deep_symbolize_keys!</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="198">
          
          
          <code class="ruby">    deep_transform_keys!{ |key| key.to_sym rescue key }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="199">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="200">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="201">
          
          
          <code class="ruby">  # Return a new `Hash` with all keys converted by the block operation.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="202">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="203">
          <span class="hits">1</span>
          
          <code class="ruby">  def deep_transform_keys(&amp;block)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="204">
          
          
          <code class="ruby">    deep_transform_keys_in_object(self, &amp;block)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="205">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="206">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="207">
          
          
          <code class="ruby">  # Destructively convert all keys by using the block operation.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="208">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="209">
          <span class="hits">1</span>
          
          <code class="ruby">  def deep_transform_keys!(&amp;block)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="210">
          
          
          <code class="ruby">    deep_transform_keys_in_object!(self, &amp;block)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="211">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="212">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="213">
          <span class="hits">1</span>
          
          <code class="ruby">  private def deep_transform_keys_in_object(object, &amp;block)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="214">
          
          
          <code class="ruby">    case object</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="215">
          
          
          <code class="ruby">      when Hash</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="216">
          
          
          <code class="ruby">        object.each_with_object({}) do |(key, value), result|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="217">
          
          
          <code class="ruby">          result[yield(key)] = deep_transform_keys_in_object(value, &amp;block)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="218">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="219">
          
          
          <code class="ruby">      when Array</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="220">
          
          
          <code class="ruby">        object.map {|e| deep_transform_keys_in_object(e, &amp;block)}</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="221">
          
          
          <code class="ruby">      else object</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="222">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="223">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="224">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="225">
          <span class="hits">1</span>
          
          <code class="ruby">  private def deep_transform_keys_in_object!(object, &amp;block)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="226">
          
          
          <code class="ruby">    case object</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="227">
          
          
          <code class="ruby">      when Hash</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="228">
          
          
          <code class="ruby">        object.keys.each do |key|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="229">
          
          
          <code class="ruby">          value = object.delete(key)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="230">
          
          
          <code class="ruby">          object[yield(key)] = deep_transform_keys_in_object!(value, &amp;block)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="231">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="232">
          
          
          <code class="ruby">        object</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="233">
          
          
          <code class="ruby">      when Array</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="234">
          
          
          <code class="ruby">        object.map! {|e| deep_transform_keys_in_object!(e, &amp;block)}</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="235">
          
          
          <code class="ruby">      else object</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="236">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="237">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="238">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="239">
          
          
          <code class="ruby">  # ────────────────────────────────────────────────────────────────────────────</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="240">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="241">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="242">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="243">
          
          
          <code class="ruby"># ─────────────────────────────────────────────────────────── Pathname ← Exts ──</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="244">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="245">
          <span class="hits">1</span>
          
          <code class="ruby">class Pathname</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="246">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="247">
          
          
          <code class="ruby">  # Escapes the string representation of the underlying object,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="248">
          
          
          <code class="ruby">  # so that it can be safely used in a Bourne shell commandline.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="249">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="250">
          <span class="hits">1</span>
          
          <code class="ruby">  def shell_escape</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="251">
          
          
          <code class="ruby">    Shellwords.shellescape(self)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="252">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="253">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="254">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="255">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="256">
          
          
          <code class="ruby"># ─────────────────────────────────────────────────────────────── Thor ← Exts ──</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="257">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="258">
          <span class="hits">1</span>
          
          <code class="ruby">class Thor</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="259">
          <span class="hits">1</span>
          
          <code class="ruby">  module Actions</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="260">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="261">
          
          
          <code class="ruby">    # Monkey-patch to retrieve the template currently processed.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="262">
          <span class="hits">1</span>
          
          <code class="ruby">    old_template = instance_method(:template)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="263">
          <span class="hits">1</span>
          
          <code class="ruby">    remove_method :template</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="264">
          <span class="hits">1</span>
          
          <code class="ruby">    define_method :template, -&gt;(source, *args, &amp;blk) do</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="265">
          
          
          <code class="ruby">      $fizzy_cur_template = source</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="266">
          
          
          <code class="ruby">      old_template.bind(self).(source, *args, &amp;blk)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="267">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="268">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="269">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="270">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="271">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="272">
          
          
          <code class="ruby"># ───────────────────────────────────────────────────────────── Caller ← Misc ──</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="273">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="274">
          <span class="hits">1</span>
          
          <code class="ruby">class Fizzy::Caller</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="275">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="276">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.info(depth=1)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="277">
          
          
          <code class="ruby">    parse_caller(caller(depth + 2).first)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="278">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="279">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="280">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.method_name(depth=1)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="281">
          
          
          <code class="ruby">    parse_caller(caller(depth + 2).first)[:method]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="282">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="283">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="284">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.parse_caller(at)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="285">
          
          
          <code class="ruby">    if /^(.+?):(\d+)(?::in `(.*)&#39;)?/ =~ at</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="286">
          
          
          <code class="ruby">      file   = Regexp.last_match[1]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="287">
          
          
          <code class="ruby">      line   = Regexp.last_match[2].to_i</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="288">
          
          
          <code class="ruby">      method = Regexp.last_match[3]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="289">
          
          
          <code class="ruby">      {file: file, line: line, method: method}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="290">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="291">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="292">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="293">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="294">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="295">
          
          
          <code class="ruby"># ─────────────────────────────────────────────────────────────── Must ← Misc ──</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="296">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="297">
          <span class="hits">1</span>
          
          <code class="ruby">class Object</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="298">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="299">
          <span class="hits">1</span>
          
          <code class="ruby">  def must(name,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="300">
          
          
          <code class="ruby">           value,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="301">
          
          
          <code class="ruby">           be: nil,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="302">
          
          
          <code class="ruby">           ge: nil, gt: nil, le: nil, lt: nil)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="303">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="304">
          
          
          <code class="ruby">    if !be.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="305">
          
          
          <code class="ruby">      # 1: type condition.</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="306">
          
          
          <code class="ruby">      if be.is_a?(Class) &amp;&amp; !value.is_a?(be)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="307">
          
          
          <code class="ruby">        error &quot;Invalid `#{name}` (value=`#{value}`): must be a `#{be}`&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="308">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="309">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="310">
          
          
          <code class="ruby">      # 2: not nil condition.</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="311">
          
          
          <code class="ruby">      error &quot;Invalid `#{name}`: must be not nil&quot; if be == :not_nil &amp;&amp; value.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="312">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="313">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="314">
          
          
          <code class="ruby">    # 3.1: greater-or-equal-than condition.</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="315">
          
          
          <code class="ruby">    if !ge.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="316">
          
          
          <code class="ruby">      must name, value, be: Number</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="317">
          
          
          <code class="ruby">      must :ge,  ge,    be: Number</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="318">
          
          
          <code class="ruby">      unless value &gt;= ge</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="319">
          
          
          <code class="ruby">        error &quot;Invalid `#{name}`: `#{value}` must be greater or equal than `#{ge}`&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="320">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="321">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="322">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="323">
          
          
          <code class="ruby">    # 3.2: greater-than condition.</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="324">
          
          
          <code class="ruby">    if !gt.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="325">
          
          
          <code class="ruby">      must name, value, be: Number</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="326">
          
          
          <code class="ruby">      must :gt,  gt,    be: Number</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="327">
          
          
          <code class="ruby">      unless value &gt; gt</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="328">
          
          
          <code class="ruby">        error &quot;Invalid `#{name}`: `#{value}` must be greater than `#{gt}`&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="329">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="330">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="331">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="332">
          
          
          <code class="ruby">    # 3.3: lesser-or-equal-than condition.</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="333">
          
          
          <code class="ruby">    if !le.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="334">
          
          
          <code class="ruby">      must name, value, be: Number</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="335">
          
          
          <code class="ruby">      must :le,  le,    be: Number</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="336">
          
          
          <code class="ruby">      unless value &lt;= le</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="337">
          
          
          <code class="ruby">        error &quot;Invalid `#{name}`: `#{value}` must be lesser or equal than `#{le}`&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="338">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="339">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="340">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="341">
          
          
          <code class="ruby">    # 3.4: lesser-than condition.</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="342">
          
          
          <code class="ruby">    if !lt.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="343">
          
          
          <code class="ruby">      must name, value, be: Number</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="344">
          
          
          <code class="ruby">      must :lt,  lt,    be: Number</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="345">
          
          
          <code class="ruby">      unless value &lt; lt</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="346">
          
          
          <code class="ruby">        error &quot;Invalid `#{name}`: `#{value}` must be lesser than `#{lt}`&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="347">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="348">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="349">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="350">
          
          
          <code class="ruby">    # 3: ad-hoc condition.</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="351">
          
          
          <code class="ruby">    if block_given?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="352">
          
          
          <code class="ruby">      result = yield(name, value)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="353">
          
          
          <code class="ruby">      if result.is_a?(Array)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="354">
          
          
          <code class="ruby">        error &quot;Invalid `#{name}`: #{result[1]}&quot; unless result[0]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="355">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="356">
          
          
          <code class="ruby">        error &quot;Invalid `#{name}`: wrong value `#{value}`&quot; unless result</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="357">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="358">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="359">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="360">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="361">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="362">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="363">
          
          
          <code class="ruby"># ──────────────────────────────────────────────────── Abstract method ← Misc ──</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="364">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="365">
          
          
          <code class="ruby"># Exception raised when an abstract method is called.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="366">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="367">
          <span class="hits">1</span>
          
          <code class="ruby">class AbstractMethodCalled &lt; StandardError</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="368">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="369">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="370">
          <span class="hits">1</span>
          
          <code class="ruby">class Module</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="371">
          
          
          <code class="ruby">  # Define one or more abstract methods with given names in a class or module.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="372">
          
          
          <code class="ruby">  # When called, the abstract method will raise an `AbstractMethodCalled`</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="373">
          
          
          <code class="ruby">  # exception with a helpful message.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="374">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="375">
          
          
          <code class="ruby">  # @example</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="376">
          
          
          <code class="ruby">  #   class AbstractClass</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="377">
          
          
          <code class="ruby">  #     abstract_method :foo</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="378">
          
          
          <code class="ruby">  #   end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="379">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="380">
          
          
          <code class="ruby">  #   class ConcreteClass &lt; AbstractClass</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="381">
          
          
          <code class="ruby">  #     def foo</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="382">
          
          
          <code class="ruby">  #       42</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="383">
          
          
          <code class="ruby">  #     end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="384">
          
          
          <code class="ruby">  #   end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="385">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="386">
          
          
          <code class="ruby">  #   AbstractClass.new.foo # raises AbstractMethodCalled</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="387">
          
          
          <code class="ruby">  #   ConcreteClass.new.foo # =&gt; 42</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="388">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="389">
          
          
          <code class="ruby">  # @param [Array&lt;Symbol&gt;] names the names of defined abstract methods</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="390">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="391">
          <span class="hits">1</span>
          
          <code class="ruby">  def abstract_method(*names)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="392">
          <span class="hits">4</span>
          
          <code class="ruby">    definitor = self</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="393">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="394">
          <span class="hits">4</span>
          
          <code class="ruby">    names.each do |name|</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="395">
          <span class="hits">4</span>
          
          <code class="ruby">      define_method name do |*args|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="396">
          
          
          <code class="ruby">        raise AbstractMethodCalled,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="397">
          
          
          <code class="ruby">              &quot;Called unimplemented abstract method #{self.class}##{name} &quot; +</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="398">
          
          
          <code class="ruby">              &quot;(defined in #{definitor.class.name.downcase} #{definitor}).&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="399">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="400">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="401">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="402">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="403">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="404">
          
          
          <code class="ruby"># ───────────────────────────────────────────────────────── Typesystem ← Misc ──</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="405">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="406">
          <span class="hits">1</span>
          
          <code class="ruby">module Fizzy::TypeSystem</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="407">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="408">
          
          
          <code class="ruby">  # Check/convert type of the provided `value`,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="409">
          
          
          <code class="ruby">  # according to the argument `type`.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="410">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="411">
          
          
          <code class="ruby">  # The argument `name` is a logical name to be used for the value,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="412">
          
          
          <code class="ruby">  # used when logging messages. It can be anything.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="413">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="414">
          
          
          <code class="ruby">  # If `strict` is `true`, then no type convertion/normalization is done;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="415">
          
          
          <code class="ruby">  # otherwise, try to guess the correct type.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="416">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="417">
          <span class="hits">1</span>
          
          <code class="ruby">  def typize(name, value, type: nil, strict: false)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="418">
          
          
          <code class="ruby">    if type.nil? || (type.to_s.end_with?(&quot;?&quot;) &amp;&amp; value.nil?)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="419">
          
          
          <code class="ruby">      value</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="420">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="421">
          
          
          <code class="ruby">      case type.to_s.gsub(/\?$/, &quot;&quot;).to_sym</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="422">
          
          
          <code class="ruby">        when :string, :str</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="423">
          
          
          <code class="ruby">          strict ? _ensure_type!(name, value, String) : value.to_s</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="424">
          
          
          <code class="ruby">        when :symbol, :sym</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="425">
          
          
          <code class="ruby">          strict ? _ensure_type!(name, value, Symbol) : value.to_s.to_sym</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="426">
          
          
          <code class="ruby">        when :integer, :int</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="427">
          
          
          <code class="ruby">          strict ? _ensure_type!(name, value, Integer) : Integer(value)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="428">
          
          
          <code class="ruby">        when :boolean, :bool</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="429">
          
          
          <code class="ruby">          if strict</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="430">
          
          
          <code class="ruby">            _ensure_type!(name, value, TrueClass, FalseClass)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="431">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="432">
          
          
          <code class="ruby">            if value.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="433">
          
          
          <code class="ruby">              nil</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="434">
          
          
          <code class="ruby">            elsif value.is_a?(TrueClass) || value.to_s == &quot;true&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="435">
          
          
          <code class="ruby">              true</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="436">
          
          
          <code class="ruby">            elsif value.is_a?(FalseClass) || value.to_s == &quot;false&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="437">
          
          
          <code class="ruby">              false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="438">
          
          
          <code class="ruby">            else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="439">
          
          
          <code class="ruby">              error(&quot;Invalid `#{value}` for value `#{name}`: &quot; +</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="440">
          
          
          <code class="ruby">                    &quot;it can&#39;t be converted to a boolean.&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="441">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="442">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="443">
          
          
          <code class="ruby">        when :path, :pth then</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="444">
          
          
          <code class="ruby">          if strict &amp;&amp; !File.exist?(value)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="445">
          
          
          <code class="ruby">            error(&quot;Invalid `#{name}`: `#{value}` doesn&#39;t exist&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="446">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="447">
          
          
          <code class="ruby">            Pathname.new(value).expand_path</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="448">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="449">
          
          
          <code class="ruby">        when :file then</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="450">
          
          
          <code class="ruby">          if strict &amp;&amp; !File.file?(value)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="451">
          
          
          <code class="ruby">            error(&quot;Invalid `#{name}`: `#{value}` isn&#39;t a file&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="452">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="453">
          
          
          <code class="ruby">            Pathname.new(value).expand_path</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="454">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="455">
          
          
          <code class="ruby">        when :directory, :dir then</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="456">
          
          
          <code class="ruby">          if strict &amp;&amp; !File.directory?(value)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="457">
          
          
          <code class="ruby">            error(&quot;Invalid `#{name}`: `#{value}` isn&#39;t a directory&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="458">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="459">
          
          
          <code class="ruby">            Pathname.new(value).expand_path</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="460">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="461">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="462">
          
          
          <code class="ruby">          error(&quot;Unhandled type `#{type}`. If you need support for a new &quot; +</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="463">
          
          
          <code class="ruby">                &quot;type, open an issue at `#{Fizzy::CFG.issues_url}`.&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="464">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="465">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="466">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="467">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="468">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="469">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="470">
          
          
          <code class="ruby"># ───────────────────────────────────────────────────────────────── Io ← Core ──</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="471">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="472">
          <span class="hits">1</span>
          
          <code class="ruby">module Fizzy::IO</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="473">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="474">
          
          
          <code class="ruby">  # Get the shell object.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="475">
          
          
          <code class="ruby">  # It will be lazily instantiated.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="476">
          <span class="hits">1</span>
          
          <code class="ruby">  def shell</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="477">
          
          
          <code class="ruby">    @shell ||= Thor::Shell::Color.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="478">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="479">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="480">
          
          
          <code class="ruby">  # Ask a question to the user.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="481">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="482">
          
          
          <code class="ruby">  # The message is made by the `question` string, with some additions (like</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="483">
          
          
          <code class="ruby">  # `?` sign).</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="484">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="485">
          
          
          <code class="ruby">  # The available quiz types are:</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="486">
          
          
          <code class="ruby">  # - `:bool`: Boolean quiz, the user can respond with `yes` or `no` (or</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="487">
          
          
          <code class="ruby">  #            alternatives, see regexes below). A boolean value is returned.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="488">
          
          
          <code class="ruby">  # - `:string`: Normal quiz, the user is prompt for a question and if the</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="489">
          
          
          <code class="ruby">  #              answer isn&#39;t empty is returned.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="490">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="491">
          <span class="hits">1</span>
          
          <code class="ruby">  def quiz(question, type: :bool)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="492">
          
          
          <code class="ruby">    answer = shell.ask(&quot;#{question.strip}? &quot;, :magenta)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="493">
          
          
          <code class="ruby">    case type</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="494">
          
          
          <code class="ruby">      when :bool</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="495">
          
          
          <code class="ruby">        if answer =~ /y|ye|yes|yeah|ofc/i</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="496">
          
          
          <code class="ruby">          true</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="497">
          
          
          <code class="ruby">        elsif answer =~ /n|no|fuck|fuck\s+you|fuck\s+off/i</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="498">
          
          
          <code class="ruby">          false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="499">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="500">
          
          
          <code class="ruby">          tell(&quot;Answer misunderstood&quot;, :yellow)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="501">
          
          
          <code class="ruby">          quiz(question, type: type)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="502">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="503">
          
          
          <code class="ruby">      when :string</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="504">
          
          
          <code class="ruby">        if answer.empty?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="505">
          
          
          <code class="ruby">          warning(&quot;Empty answer&quot;, ask_continue: false)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="506">
          
          
          <code class="ruby">          quiz(question, type: type)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="507">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="508">
          
          
          <code class="ruby">          answer</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="509">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="510">
          
          
          <code class="ruby">      else error(&quot;Unhandled question type: `#{type}`.&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="511">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="512">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="513">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="514">
          <span class="hits">1</span>
          
          <code class="ruby">  def debug(msg)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="515">
          
          
          <code class="ruby">    caller_info = caller.</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="516">
          
          
          <code class="ruby">      map { |c| c[/`.*&#39;/][1..-2].split(&quot; &quot;).first }.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="517">
          
          
          <code class="ruby">      uniq[0..2].</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="518">
          
          
          <code class="ruby">      join(&quot; → &quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="519">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="520">
          
          
          <code class="ruby">    tell(colorize(&quot;⚫ &quot;, :magenta) +</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="521">
          
          
          <code class="ruby">         colorize(&quot;&lt;&quot;, :blue) +</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="522">
          
          
          <code class="ruby">         colorize(caller_info, :cyan) +</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="523">
          
          
          <code class="ruby">         colorize(&quot;&gt;&quot;, :blue) +</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="524">
          
          
          <code class="ruby">         colorize(&quot;: #{msg}&quot;, :white)) if Fizzy::CFG.debug</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="525">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="526">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="527">
          
          
          <code class="ruby">  # Display an informative message (`msg`) to the user.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="528">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="529">
          
          
          <code class="ruby">  # The `prefix` argument should contain some text displayed before the</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="530">
          
          
          <code class="ruby">  # message, typically to show the context which the message belongs to.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="531">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="532">
          <span class="hits">1</span>
          
          <code class="ruby">  def info(prefix, msg)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="533">
          
          
          <code class="ruby">    tell(colorize(&quot;☞ &quot;, :magenta) +</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="534">
          
          
          <code class="ruby">         colorize(prefix, :cyan) +</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="535">
          
          
          <code class="ruby">         colorize(&quot; #{msg}&quot;, :white))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="536">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="537">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="538">
          
          
          <code class="ruby">  # Display an informative message (`msg`) to the user.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="539">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="540">
          
          
          <code class="ruby">  # If `ask_continue` is `true`, the user can interactively choose to stop</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="541">
          
          
          <code class="ruby">  # the program or exit (with exit status `-1`).</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="542">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="543">
          <span class="hits">1</span>
          
          <code class="ruby">  def warning(msg, ask_continue: true)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="544">
          
          
          <code class="ruby">    tell(colorize(&quot;☞ &quot;, :magenta) + colorize(msg, :yellow))</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="545">
          
          
          <code class="ruby">    exit(-1) if ask_continue &amp;&amp; !quiz(&quot;continue&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="546">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="547">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="548">
          
          
          <code class="ruby">  # Display an error message (`msg`) to the user. Before returning, the</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="549">
          
          
          <code class="ruby">  # program will exit (with exit status `-1`).</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="550">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="551">
          <span class="hits">1</span>
          
          <code class="ruby">  def error(msg, status: -1)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="552">
          
          
          <code class="ruby">    error(&quot;Invalid status code `#{status}`: it&#39;s not negative&quot;) if status &gt;= 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="553">
          
          
          <code class="ruby">    tell(colorize(&quot;☠ &quot;, :magenta) + colorize(msg, :red))</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="554">
          
          
          <code class="ruby">    exit(status)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="555">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="556">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="557">
          
          
          <code class="ruby">  # Tell something to the user.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="558">
          
          
          <code class="ruby">  # It&#39;s a proxy method to `Thor::Shell::Color.say`.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="559">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="560">
          <span class="hits">1</span>
          
          <code class="ruby">  def tell(*args)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="561">
          
          
          <code class="ruby">    shell.say(*args)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="562">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="563">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="564">
          
          
          <code class="ruby">  # Colorize the provided string.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="565">
          
          
          <code class="ruby">  # It&#39;s a proxy method to `Thor::Shell::Color.set_color`.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="566">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="567">
          <span class="hits">1</span>
          
          <code class="ruby">  def colorize(*args)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="568">
          
          
          <code class="ruby">    shell.set_color(*args)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="569">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="570">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="571">
          
          
          <code class="ruby">  # ──────────────────────────────────────────────────────────────────────────</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="572">
          
          
          <code class="ruby">  # ☞ Well-known messages</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="573">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="574">
          
          
          <code class="ruby">  # Get colorized success symbol.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="575">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="576">
          <span class="hits">1</span>
          
          <code class="ruby">  def ✔</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="577">
          
          
          <code class="ruby">    colorize(&quot;✔&quot;, :green)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="578">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="579">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="580">
          
          
          <code class="ruby">  # Get colorized error symbol.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="581">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="582">
          <span class="hits">1</span>
          
          <code class="ruby">  def ✘</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="583">
          
          
          <code class="ruby">    colorize(&quot;✘&quot;, :red)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="584">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="585">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="586">
          
          
          <code class="ruby">  # ──────────────────────────────────────────────────────────────────────────</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="587">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="588">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="589">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="590">
          
          
          <code class="ruby"># ───────────────────────────────────────────────────── Base lexer ← Grammars ──</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="591">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="592">
          <span class="hits">1</span>
          
          <code class="ruby">class Fizzy::BaseLexer</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="593">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="594">
          <span class="hits">1</span>
          
          <code class="ruby">  include Fizzy::IO</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="595">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="596">
          <span class="hits">1</span>
          
          <code class="ruby">  def initialize(string)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="597">
          
          
          <code class="ruby">    @base   = StringScanner.new(string)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="598">
          
          
          <code class="ruby">    @rules  = []</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="599">
          
          
          <code class="ruby">    @tokens = []</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="600">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="601">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="602">
          <span class="hits">1</span>
          
          <code class="ruby">  def ignore(pattern)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="603">
          
          
          <code class="ruby">    @rules &lt;&lt; [pattern, [:SKIP]]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="604">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="605">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="606">
          <span class="hits">1</span>
          
          <code class="ruby">  def tokens(pattern, *names)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="607">
          
          
          <code class="ruby">    @rules &lt;&lt; [pattern, names]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="608">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="609">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="610">
          <span class="hits">1</span>
          
          <code class="ruby">  def token(pattern, name)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="611">
          
          
          <code class="ruby">    @rules &lt;&lt; [pattern, [name]]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="612">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="613">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="614">
          <span class="hits">1</span>
          
          <code class="ruby">  def keyword(name)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="615">
          
          
          <code class="ruby">    token(Regexp.new(name), name)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="616">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="617">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="618">
          <span class="hits">1</span>
          
          <code class="ruby">  def next_token</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="619">
          
          
          <code class="ruby">    build_tokens if @tokens.empty?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="620">
          
          
          <code class="ruby">    t = @tokens.shift</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="621">
          
          
          <code class="ruby">    t.first == :SKIP ? next_token : t</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="622">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="623">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="624">
          <span class="hits">1</span>
          
          <code class="ruby">private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="625">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="626">
          
          
          <code class="ruby">  # (Re)build the list of tokens.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="627">
          
          
          <code class="ruby">  # Every token is: `[value, token_name]`.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="628">
          <span class="hits">1</span>
          
          <code class="ruby">  def build_tokens</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="629">
          
          
          <code class="ruby">    @tokens  = []</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="630">
          
          
          <code class="ruby">    @tokens += find_tokens until @base.eos?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="631">
          
          
          <code class="ruby">    @tokens &lt;&lt; [false, false] # Last token, meaning EOS.</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="632">
          
          
          <code class="ruby">    debug(&quot;Built tokens: `#{@tokens}`.&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="633">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="634">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="635">
          <span class="hits">1</span>
          
          <code class="ruby">  def find_tokens</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="636">
          
          
          <code class="ruby">    @rules.each do |pattern, tokens|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="637">
          
          
          <code class="ruby">      matched_substring = @base.scan(pattern)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="638">
          
          
          <code class="ruby">      unless matched_substring.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="639">
          
          
          <code class="ruby">        if @base[1].nil? # No captures, return the matched string.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="640">
          
          
          <code class="ruby">          error(&quot;Only one token, not `#{tokens.length}` (`#{tokens}`) should &quot; +</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="641">
          
          
          <code class="ruby">                &quot;be provided.&quot;) if tokens.length != 1</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="642">
          
          
          <code class="ruby">          return [[tokens.first, matched_substring]]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="643">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="644">
          
          
          <code class="ruby">          captures, base_idx = [], 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="645">
          
          
          <code class="ruby">          captures &lt;&lt; @base[base_idx] until @base[base_idx += 1].nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="646">
          
          
          <code class="ruby">          error(&quot;You need to provide `#{captures.length}` tokens, instead of &quot; +</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="647">
          
          
          <code class="ruby">                &quot;`#{tokens.length}`.&quot;) unless captures.length == tokens.length</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="648">
          
          
          <code class="ruby">          return tokens.zip(captures)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="649">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="650">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="651">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="652">
          
          
          <code class="ruby">    error(&quot;Unexpected characters.&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="653">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="654">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="655">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="656">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="657">
          
          
          <code class="ruby"># ───────────────────────────────────────────────────────────────────── Lexer ──</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="658">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="659">
          <span class="hits">1</span>
          
          <code class="ruby">class Fizzy::LogicLexer &lt; Fizzy::BaseLexer</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="660">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="661">
          <span class="hits">1</span>
          
          <code class="ruby">  def initialize(string)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="662">
          
          
          <code class="ruby">    super</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="663">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="664">
          
          
          <code class="ruby">    ignore(/\s+/)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="665">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="666">
          
          
          <code class="ruby">    token(/=/,    :EQ)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="667">
          
          
          <code class="ruby">    token(/&amp;&amp;/,   :AND)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="668">
          
          
          <code class="ruby">    token(/\|\|/, :OR)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="669">
          
          
          <code class="ruby">    token(/\(/,   :LBRACKET)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="670">
          
          
          <code class="ruby">    token(/\)/,   :RBRACKET)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="671">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="672">
          
          
          <code class="ruby">    tokens(/(f\?)(#{name_with(&quot;-_&quot;)})/,  :FEATURE_PREFIX, :FEATURE_NAME)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="673">
          
          
          <code class="ruby">    tokens(/(v\?)(#{name_with(&quot;-_.&quot;)})/, :VAR_PREFIX,     :VAR_NAME)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="674">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="675">
          
          
          <code class="ruby">    token(/.+/, :VALUE) # Anything that would otherwise not match is a value.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="676">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="677">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="678">
          <span class="hits">1</span>
          
          <code class="ruby">private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="679">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="680">
          <span class="hits">1</span>
          
          <code class="ruby">  def name_with(symbols)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="681">
          
          
          <code class="ruby">    /\w+(?:[#{symbols}]\w+)*/</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="682">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="683">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="684">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="685">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="686">
          
          
          <code class="ruby"># ───────────────────────────────────────────────────────────────── Evaluator ──</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="687">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="688">
          <span class="hits">1</span>
          
          <code class="ruby">class Fizzy::LogicEvaluator</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="689">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="690">
          <span class="hits">1</span>
          
          <code class="ruby">  include Fizzy::IO</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="691">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="692">
          <span class="hits">1</span>
          
          <code class="ruby">  def initialize(receiver)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="693">
          
          
          <code class="ruby">    @receiver = receiver</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="694">
          
          
          <code class="ruby">    @stack    = []</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="695">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="696">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="697">
          <span class="hits">1</span>
          
          <code class="ruby">  def result</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="698">
          
          
          <code class="ruby">    res = @stack.first</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="699">
          
          
          <code class="ruby">    debug(&quot;Retrieving result from stack `#{@stack}`: `#{res}`.&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="700">
          
          
          <code class="ruby">    res</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="701">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="702">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="703">
          <span class="hits">1</span>
          
          <code class="ruby">  def and</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="704">
          
          
          <code class="ruby">    arg1 = @stack.pop</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="705">
          
          
          <code class="ruby">    arg2 = @stack.pop</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="706">
          
          
          <code class="ruby">    result = (arg1 == true) &amp;&amp; (arg2 == true)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="707">
          
          
          <code class="ruby">    @stack &lt;&lt; result</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="708">
          
          
          <code class="ruby">    debug(&quot;Performed logical `and` between `#{arg1}` and `#{arg2}`, &quot; +</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="709">
          
          
          <code class="ruby">          &quot;evaluated to `#{result}`.&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="710">
          
          
          <code class="ruby">    debug_stack_state</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="711">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="712">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="713">
          <span class="hits">1</span>
          
          <code class="ruby">  def or</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="714">
          
          
          <code class="ruby">    arg1 = @stack.pop</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="715">
          
          
          <code class="ruby">    arg2 = @stack.pop</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="716">
          
          
          <code class="ruby">    result = arg1 == true || arg2 == true</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="717">
          
          
          <code class="ruby">    @stack &lt;&lt; result</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="718">
          
          
          <code class="ruby">    debug(&quot;Performed logical `or` between `#{arg1}` and `#{arg2}`, &quot; +</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="719">
          
          
          <code class="ruby">          &quot;evaluated to `#{result}`.&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="720">
          
          
          <code class="ruby">    debug_stack_state</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="721">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="722">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="723">
          <span class="hits">1</span>
          
          <code class="ruby">  def has_feature?(name)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="724">
          
          
          <code class="ruby">    result = @receiver.has_feature?(name)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="725">
          
          
          <code class="ruby">    @stack &lt;&lt; result</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="726">
          
          
          <code class="ruby">    debug(&quot;Parsed feature `#{name}`: it&#39;s #{result ? &quot;&quot; : &quot;not &quot;}available.&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="727">
          
          
          <code class="ruby">    debug_stack_state</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="728">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="729">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="730">
          <span class="hits">1</span>
          
          <code class="ruby">  def has_variable?(name)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="731">
          
          
          <code class="ruby">    var_value = @receiver.get_var(name)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="732">
          
          
          <code class="ruby">    result = !var_value.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="733">
          
          
          <code class="ruby">    @stack &lt;&lt; result</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="734">
          
          
          <code class="ruby">    debug(&quot;Parsed variable `#{name}` with value `#{var_value}`: &quot; +</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="735">
          
          
          <code class="ruby">          &quot;it&#39;s #{result ? &quot;&quot; : &quot;not &quot;}available.&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="736">
          
          
          <code class="ruby">    debug_stack_state</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="737">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="738">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="739">
          <span class="hits">1</span>
          
          <code class="ruby">  def variable_value?(name, expected_value)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="740">
          
          
          <code class="ruby">    var_value = @receiver.get_var(name)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="741">
          
          
          <code class="ruby">    result = var_value == expected_value</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="742">
          
          
          <code class="ruby">    @stack &lt;&lt; result</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="743">
          
          
          <code class="ruby">    debug(&quot;Parsed variable `#{name}` with value `#{var_value}`: &quot; +</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="744">
          
          
          <code class="ruby">          &quot;it&#39;s #{result ? &quot;&quot; : &quot;not &quot;}equal to `#{expected_value}`.&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="745">
          
          
          <code class="ruby">    debug_stack_state</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="746">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="747">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="748">
          <span class="hits">1</span>
          
          <code class="ruby">  protected def debug_stack_state</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="749">
          
          
          <code class="ruby">    debug(&quot;Stack state is: `#{@stack}`.&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="750">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="751">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="752">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="753">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="754">
          
          
          <code class="ruby"># ────────────────────────────────────────────────────────────── Logic Parser ──</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="755">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="756">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="757">
          
          
          <code class="ruby"># DO NOT MODIFY!!!!</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="758">
          
          
          <code class="ruby"># This file is automatically generated by Racc 1.4.14</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="759">
          
          
          <code class="ruby"># from Racc grammer file &quot;&quot;.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="760">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="761">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="762">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;racc/parser.rb&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="763">
          <span class="hits">1</span>
          
          <code class="ruby">module Fizzy</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="764">
          <span class="hits">1</span>
          
          <code class="ruby">  class LogicParser &lt; Racc::Parser</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="765">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="766">
          <span class="hits">1</span>
          
          <code class="ruby">module_eval(&lt;&lt;&#39;...end parser.y/module_eval...&#39;, &#39;parser.y&#39;, 29)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="767">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="768">
          
          
          <code class="ruby">  def parse(receiver, arg)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="769">
          
          
          <code class="ruby">    @yydebug = Fizzy::CFG.debug</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="770">
          
          
          <code class="ruby">    @lexer   = Fizzy::LogicLexer.new(arg)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="771">
          
          
          <code class="ruby">    @eval    = Fizzy::LogicEvaluator.new(receiver)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="772">
          
          
          <code class="ruby">    do_parse</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="773">
          
          
          <code class="ruby">    @eval.result</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="774">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="775">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="776">
          
          
          <code class="ruby">  def next_token</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="777">
          
          
          <code class="ruby">    @lexer.next_token</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="778">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="779">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="780">
          
          
          <code class="ruby"># vim: set filetype=racc :</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="781">
          
          
          <code class="ruby">...end parser.y/module_eval...</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="782">
          
          
          <code class="ruby">##### State transition tables begin ###</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="783">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="784">
          <span class="hits">1</span>
          
          <code class="ruby">racc_action_table = [</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="785">
          
          
          <code class="ruby">     3,     3,     4,     4,     5,     5,     3,     3,     4,     4,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="786">
          
          
          <code class="ruby">     5,     5,     7,     8,     7,    15,     7,     8,    17,     6,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="787">
          
          
          <code class="ruby">    10,    11,    12,    16 ]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="788">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="789">
          <span class="hits">1</span>
          
          <code class="ruby">racc_action_check = [</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="790">
          
          
          <code class="ruby">     7,     8,     7,     8,     7,     8,     3,     0,     3,     0,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="791">
          
          
          <code class="ruby">     3,     0,     9,     9,    14,     9,     2,     2,    16,     1,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="792">
          
          
          <code class="ruby">     4,     5,     6,    11 ]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="793">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="794">
          <span class="hits">1</span>
          
          <code class="ruby">racc_action_pointer = [</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="795">
          
          
          <code class="ruby">     2,    19,    13,     1,    12,    11,    22,    -5,    -4,     9,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="796">
          
          
          <code class="ruby">   nil,    21,   nil,   nil,    11,   nil,     7,   nil ]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="797">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="798">
          <span class="hits">1</span>
          
          <code class="ruby">racc_action_default = [</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="799">
          
          
          <code class="ruby">    -8,    -8,    -1,    -8,    -8,    -8,    -8,    -8,    -8,    -8,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="800">
          
          
          <code class="ruby">    -5,    -6,    18,    -3,    -4,    -2,    -8,    -7 ]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="801">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="802">
          <span class="hits">1</span>
          
          <code class="ruby">racc_goto_table = [</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="803">
          
          
          <code class="ruby">     2,     1,   nil,     9,   nil,   nil,   nil,    13,    14 ]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="804">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="805">
          <span class="hits">1</span>
          
          <code class="ruby">racc_goto_check = [</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="806">
          
          
          <code class="ruby">     2,     1,   nil,     2,   nil,   nil,   nil,     2,     2 ]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="807">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="808">
          <span class="hits">1</span>
          
          <code class="ruby">racc_goto_pointer = [</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="809">
          
          
          <code class="ruby">   nil,     1,     0 ]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="810">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="811">
          <span class="hits">1</span>
          
          <code class="ruby">racc_goto_default = [</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="812">
          
          
          <code class="ruby">   nil,   nil,   nil ]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="813">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="814">
          <span class="hits">1</span>
          
          <code class="ruby">racc_reduce_table = [</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="815">
          
          
          <code class="ruby">  0, 0, :racc_error,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="816">
          
          
          <code class="ruby">  1, 13, :_reduce_none,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="817">
          
          
          <code class="ruby">  3, 14, :_reduce_none,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="818">
          
          
          <code class="ruby">  3, 14, :_reduce_3,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="819">
          
          
          <code class="ruby">  3, 14, :_reduce_4,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="820">
          
          
          <code class="ruby">  2, 14, :_reduce_5,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="821">
          
          
          <code class="ruby">  2, 14, :_reduce_6,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="822">
          
          
          <code class="ruby">  4, 14, :_reduce_7 ]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="823">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="824">
          <span class="hits">1</span>
          
          <code class="ruby">racc_reduce_n = 8</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="825">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="826">
          <span class="hits">1</span>
          
          <code class="ruby">racc_shift_n = 18</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="827">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="828">
          <span class="hits">1</span>
          
          <code class="ruby">racc_token_table = {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="829">
          
          
          <code class="ruby">  false =&gt; 0,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="830">
          
          
          <code class="ruby">  :error =&gt; 1,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="831">
          
          
          <code class="ruby">  :EQ =&gt; 2,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="832">
          
          
          <code class="ruby">  :AND =&gt; 3,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="833">
          
          
          <code class="ruby">  :OR =&gt; 4,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="834">
          
          
          <code class="ruby">  :LBRACKET =&gt; 5,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="835">
          
          
          <code class="ruby">  :RBRACKET =&gt; 6,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="836">
          
          
          <code class="ruby">  :FEATURE_PREFIX =&gt; 7,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="837">
          
          
          <code class="ruby">  :FEATURE_NAME =&gt; 8,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="838">
          
          
          <code class="ruby">  :VAR_PREFIX =&gt; 9,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="839">
          
          
          <code class="ruby">  :VAR_NAME =&gt; 10,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="840">
          
          
          <code class="ruby">  :VALUE =&gt; 11 }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="841">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="842">
          <span class="hits">1</span>
          
          <code class="ruby">racc_nt_base = 12</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="843">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="844">
          <span class="hits">1</span>
          
          <code class="ruby">racc_use_result_var = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="845">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="846">
          <span class="hits">1</span>
          
          <code class="ruby">Racc_arg = [</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="847">
          
          
          <code class="ruby">  racc_action_table,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="848">
          
          
          <code class="ruby">  racc_action_check,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="849">
          
          
          <code class="ruby">  racc_action_default,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="850">
          
          
          <code class="ruby">  racc_action_pointer,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="851">
          
          
          <code class="ruby">  racc_goto_table,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="852">
          
          
          <code class="ruby">  racc_goto_check,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="853">
          
          
          <code class="ruby">  racc_goto_default,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="854">
          
          
          <code class="ruby">  racc_goto_pointer,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="855">
          
          
          <code class="ruby">  racc_nt_base,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="856">
          
          
          <code class="ruby">  racc_reduce_table,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="857">
          
          
          <code class="ruby">  racc_token_table,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="858">
          
          
          <code class="ruby">  racc_shift_n,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="859">
          
          
          <code class="ruby">  racc_reduce_n,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="860">
          
          
          <code class="ruby">  racc_use_result_var ]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="861">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="862">
          <span class="hits">1</span>
          
          <code class="ruby">Racc_token_to_s_table = [</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="863">
          
          
          <code class="ruby">  &quot;$end&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="864">
          
          
          <code class="ruby">  &quot;error&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="865">
          
          
          <code class="ruby">  &quot;EQ&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="866">
          
          
          <code class="ruby">  &quot;AND&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="867">
          
          
          <code class="ruby">  &quot;OR&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="868">
          
          
          <code class="ruby">  &quot;LBRACKET&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="869">
          
          
          <code class="ruby">  &quot;RBRACKET&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="870">
          
          
          <code class="ruby">  &quot;FEATURE_PREFIX&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="871">
          
          
          <code class="ruby">  &quot;FEATURE_NAME&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="872">
          
          
          <code class="ruby">  &quot;VAR_PREFIX&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="873">
          
          
          <code class="ruby">  &quot;VAR_NAME&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="874">
          
          
          <code class="ruby">  &quot;VALUE&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="875">
          
          
          <code class="ruby">  &quot;$start&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="876">
          
          
          <code class="ruby">  &quot;target&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="877">
          
          
          <code class="ruby">  &quot;exp&quot; ]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="878">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="879">
          <span class="hits">1</span>
          
          <code class="ruby">Racc_debug_parser = false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="880">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="881">
          
          
          <code class="ruby">##### State transition tables end #####</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="882">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="883">
          
          
          <code class="ruby"># reduce 0 omitted</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="884">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="885">
          
          
          <code class="ruby"># reduce 1 omitted</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="886">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="887">
          
          
          <code class="ruby"># reduce 2 omitted</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="888">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="889">
          <span class="hits">1</span>
          
          <code class="ruby">module_eval(&lt;&lt;&#39;.,.,&#39;, &#39;parser.y&#39;, 18)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="890">
          
          
          <code class="ruby">  def _reduce_3(val, _values, result)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="891">
          
          
          <code class="ruby">     @eval.and </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="892">
          
          
          <code class="ruby">    result</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="893">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="894">
          
          
          <code class="ruby">.,.,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="895">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="896">
          <span class="hits">1</span>
          
          <code class="ruby">module_eval(&lt;&lt;&#39;.,.,&#39;, &#39;parser.y&#39;, 19)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="897">
          
          
          <code class="ruby">  def _reduce_4(val, _values, result)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="898">
          
          
          <code class="ruby">     @eval.or  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="899">
          
          
          <code class="ruby">    result</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="900">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="901">
          
          
          <code class="ruby">.,.,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="902">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="903">
          <span class="hits">1</span>
          
          <code class="ruby">module_eval(&lt;&lt;&#39;.,.,&#39;, &#39;parser.y&#39;, 21)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="904">
          
          
          <code class="ruby">  def _reduce_5(val, _values, result)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="905">
          
          
          <code class="ruby">     @eval.has_feature?(val[1])            </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="906">
          
          
          <code class="ruby">    result</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="907">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="908">
          
          
          <code class="ruby">.,.,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="909">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="910">
          <span class="hits">1</span>
          
          <code class="ruby">module_eval(&lt;&lt;&#39;.,.,&#39;, &#39;parser.y&#39;, 22)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="911">
          
          
          <code class="ruby">  def _reduce_6(val, _values, result)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="912">
          
          
          <code class="ruby">     @eval.has_variable?(val[1])           </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="913">
          
          
          <code class="ruby">    result</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="914">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="915">
          
          
          <code class="ruby">.,.,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="916">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="917">
          <span class="hits">1</span>
          
          <code class="ruby">module_eval(&lt;&lt;&#39;.,.,&#39;, &#39;parser.y&#39;, 23)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="918">
          
          
          <code class="ruby">  def _reduce_7(val, _values, result)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="919">
          
          
          <code class="ruby">     @eval.variable_value?(val[1], val[3]) </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="920">
          
          
          <code class="ruby">    result</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="921">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="922">
          
          
          <code class="ruby">.,.,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="923">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="924">
          <span class="hits">1</span>
          
          <code class="ruby">def _reduce_none(val, _values, result)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="925">
          
          
          <code class="ruby">  val[0]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="926">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="927">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="928">
          
          
          <code class="ruby">  end   # class LogicParser</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="929">
          
          
          <code class="ruby">  end   # module Fizzy</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="930">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="931">
          
          
          <code class="ruby"># ──────────────────────────────────────────────────────── Environment ← Core ──</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="932">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="933">
          
          
          <code class="ruby"># Utilities to retrieve informations about the host environment &amp; system.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="934">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="935">
          <span class="hits">1</span>
          
          <code class="ruby">module Fizzy::Environment</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="936">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="937">
          <span class="hits">1</span>
          
          <code class="ruby">  include Fizzy::IO</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="938">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="939">
          
          
          <code class="ruby">  # Find an executable called `name` in the `$PATH`.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="940">
          
          
          <code class="ruby">  # Note: `name` can also be a path pointing to the executable.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="941">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="942">
          <span class="hits">1</span>
          
          <code class="ruby">  def which?(name)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="943">
          
          
          <code class="ruby">    exts = ENV[&quot;PATHEXT&quot;] ? ENV[&quot;PATHEXT&quot;].split(&quot;;&quot;) : [&quot;&quot;]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="944">
          
          
          <code class="ruby">    ENV[&quot;PATH&quot;].split(File::PATH_SEPARATOR).each do |path|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="945">
          
          
          <code class="ruby">      exts.each do |ext|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="946">
          
          
          <code class="ruby">        exe = File.join(path, &quot;#{cmd}#{ext}&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="947">
          
          
          <code class="ruby">        return exe if File.executable?(exe) &amp;&amp; !File.directory?(exe)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="948">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="949">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="950">
          
          
          <code class="ruby">    return nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="951">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="952">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="953">
          
          
          <code class="ruby">  # Return the environment variable matching the provided `name`.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="954">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="955">
          <span class="hits">1</span>
          
          <code class="ruby">  def get_env(name, default: nil)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="956">
          
          
          <code class="ruby">    ENV[name.to_s] || default</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="957">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="958">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="959">
          
          
          <code class="ruby">  # Same of `get_env`, but raise an error if the environment variable hasn&#39;t</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="960">
          
          
          <code class="ruby">  # been found or is `nil`.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="961">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="962">
          <span class="hits">1</span>
          
          <code class="ruby">  def get_env!(name)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="963">
          
          
          <code class="ruby">    value = get_env(name)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="964">
          
          
          <code class="ruby">    error(&quot;Undefined environment variable: `#{name}`.&quot;) if value.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="965">
          
          
          <code class="ruby">    value</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="966">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="967">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="968">
          
          
          <code class="ruby">  # Check if the underlying operating system is MacOSX.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="969">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="970">
          <span class="hits">1</span>
          
          <code class="ruby">  def is_osx?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="971">
          
          
          <code class="ruby">    Fizzy::CFG.os == :osx</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="972">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="973">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="974">
          
          
          <code class="ruby">  # Check if the underlying operating system is GNU/Linux.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="975">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="976">
          <span class="hits">1</span>
          
          <code class="ruby">  def is_linux?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="977">
          
          
          <code class="ruby">    Fizzy::CFG.os == :linux</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="978">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="979">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="980">
          
          
          <code class="ruby">  # Check if the underlying operating system is Windows.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="981">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="982">
          <span class="hits">1</span>
          
          <code class="ruby">  def is_windows?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="983">
          
          
          <code class="ruby">    Fizzy::CFG.os == :windows</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="984">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="985">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="986">
          
          
          <code class="ruby">  # Execute a function, based on the underlying operating system.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="987">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="988">
          <span class="hits">1</span>
          
          <code class="ruby">  def case_os(osx: nil, linux: nil, windows: nil)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="989">
          
          
          <code class="ruby">    if is_osx?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="990">
          
          
          <code class="ruby">      osx.respond_to?(:call) ? osx.call : osx</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="991">
          
          
          <code class="ruby">    elsif is_linux?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="992">
          
          
          <code class="ruby">      linux.respond_to?(:call) ? linux.call : linux</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="993">
          
          
          <code class="ruby">    elsif is_windows?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="994">
          
          
          <code class="ruby">      windows.respond_to?(:call) ? windows.call : windows</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="995">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="996">
          
          
          <code class="ruby">      error(&quot;Unrecognized operating system.&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="997">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="998">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="999">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1000">
          <span class="hits">1</span>
          
          <code class="ruby">  def xdg_config_home(name)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1001">
          
          
          <code class="ruby">    Pathname.new(get_env(:XDG_CONFIG_HOME) || &quot;~/.config&quot;).</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1002">
          
          
          <code class="ruby">      expand_path.</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1003">
          
          
          <code class="ruby">      join(name.to_s)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1004">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1005">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1006">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1007">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1008">
          
          
          <code class="ruby"># ────────────────────────────────────────────────────────── Execution ← Core ──</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1009">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1010">
          
          
          <code class="ruby"># Utilities to start and manage programs execution.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1011">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1012">
          <span class="hits">1</span>
          
          <code class="ruby">module Fizzy::Execution</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1013">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1014">
          <span class="hits">1</span>
          
          <code class="ruby">  include Fizzy::IO</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1015">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1016">
          
          
          <code class="ruby">  # Execute the provided shell command (`cmd`).</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1017">
          
          
          <code class="ruby">  # If `as_su` is `true` the command is executed as super user</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1018">
          
          
          <code class="ruby">  # (i.e. as root, using sudo).</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1019">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1020">
          <span class="hits">1</span>
          
          <code class="ruby">  def exec_cmd(cmd, as_su: false, chdir: nil)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1021">
          
          
          <code class="ruby">    cmd = cmd.map(&amp;:to_s).map(&amp;:shell_escape).join(&quot; &quot;) if cmd.is_a?(Array)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1022">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1023">
          
          
          <code class="ruby">    full_cmd = as_su ? &quot;sudo #{cmd}&quot; : cmd</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1024">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1025">
          
          
          <code class="ruby">    run_mode = defined?(@run_mode) ? @run_mode : :normal</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1026">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1027">
          
          
          <code class="ruby">    really_run = case run_mode</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1028">
          
          
          <code class="ruby">                   when :normal then true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1029">
          
          
          <code class="ruby">                   when :paranoid</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1030">
          
          
          <code class="ruby">                     quiz(&quot;Do you want to run command `#{full_cmd}`&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1031">
          
          
          <code class="ruby">                   when :dry then false</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1032">
          
          
          <code class="ruby">                   else true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1033">
          
          
          <code class="ruby">                 end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1034">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1035">
          
          
          <code class="ruby">    if really_run || run_mode == :dry</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1036">
          
          
          <code class="ruby">      tell(as_su ? &quot;[sudo] #{cmd}&quot; : cmd, :magenta)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1037">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1038">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1039">
          
          
          <code class="ruby">    status = nil</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1040">
          
          
          <code class="ruby">    if really_run</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1041">
          
          
          <code class="ruby">      if chdir</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1042">
          
          
          <code class="ruby">        FileUtils.cd(chdir) do</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1043">
          
          
          <code class="ruby">          status = system(full_cmd)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1044">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1045">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1046">
          
          
          <code class="ruby">        status = system(full_cmd)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1047">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1048">
          
          
          <code class="ruby">      warning(&quot;Command `#{full_cmd}` failed.&quot;) unless status</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1049">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1050">
          
          
          <code class="ruby">    status</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1051">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1052">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1053">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1054">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1055">
          
          
          <code class="ruby"># ───────────────────────────────────────────────────────── Filesystem ← Core ──</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1056">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1057">
          
          
          <code class="ruby"># Utilities to interact with the filesystem.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1058">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1059">
          <span class="hits">1</span>
          
          <code class="ruby">module Fizzy::Filesystem</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1060">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1061">
          <span class="hits">1</span>
          
          <code class="ruby">  include Fizzy::IO</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1062">
          <span class="hits">1</span>
          
          <code class="ruby">  include Fizzy::Execution</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1063">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1064">
          
          
          <code class="ruby">  # Find a YAML file prefixed by `path` (guess extension name).</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1065">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1066">
          <span class="hits">1</span>
          
          <code class="ruby">  def find_yaml_path(path)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1067">
          
          
          <code class="ruby">    if path.file?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1068">
          
          
          <code class="ruby">      path</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1069">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1070">
          
          
          <code class="ruby">      %w(yml yaml).map do |ext|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1071">
          
          
          <code class="ruby">        p = Pathname.new(&quot;#{path}.#{ext}&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1072">
          
          
          <code class="ruby">        p if p.file?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1073">
          
          
          <code class="ruby">      end.compact.first</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1074">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1075">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1076">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1077">
          
          
          <code class="ruby">  # Check if the provided `path` is an existing directory.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1078">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1079">
          
          
          <code class="ruby">  # If `writable` is true, also check if `path` points to a writable</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1080">
          
          
          <code class="ruby">  # directory.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1081">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1082">
          <span class="hits">1</span>
          
          <code class="ruby">  def existing_dir(path, writable: true)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1083">
          
          
          <code class="ruby">    dir_path = path</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1084">
          
          
          <code class="ruby">    dir_path = dir_path.dirname until dir_path.directory?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1085">
          
          
          <code class="ruby">    (writable &amp;&amp; !dir_path.writable?) ? nil : dir_path</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1086">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1087">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1088">
          
          
          <code class="ruby">  # Return an object (`OpenStruct`), which contains all of the well-known</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1089">
          
          
          <code class="ruby">  # paths.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1090">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1091">
          
          
          <code class="ruby">  # Before adding a path, some validations are executed to ensure that path</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1092">
          
          
          <code class="ruby">  # points to a correct thing.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1093">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1094">
          
          
          <code class="ruby">  # You can skip some validations and filling some paths:</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1095">
          
          
          <code class="ruby">  # - `valid_cfg`:</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1096">
          
          
          <code class="ruby">  #   - If `false` don&#39;t validate and fill paths related to the configuration.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1097">
          
          
          <code class="ruby">  #   - If `readonly`, don&#39;t validate writability for configuration.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1098">
          
          
          <code class="ruby">  # - `valid_inst`:</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1099">
          
          
          <code class="ruby">  #   - If `false` don&#39;t validate and fill paths related to the configuration</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1100">
          
          
          <code class="ruby">  #     instances.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1101">
          
          
          <code class="ruby">  #   - If `true`, be sure to provide the argument `cur_inst_name`, which</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1102">
          
          
          <code class="ruby">  #     should contain the name of the current instance (the instance that</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1103">
          
          
          <code class="ruby">  #     should be used).</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1104">
          
          
          <code class="ruby">  #   - If `readonly`, don&#39;t validate writability for instance.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1105">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1106">
          <span class="hits">1</span>
          
          <code class="ruby">  def prepare_storage(root_path,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1107">
          
          
          <code class="ruby">                      valid_meta: true, valid_cfg: true, valid_inst: true,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1108">
          
          
          <code class="ruby">                      meta_name: nil, cur_cfg_name: nil, cur_inst_name: nil)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1109">
          
          
          <code class="ruby">    root_path = Pathname.new(root_path).expand_path</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1110">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1111">
          
          
          <code class="ruby">    # Paths based on internal conventions.</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1112">
          
          
          <code class="ruby">    parent_path = root_path.dirname</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1113">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1114">
          
          
          <code class="ruby">    cfg_path = root_path.join(&quot;cfg&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1115">
          
          
          <code class="ruby">    cur_cfg_path = cfg_path.join(cur_cfg_name) if cur_cfg_name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1116">
          
          
          <code class="ruby">    cur_cfg_vars_path = cur_cfg_path.join(&quot;vars&quot;) if cur_cfg_path</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1117">
          
          
          <code class="ruby">    cur_cfg_meta_path = find_yaml_path(cur_cfg_path.join(meta_name)) if cur_cfg_path &amp;&amp; meta_name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1118">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1119">
          
          
          <code class="ruby">    inst_path = root_path.join(&quot;inst&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1120">
          
          
          <code class="ruby">    cur_inst_path = inst_path.join(cur_inst_name) if cur_inst_name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1121">
          
          
          <code class="ruby">    cur_inst_vars_path = cur_inst_path.join(&quot;vars&quot;) if cur_inst_path</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1122">
          
          
          <code class="ruby">    cur_inst_meta_path = find_yaml_path(cur_inst_path.join(meta_name)) if cur_inst_path &amp;&amp; meta_name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1123">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1124">
          
          
          <code class="ruby">    # Validate `root_path`.</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1125">
          
          
          <code class="ruby">    if !root_path.directory? &amp;&amp; !parent_path.writable?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1126">
          
          
          <code class="ruby">      error(&quot;Cannot create directory: `#{root_path}`.&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1127">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1128">
          
          
          <code class="ruby">    if root_path.file?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1129">
          
          
          <code class="ruby">      if quiz(&quot;`#{root_path}` already exists but is a regular file. Remove&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1130">
          
          
          <code class="ruby">        exec_cmd(&quot;rm #{root_path.shell_escape}&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1131">
          
          
          <code class="ruby">                 as_su: File.owned?(root_path))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1132">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1133">
          
          
          <code class="ruby">        error(&quot;File `#{root_path}` already exists but is needed as fizzy &quot; +</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1134">
          
          
          <code class="ruby">              &quot;root directory. Aborting.&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1135">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1136">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1137">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1138">
          
          
          <code class="ruby">    # XXX This check is for preventing errors when we don&#39;t want to create the</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1139">
          
          
          <code class="ruby">    #     directory structure. Should we add a dedicate argument?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1140">
          
          
          <code class="ruby">    if !valid_cfg &amp;&amp; !valid_inst &amp;&amp; root_path.directory? &amp;&amp; !root_path.writable?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1141">
          
          
          <code class="ruby">      error(&quot;No write permissions in Fizzy storage at path `#{root_path}`.&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1142">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1143">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1144">
          
          
          <code class="ruby">    if valid_cfg</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1145">
          
          
          <code class="ruby">      unless root_path.directory?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1146">
          
          
          <code class="ruby">        error(&quot;The Fizzy root directory `#{root_path}` doesn&#39;t exist &quot; +</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1147">
          
          
          <code class="ruby">              &quot;(maybe you need to run: `fizzy cfg sync`).&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1148">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1149">
          
          
          <code class="ruby">      if cur_cfg_path.nil? || !cur_cfg_path.directory? || !(valid_cfg == :readonly || cur_cfg_path.writable?)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1150">
          
          
          <code class="ruby">        error(&quot;The current configuration `#{cur_cfg_name}` is invalid: &quot; +</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1151">
          
          
          <code class="ruby">              &quot;it&#39;s not a valid directory.&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1152">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1153">
          
          
          <code class="ruby">      if valid_meta &amp;&amp; (cur_cfg_meta_path.nil? || !cur_cfg_meta_path.file?)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1154">
          
          
          <code class="ruby">        error(&quot;The meta file path `#{cur_cfg_meta_path}` is invalid.&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1155">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1156">
          
          
          <code class="ruby">      if cur_cfg_vars_path.nil? || !cur_cfg_vars_path.directory?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1157">
          
          
          <code class="ruby">        error(&quot;The variables directory `#{cur_cfg_vars_path}` is invalid.&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1158">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1159">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1160">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1161">
          
          
          <code class="ruby">    if valid_inst</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1162">
          
          
          <code class="ruby">      unless root_path.directory?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1163">
          
          
          <code class="ruby">        error(&quot;The Fizzy root directory `#{root_path}` doesn&#39;t exist &quot; +</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1164">
          
          
          <code class="ruby">              &quot;(maybe you need to run: `fizzy cfg sync`).&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1165">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1166">
          
          
          <code class="ruby">      if cur_inst_path.nil? || !cur_inst_path.directory? || !(valid_inst == :readonly || cur_inst_path.writable?)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1167">
          
          
          <code class="ruby">        error(&quot;The current instance `#{cur_inst_name}` is invalid: it&#39;s &quot; +</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1168">
          
          
          <code class="ruby">              &quot;not a valid directory.&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1169">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1170">
          
          
          <code class="ruby">      if valid_meta &amp;&amp; (cur_inst_meta_path.nil? || !cur_inst_meta_path.file?)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1171">
          
          
          <code class="ruby">        error(&quot;The meta file path `#{cur_inst_meta_path}` is invalid.&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1172">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1173">
          
          
          <code class="ruby">      if cur_inst_vars_path.nil? || !cur_inst_vars_path.directory?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1174">
          
          
          <code class="ruby">        error(&quot;The variables directory `#{cur_inst_vars_path}` is invalid.&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1175">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1176">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1177">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1178">
          
          
          <code class="ruby">    # Create non-existing internal directories.</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1179">
          
          
          <code class="ruby">    FileUtils.mkdir_p(root_path) unless root_path.directory?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1180">
          
          
          <code class="ruby">    [cfg_path, inst_path].each do |dir_path|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1181">
          
          
          <code class="ruby">      unless dir_path.directory?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1182">
          
          
          <code class="ruby">        FileUtils.mkdir_p(dir_path)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1183">
          
          
          <code class="ruby">        exec_cmd(&quot;chmod a+w #{dir_path.shell_escape}&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1184">
          
          
          <code class="ruby">                 as_su: File.owned?(dir_path))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1185">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1186">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1187">
          
          
          <code class="ruby">    if cur_inst_path &amp;&amp; !cur_inst_path.directory?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1188">
          
          
          <code class="ruby">      FileUtils.mkdir_p(cur_inst_path)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1189">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1190">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1191">
          
          
          <code class="ruby">    # Return the known storage paths.</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1192">
          
          
          <code class="ruby">    OpenStruct.new(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1193">
          
          
          <code class="ruby">      root:          root_path,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1194">
          
          
          <code class="ruby">      cfg:           cfg_path,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1195">
          
          
          <code class="ruby">      cur_cfg:       cur_cfg_path,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1196">
          
          
          <code class="ruby">      cur_cfg_vars:  cur_cfg_vars_path,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1197">
          
          
          <code class="ruby">      cur_cfg_meta:  cur_cfg_meta_path,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1198">
          
          
          <code class="ruby">      inst:          inst_path,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1199">
          
          
          <code class="ruby">      cur_inst:      cur_inst_path,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1200">
          
          
          <code class="ruby">      cur_inst_vars: cur_inst_vars_path,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1201">
          
          
          <code class="ruby">      cur_inst_meta: cur_inst_meta_path)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1202">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1203">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1204">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1205">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1206">
          
          
          <code class="ruby"># ─────────────────────────────────────────────────────── Setup ← Vars ← Core ──</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1207">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1208">
          <span class="hits">1</span>
          
          <code class="ruby">module Fizzy::Vars</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1209">
          <span class="hits">1</span>
          
          <code class="ruby">  class Setup</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1210">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1211">
          <span class="hits">1</span>
          
          <code class="ruby">    include Fizzy::IO</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1212">
          <span class="hits">1</span>
          
          <code class="ruby">    include Fizzy::Filesystem</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1213">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1214">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize(vars_dir_path, name, bindings)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1215">
          
          
          <code class="ruby">      @binding = bindings</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1216">
          
          
          <code class="ruby">      @vars_dir_path = vars_dir_path</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1217">
          
          
          <code class="ruby">      @name          = name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1218">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1219">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1220">
          
          
          <code class="ruby">    # Setup the variables that will be used during ERB processing.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1221">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1222">
          
          
          <code class="ruby">    # Those variables will be set into an instance field called `@vars`.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1223">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1224">
          
          
          <code class="ruby">    # After calling this method, you can directly access the variables using</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1225">
          
          
          <code class="ruby">    # `@vars` or using the attribute reader `vars`.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1226">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1227">
          <span class="hits">1</span>
          
          <code class="ruby">    def run</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1228">
          
          
          <code class="ruby">      setup_vars(@vars_dir_path, @name)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1229">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1230">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1231">
          <span class="hits">1</span>
          
          <code class="ruby">  protected</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1232">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1233">
          <span class="hits">1</span>
          
          <code class="ruby">    def setup_vars(vars_dir_path, name)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1234">
          
          
          <code class="ruby">      fmt, content = read_vars(vars_dir_path, name)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1235">
          
          
          <code class="ruby">      error(&quot;Invalid vars: `#{name}`.&quot;) if fmt == nil || content == nil</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1236">
          
          
          <code class="ruby">      self_vars    = parse_vars(name, fmt, content)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1237">
          
          
          <code class="ruby">      parents      = parse_parents_vars(fmt, content)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1238">
          
          
          <code class="ruby">      parents_vars = merge_parents_vars(vars_dir_path, parents)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1239">
          
          
          <code class="ruby">      merge_with_parents_vars(self_vars, parents_vars)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1240">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1241">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1242">
          <span class="hits">1</span>
          
          <code class="ruby">    def read_vars(vars_dir_path, name)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1243">
          
          
          <code class="ruby">      yaml_file_path = find_yaml_path(vars_dir_path.join(name)) unless vars_dir_path.nil? || name.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1244">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1245">
          
          
          <code class="ruby">      if yaml_file_path</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1246">
          
          
          <code class="ruby">        [:yaml, File.read(yaml_file_path)]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1247">
          
          
          <code class="ruby">      elsif !name.nil? &amp;&amp; ENV.has_key?(name)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1248">
          
          
          <code class="ruby">        [:json, ENV[name]]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1249">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1250">
          
          
          <code class="ruby">        [nil, nil]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1251">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1252">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1253">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1254">
          <span class="hits">1</span>
          
          <code class="ruby">    def parse_vars(name, fmt, content)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1255">
          
          
          <code class="ruby">      content = ERB.new(content).result(@binding)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1256">
          
          
          <code class="ruby">      case fmt</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1257">
          
          
          <code class="ruby">        when :yaml</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1258">
          
          
          <code class="ruby">          begin</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1259">
          
          
          <code class="ruby">            YAML.load(content) || {}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1260">
          
          
          <code class="ruby">          rescue Psych::SyntaxError =&gt; e</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1261">
          
          
          <code class="ruby">            error(&quot;Invalid syntax in YAML `#{name}`: #{e.message}&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1262">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1263">
          
          
          <code class="ruby">        when :json</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1264">
          
          
          <code class="ruby">          begin</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1265">
          
          
          <code class="ruby">            JSON.parse(content)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1266">
          
          
          <code class="ruby">          rescue JSON::JSONError =&gt; e</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1267">
          
          
          <code class="ruby">            error(&quot;Invalid JSON `#{name}`: #{e.message}.&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1268">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1269">
          
          
          <code class="ruby">        else error(&quot;Unrecognized format: `#{fmt}`&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1270">
          
          
          <code class="ruby">      end.deep_symbolize_keys</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1271">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1272">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1273">
          <span class="hits">1</span>
          
          <code class="ruby">    def parse_parents_vars(fmt, content)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1274">
          
          
          <code class="ruby">      parents_regexp = case fmt</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1275">
          
          
          <code class="ruby">                         when :yaml then Fizzy::CFG.vars.yaml_regexp</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1276">
          
          
          <code class="ruby">                         when :json then Fizzy::CFG.vars.json_regexp</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1277">
          
          
          <code class="ruby">                         else       error(&quot;Unrecognized format: `#{fmt}`.&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1278">
          
          
          <code class="ruby">                       end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1279">
          
          
          <code class="ruby">      if md = content.match(parents_regexp)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1280">
          
          
          <code class="ruby">        md[:parents].split(&quot;,&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1281">
          
          
          <code class="ruby">                    .map(&amp;:strip)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1282">
          
          
          <code class="ruby">                    .reject{|p| p =~ Fizzy::CFG.vars.parent_dummy_regexp}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1283">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1284">
          
          
          <code class="ruby">        []</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1285">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1286">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1287">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1288">
          <span class="hits">1</span>
          
          <code class="ruby">    def merge_with_parents_vars(self_vars, parents_vars)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1289">
          
          
          <code class="ruby">      parents_vars.deep_merge(self_vars)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1290">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1291">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1292">
          <span class="hits">1</span>
          
          <code class="ruby">    def merge_parents_vars(vars_dir_path, parents)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1293">
          
          
          <code class="ruby">      parents.inject([]) do |acc, parent| # Vars for each parent.</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1294">
          
          
          <code class="ruby">        parent_vars = setup_vars(vars_dir_path, parent)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1295">
          
          
          <code class="ruby">        acc &lt;&lt; parent_vars</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1296">
          
          
          <code class="ruby">      end.inject({}) do |acc, parent_vars| # Merge them.</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1297">
          
          
          <code class="ruby">        acc.deep_merge(parent_vars)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1298">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1299">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1300">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1301">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1302">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1303">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1304">
          
          
          <code class="ruby"># ───────────────────────────────────────────────────── Filters ← Vars ← Core ──</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1305">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1306">
          <span class="hits">1</span>
          
          <code class="ruby">module Fizzy::Vars</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1307">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1308">
          <span class="hits">1</span>
          
          <code class="ruby">  module Filters</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1309">
          <span class="hits">1</span>
          
          <code class="ruby">    def self.define(name, description: nil, &amp;block)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1310">
          <span class="hits">1</span>
          
          <code class="ruby">      @filters ||= []</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1311">
          <span class="hits">1</span>
          
          <code class="ruby">      @filters &lt;&lt; Filter.new(name, description.strip, &amp;block)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1312">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1313">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1314">
          <span class="hits">1</span>
          
          <code class="ruby">    def self.apply(blob)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1315">
          
          
          <code class="ruby">      if filter = (@filters || []).find{|f| f.match?(blob)}</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1316">
          
          
          <code class="ruby">        filter.apply(blob)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1317">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1318">
          
          
          <code class="ruby">        blob</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1319">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1320">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1321">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1322">
          <span class="hits">1</span>
          
          <code class="ruby">    class Filter</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1323">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1324">
          <span class="hits">1</span>
          
          <code class="ruby">      include Fizzy::IO</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1325">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1326">
          <span class="hits">1</span>
          
          <code class="ruby">      attr_reader :name, :desc</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1327">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1328">
          <span class="hits">1</span>
          
          <code class="ruby">      def initialize(name, desc, &amp;block)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1329">
          <span class="hits">1</span>
          
          <code class="ruby">        @name   = name</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1330">
          <span class="hits">1</span>
          
          <code class="ruby">        @desc   = desc</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1331">
          <span class="hits">1</span>
          
          <code class="ruby">        @block  = block</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1332">
          <span class="hits">1</span>
          
          <code class="ruby">        @regexp = /^&lt;\{\s*(?&lt;name&gt;#{@name})\s*(?&lt;args&gt;\S+)\s*\}&gt;$/</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1333">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1334">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1335">
          <span class="hits">1</span>
          
          <code class="ruby">      def match?(blob)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1336">
          
          
          <code class="ruby">        return false unless blob.is_a?(String) || blob.is_a?(Symbol)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1337">
          
          
          <code class="ruby">        @regexp =~ blob.to_s</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1338">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1339">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1340">
          <span class="hits">1</span>
          
          <code class="ruby">      def apply(blob)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1341">
          
          
          <code class="ruby">        md = @regexp.match(blob)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1342">
          
          
          <code class="ruby">        return if md.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1343">
          
          
          <code class="ruby">        args = md[:args]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1344">
          
          
          <code class="ruby">        def args.split_by_separator(sep=&quot;,&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1345">
          
          
          <code class="ruby">          self.split(/(?:\s*[#{sep}]\s*)/)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1346">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1347">
          
          
          <code class="ruby">        @block.call(args)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1348">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1349">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1350">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1351">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1352">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1353">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1354">
          
          
          <code class="ruby"># ─────────────────────────────────────────────────── Retriever ← Vars ← Core ──</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1355">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1356">
          <span class="hits">1</span>
          
          <code class="ruby">module Fizzy::Vars</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1357">
          <span class="hits">1</span>
          
          <code class="ruby">  class Retriever</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1358">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1359">
          <span class="hits">1</span>
          
          <code class="ruby">    include Fizzy::IO</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1360">
          <span class="hits">1</span>
          
          <code class="ruby">    include Fizzy::TypeSystem</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1361">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1362">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize(vars)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1363">
          
          
          <code class="ruby">      @vars = vars</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1364">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1365">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1366">
          
          
          <code class="ruby">    # Return the variables matching the provided `name`.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1367">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1368">
          
          
          <code class="ruby">    # The result is normally a list of the matching variables; but if `expand`</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1369">
          
          
          <code class="ruby">    # is `true`, empty list is expanded to `nil` and a list of one element is</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1370">
          
          
          <code class="ruby">    # expanded to that element.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1371">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1372">
          <span class="hits">1</span>
          
          <code class="ruby">    def get(var_name, type: nil, strict: false, single_match: false, expand: true)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1373">
          
          
          <code class="ruby">      var = _get_var(@vars, var_name, single_match: single_match)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1374">
          
          
          <code class="ruby">      var = _typize_var(var_name, var, type, strict)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1375">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1376">
          
          
          <code class="ruby">      if expand</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1377">
          
          
          <code class="ruby">        case var.length</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1378">
          
          
          <code class="ruby">          when 0 then nil</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1379">
          
          
          <code class="ruby">          when 1 then var.first</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1380">
          
          
          <code class="ruby">          else        var</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1381">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1382">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1383">
          
          
          <code class="ruby">        var</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1384">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1385">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1386">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1387">
          
          
          <code class="ruby">    # Accept a list of variables (`vars` argument) and ensure they are correctly</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1388">
          
          
          <code class="ruby">    # typed, according to `type`.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1389">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1390">
          
          
          <code class="ruby">    # See `Fizzy::TypeSystem#typize` for more details.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1391">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1392">
          <span class="hits">1</span>
          
          <code class="ruby">    protected def _typize_var(name, variable, type, strict)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1393">
          
          
          <code class="ruby">      Array(variable).map do |var|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1394">
          
          
          <code class="ruby">        typize(name, var, type: type, strict: strict)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1395">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1396">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1397">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1398">
          <span class="hits">1</span>
          
          <code class="ruby">    protected def _ensure_type!(name, var, *types)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1399">
          
          
          <code class="ruby">      if types.any?{|type| var.is_a?(type)}</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1400">
          
          
          <code class="ruby">        var</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1401">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1402">
          
          
          <code class="ruby">        error(&quot;Invalid type for variable `#{name}`: &quot; +</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1403">
          
          
          <code class="ruby">              &quot;it&#39;s not a `#{type.name}`.&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1404">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1405">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1406">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1407">
          
          
          <code class="ruby">    # Returns a list of variables matching the provided `name`, chosen from `vars`.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1408">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1409">
          
          
          <code class="ruby">    # The argument `single_match` can be one of `[:force, true, false]`, to</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1410">
          
          
          <code class="ruby">    # respectively force, restrict to, don&#39;t return a single match (the first).</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1411">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1412">
          
          
          <code class="ruby">    # This method effectively implements the logic to retrieve variables.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1413">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1414">
          <span class="hits">1</span>
          
          <code class="ruby">    protected def _get_var(vars, name, single_match: :force)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1415">
          
          
          <code class="ruby">      dot_split_regexp = /([^.]+)(?:\.|$)/</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1416">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1417">
          
          
          <code class="ruby">      name.to_s</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1418">
          
          
          <code class="ruby">          .scan(dot_split_regexp)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1419">
          
          
          <code class="ruby">          .map{|match_group| match_group[0]}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1420">
          
          
          <code class="ruby">          .reject(&amp;:empty?)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1421">
          
          
          <code class="ruby">          .inject(vars) do |current_objects, name_component|</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1422">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1423">
          
          
          <code class="ruby">        # Intermediate `current_objects` are lists because every step returns</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1424">
          
          
          <code class="ruby">        # a list.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1425">
          
          
          <code class="ruby">        # If a step is not-final (i.e. intermediate), we need to be sure there</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1426">
          
          
          <code class="ruby">        # is only one element.</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1427">
          
          
          <code class="ruby">        if current_objects.is_a?(Array)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1428">
          
          
          <code class="ruby">          if current_objects.length == 1</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1429">
          
          
          <code class="ruby">            current_objects = current_objects.first</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1430">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1431">
          
          
          <code class="ruby">            error(&quot;Variabile name diverges: multiple intermediate paths are &quot; +</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1432">
          
          
          <code class="ruby">                  &quot;taken (`[#{current_objects}]`).&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1433">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1434">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1435">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1436">
          
          
          <code class="ruby">        # Fill `next_objects`.</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1437">
          
          
          <code class="ruby">        next_objects = if current_objects.has_key?(name_component)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1438">
          
          
          <code class="ruby">                         # Exact match.</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1439">
          
          
          <code class="ruby">                         Array[current_objects[name_component]]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1440">
          
          
          <code class="ruby">                       elsif current_objects.has_key?(name_component.to_sym)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1441">
          
          
          <code class="ruby">                         # Exact match.</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1442">
          
          
          <code class="ruby">                         Array[current_objects[name_component.to_sym]]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1443">
          
          
          <code class="ruby">                       else</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1444">
          
          
          <code class="ruby">                         # Check if there are elements with key matching</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1445">
          
          
          <code class="ruby">                         # `name_component` as regexp.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1446">
          
          
          <code class="ruby">                         # Return `nil` if nothing is found.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1447">
          
          
          <code class="ruby">                         current_objects.select do |k, v|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1448">
          
          
          <code class="ruby">                           k.to_s =~ Regexp.new(/^#{name_component}$/)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1449">
          
          
          <code class="ruby">                         end.values</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1450">
          
          
          <code class="ruby">                       end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1451">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1452">
          
          
          <code class="ruby">        # Filter `next_objects`.</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1453">
          
          
          <code class="ruby">        next_objects = next_objects.map{|e| Fizzy::Vars::Filters.apply(e)}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1454">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1455">
          
          
          <code class="ruby">        # Adjust `next_objects`, according to `single_match` argument.</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1456">
          
          
          <code class="ruby">        next_objects = if single_match</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1457">
          
          
          <code class="ruby">                         if single_match == :force &amp;&amp; next_objects.length != 1</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1458">
          
          
          <code class="ruby">                           error(&quot;Expected a single match for variable &quot; +</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1459">
          
          
          <code class="ruby">                                 &quot;`#{name}`, but instead got &quot; +</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1460">
          
          
          <code class="ruby">                                 &quot;`#{next_objects.length}`&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1461">
          
          
          <code class="ruby">                         end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1462">
          
          
          <code class="ruby">                         next_objects.first</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1463">
          
          
          <code class="ruby">                       else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1464">
          
          
          <code class="ruby">                         next_objects</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1465">
          
          
          <code class="ruby">                       end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1466">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1467">
          
          
          <code class="ruby">        if next_objects.nil? ||</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1468">
          
          
          <code class="ruby">           (next_objects.is_a?(Array) &amp;&amp; next_objects.empty?)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1469">
          
          
          <code class="ruby">          break nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1470">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1471">
          
          
          <code class="ruby">        next_objects</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1472">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1473">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1474">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1475">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1476">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1477">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1478">
          
          
          <code class="ruby"># ───────────────────────────────────────────────────────── Api ← Vars ← Core ──</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1479">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1480">
          <span class="hits">1</span>
          
          <code class="ruby">module Fizzy::Vars</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1481">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1482">
          <span class="hits">1</span>
          
          <code class="ruby">  include Fizzy::IO</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1483">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1484">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_reader :vars</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1485">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1486">
          
          
          <code class="ruby">  # Return a list of the available variables files.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1487">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1488">
          <span class="hits">1</span>
          
          <code class="ruby">  def avail_vars(vars_dir_path)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1489">
          
          
          <code class="ruby">    Pathname.glob(vars_dir_path.join(&quot;*&quot;))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1490">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1491">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1492">
          
          
          <code class="ruby">  # See `Fizzy::Vars::Setup#run`</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1493">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1494">
          <span class="hits">1</span>
          
          <code class="ruby">  def setup_vars(vars_dir_path, name)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1495">
          
          
          <code class="ruby">    info(&quot;vars: &quot;, name)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1496">
          
          
          <code class="ruby">    @vars = Fizzy::Vars::Setup.new(vars_dir_path, name, binding).run()</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1497">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1498">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1499">
          
          
          <code class="ruby">  # See `Fizzy::Vars::Retriever#run`</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1500">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1501">
          <span class="hits">1</span>
          
          <code class="ruby">  def var(var_name, **opts)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1502">
          
          
          <code class="ruby">    Fizzy::Vars::Retriever.new(@vars).get(var_name, **opts)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1503">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1504">
          <span class="hits">1</span>
          
          <code class="ruby">  alias_method :get_var, :var # NOTE: For backward compatibility</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1505">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1506">
          
          
          <code class="ruby">  # Same of `var`, but raise an error if the variable hasn&#39;t been found or</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1507">
          
          
          <code class="ruby">  # is `nil`.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1508">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1509">
          <span class="hits">1</span>
          
          <code class="ruby">  def var!(var_name, **opts)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1510">
          
          
          <code class="ruby">    value = var(var_name, **opts)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1511">
          
          
          <code class="ruby">    value.nil? ? error(&quot;Undefined variable: `#{var_name}`.&quot;) : value</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1512">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1513">
          <span class="hits">1</span>
          
          <code class="ruby">  alias_method :get_var!, :var! # NOTE: For backward compatibility</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1514">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1515">
          
          
          <code class="ruby">  # Check if the feature with the provided name (`feature_name`) is enabled.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1516">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1517">
          
          
          <code class="ruby">  # Since the features are defined just using variables, before calling this</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1518">
          
          
          <code class="ruby">  # method be sure that `setup_vars` has already been called.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1519">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1520">
          <span class="hits">1</span>
          
          <code class="ruby">  def has_feature?(feature_name)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1521">
          
          
          <code class="ruby">    get_var!(&quot;features&quot;, single_match: :force).include?(feature_name.to_s)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1522">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1523">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1524">
          
          
          <code class="ruby">  # Filter the values associated to the features, keeping only those</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1525">
          
          
          <code class="ruby">  # associated to available features.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1526">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1527">
          <span class="hits">1</span>
          
          <code class="ruby">  def data_for_features(info, sep: nil)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1528">
          
          
          <code class="ruby">    data = []</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1529">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1530">
          
          
          <code class="ruby">    info.each do |feature_name, associated_value|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1531">
          
          
          <code class="ruby">      if has_feature?(feature_name.to_sym)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1532">
          
          
          <code class="ruby">        if associated_value.respond_to?(:call)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1533">
          
          
          <code class="ruby">          data &lt;&lt; associated_value.call</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1534">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1535">
          
          
          <code class="ruby">          data &lt;&lt; associated_value</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1536">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1537">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1538">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1539">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1540">
          
          
          <code class="ruby">    if data.length == 1</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1541">
          
          
          <code class="ruby">      def data.inspect</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1542">
          
          
          <code class="ruby">        first</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1543">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1544">
          
          
          <code class="ruby">    elsif sep</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1545">
          
          
          <code class="ruby">      def data.inspect</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1546">
          
          
          <code class="ruby">        join(sep)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1547">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1548">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1549">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1550">
          
          
          <code class="ruby">    data</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1551">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1552">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1553">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1554">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1555">
          
          
          <code class="ruby"># ───────────────────────────────────────────────────────────── Locals ← Core ──</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1556">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1557">
          <span class="hits">1</span>
          
          <code class="ruby">module Fizzy::Locals</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1558">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1559">
          <span class="hits">1</span>
          
          <code class="ruby">  extend Forwardable</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1560">
          <span class="hits">1</span>
          
          <code class="ruby">  include Fizzy::IO</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1561">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1562">
          <span class="hits">1</span>
          
          <code class="ruby">  def_delegators :@locals_proxy, :local, :local!, :local?, :prefix?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1563">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1564">
          
          
          <code class="ruby">  # Entry point for using the DSL defined by `Proxy` class.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1565">
          
          
          <code class="ruby">  # The DSL is directly accessible inside the provided block.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1566">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1567">
          <span class="hits">1</span>
          
          <code class="ruby">  def define_locals(&amp;block)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1568">
          
          
          <code class="ruby">    error(&quot;No requirements specification provided.&quot;) unless block_given?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1569">
          
          
          <code class="ruby">    @locals_proxy = Fizzy::Locals::Proxy.new(self)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1570">
          
          
          <code class="ruby">    @locals_proxy.instance_eval(&amp;block)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1571">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1572">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1573">
          
          
          <code class="ruby">  # DSL used for defining locals.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1574">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1575">
          <span class="hits">1</span>
          
          <code class="ruby">  class Proxy</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1576">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1577">
          <span class="hits">1</span>
          
          <code class="ruby">    include Fizzy::IO</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1578">
          <span class="hits">1</span>
          
          <code class="ruby">    include Fizzy::TypeSystem</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1579">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1580">
          <span class="hits">1</span>
          
          <code class="ruby">    attr_reader :locals</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1581">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1582">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize(receiver)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1583">
          
          
          <code class="ruby">      @receiver = receiver</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1584">
          
          
          <code class="ruby">      @locals   = {}</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1585">
          
          
          <code class="ruby">      @prefix   = nil</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1586">
          
          
          <code class="ruby">      @prefix_history = []</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1587">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1588">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1589">
          
          
          <code class="ruby">    # ──────────────────────────────────────────────────────────────────────────</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1590">
          
          
          <code class="ruby">    # ☞ DSL definition</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1591">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1592">
          
          
          <code class="ruby">    # Create a new `local` fetching the value from the corresponding `variable`.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1593">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1594">
          <span class="hits">1</span>
          
          <code class="ruby">    def variable(name, *args, **opts)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1595">
          
          
          <code class="ruby">      name = name.to_s.to_sym</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1596">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1597">
          
          
          <code class="ruby">      var = _get_var(name, **opts.slice(:type, :strict))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1598">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1599">
          
          
          <code class="ruby">      _set_local(opts.fetch(:as, name),</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1600">
          
          
          <code class="ruby">                 var.nil? ? opts.fetch(:default, nil) : var)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1601">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1602">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1603">
          
          
          <code class="ruby">    # Create a new computed `local`, based upon other locals.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1604">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1605">
          <span class="hits">1</span>
          
          <code class="ruby">    def computed(name, **typize_opts, &amp;block)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1606">
          
          
          <code class="ruby">      name = name.to_s.to_sym</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1607">
          
          
          <code class="ruby">      error(&quot;Invalid local name `#{name}`: it&#39;s blank.&quot;) if name.empty?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1608">
          
          
          <code class="ruby">      error(&quot;Cannot compute local `#{name}`.&quot;) unless block_given?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1609">
          
          
          <code class="ruby">      value = @receiver.instance_exec(&amp;block)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1610">
          
          
          <code class="ruby">      value = typize(name, value, **typize_opts) if typize_opts.length &gt; 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1611">
          
          
          <code class="ruby">      _set_local(name, value)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1612">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1613">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1614">
          
          
          <code class="ruby">    # Access the value of a local.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1615">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1616">
          <span class="hits">1</span>
          
          <code class="ruby">    def local(name)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1617">
          
          
          <code class="ruby">      @locals[name.to_s.to_sym]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1618">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1619">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1620">
          
          
          <code class="ruby">    # Access the value of a local or raise an error if it&#39;s not defined.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1621">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1622">
          <span class="hits">1</span>
          
          <code class="ruby">    def local!(name)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1623">
          
          
          <code class="ruby">      value = local(name)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1624">
          
          
          <code class="ruby">      error(&quot;Undefined local `#{name}`.&quot;) if value.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1625">
          
          
          <code class="ruby">      value</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1626">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1627">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1628">
          
          
          <code class="ruby">    # If all locals identified by `names` are available, evaluate the block</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1629">
          
          
          <code class="ruby">    # passing the locals&#39; values.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1630">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1631">
          <span class="hits">1</span>
          
          <code class="ruby">    def local?(*names, &amp;block)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1632">
          
          
          <code class="ruby">      names.collect{|name| local(name)}.compact.length == names.length</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1633">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1634">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1635">
          <span class="hits">1</span>
          
          <code class="ruby">    def prefixed(var, as: nil, optional: false)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1636">
          
          
          <code class="ruby">      error(&quot;A block is required&quot;) unless block_given?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1637">
          
          
          <code class="ruby">      unless @receiver.get_var(var.to_s.gsub(/\.$/, &quot;&quot;))</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1638">
          
          
          <code class="ruby">        return if optional</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1639">
          
          
          <code class="ruby">        error(&quot;Invalid variable prefix: `#{var}`.&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1640">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1641">
          
          
          <code class="ruby">      @prefix = {var: var, local: as}</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1642">
          
          
          <code class="ruby">      @prefix_history &lt;&lt; @prefix</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1643">
          
          
          <code class="ruby">      yield</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1644">
          
          
          <code class="ruby">      @prefix = nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1645">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1646">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1647">
          
          
          <code class="ruby">    # Return `true`, if a prefix starting with the provided `prefix` has</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1648">
          
          
          <code class="ruby">    # been defined; otherwise, `false`.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1649">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1650">
          <span class="hits">1</span>
          
          <code class="ruby">    def prefix?(prefix)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1651">
          
          
          <code class="ruby">      @prefix_history.any?{|p| p[:local].to_s.start_with?(prefix.to_s)}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1652">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1653">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1654">
          
          
          <code class="ruby">    # ──────────────────────────────────────────────────────────────────────────</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1655">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1656">
          <span class="hits">1</span>
          
          <code class="ruby">    def _get_var(name, **opts)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1657">
          
          
          <code class="ruby">      name = @prefix &amp;&amp; @prefix[:var] ? &quot;#{@prefix[:var]}#{name}&quot; : name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1658">
          
          
          <code class="ruby">      @receiver.get_var(name.to_s.to_sym, **opts)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1659">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1660">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1661">
          <span class="hits">1</span>
          
          <code class="ruby">    def _set_local(name, value)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1662">
          
          
          <code class="ruby">      name = @prefix &amp;&amp; @prefix[:local] ? &quot;#{@prefix[:local]}#{name}&quot; : name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1663">
          
          
          <code class="ruby">      @locals[name.to_s.to_sym] = value</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1664">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1665">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1666">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1667">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1668">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1669">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1670">
          
          
          <code class="ruby"># ────────────────────────────────────────────────────── Meta commands ← Core ──</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1671">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1672">
          
          
          <code class="ruby"># Manage commands declared in the meta file.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1673">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1674">
          <span class="hits">1</span>
          
          <code class="ruby">module Fizzy::MetaCommands</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1675">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1676">
          
          
          <code class="ruby">  # Return a data structure containing the commands that can be specified in</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1677">
          
          
          <code class="ruby">  # the meta file.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1678">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1679">
          
          
          <code class="ruby">  # The data structure defines:</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1680">
          
          
          <code class="ruby">  # - The available command types (`available_commands.keys`).</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1681">
          
          
          <code class="ruby">  # - (Optionally) A validator that can be used to validate type-specific</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1682">
          
          
          <code class="ruby">  #   validation rules.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1683">
          
          
          <code class="ruby">  # - The command executor: A `Lambda` containing the code used for executing</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1684">
          
          
          <code class="ruby">  #   that command.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1685">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1686">
          <span class="hits">1</span>
          
          <code class="ruby">  def available_commands</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1687">
          
          
          <code class="ruby">    { sync: {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1688">
          
          
          <code class="ruby">        validator: lambda { |spec|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1689">
          
          
          <code class="ruby">          if spec.has_key?(:dst)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1690">
          
          
          <code class="ruby">            spec[:dst] = Pathname.new(spec[:dst]).expand_path</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1691">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1692">
          
          
          <code class="ruby">          spec.has_key?(:repo) &amp;&amp; spec.has_key?(:dst)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1693">
          
          
          <code class="ruby">        },</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1694">
          
          
          <code class="ruby">        executor: lambda{|spec| Fizzy::Sync.perform(spec[:dst], spec[:repo])}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1695">
          
          
          <code class="ruby">      },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1696">
          
          
          <code class="ruby">      download: {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1697">
          
          
          <code class="ruby">        validator: lambda { |spec|</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1698">
          
          
          <code class="ruby">          # 1. Validate.</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1699">
          
          
          <code class="ruby">          status   = spec.has_key?(:url)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1700">
          
          
          <code class="ruby">          status &amp;&amp;= spec.has_key?(:dst)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1701">
          
          
          <code class="ruby">          # 2. Normalize.</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1702">
          
          
          <code class="ruby">          if status</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1703">
          
          
          <code class="ruby">            spec[:url] = URI(spec[:url])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1704">
          
          
          <code class="ruby">            spec[:dst] = Pathname.new(spec[:dst]).expand_path</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1705">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1706">
          
          
          <code class="ruby">          status</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1707">
          
          
          <code class="ruby">        },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1708">
          
          
          <code class="ruby">        executor: lambda { |spec|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1709">
          
          
          <code class="ruby">          res = Net::HTTP.get_response(spec[:url])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1710">
          
          
          <code class="ruby">          if res.is_a?(Net::HTTPSuccess)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1711">
          
          
          <code class="ruby">            # TODO atm it requires the current user has write access.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1712">
          
          
          <code class="ruby">            #      refactor when a more robust permission mgmt is implemented.</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1713">
          
          
          <code class="ruby">            FileUtils.mkdir_p(spec[:dst].dirname)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1714">
          
          
          <code class="ruby">            spec[:dst].write(res.body)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1715">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1716">
          
          
          <code class="ruby">            error(&quot;Network error: cannot retrieve `#{spec[:url]}`.&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1717">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1718">
          
          
          <code class="ruby">        }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1719">
          
          
          <code class="ruby">      }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1720">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1721">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1722">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1723">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1724">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1725">
          
          
          <code class="ruby"># ────────────────────────────────────────────────────────── Meta info ← Core ──</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1726">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1727">
          
          
          <code class="ruby"># Access informations declared in the meta file.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1728">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1729">
          <span class="hits">1</span>
          
          <code class="ruby">module Fizzy::MetaInfo</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1730">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1731">
          <span class="hits">1</span>
          
          <code class="ruby">  include Fizzy::IO</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1732">
          <span class="hits">1</span>
          
          <code class="ruby">  include Fizzy::Vars</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1733">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1734">
          
          
          <code class="ruby">  # Return the normalized and validated meta object.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1735">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1736">
          
          
          <code class="ruby">  # Be sure to call `setup_vars` before calling this method.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1737">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1738">
          <span class="hits">1</span>
          
          <code class="ruby">  def get_meta(meta_path, vars_path, elems_base_path, verbose)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1739">
          
          
          <code class="ruby">    tell(&quot;Getting meta informations.&quot;, :blue)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1740">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1741">
          
          
          <code class="ruby">    begin</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1742">
          
          
          <code class="ruby">      meta = YAML.load(File.read(meta_path)).deep_symbolize_keys</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1743">
          
          
          <code class="ruby">    rescue Psych::SyntaxError =&gt; exc</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1744">
          
          
          <code class="ruby">      error(&quot;Failed to parse meta file: `#{meta_path}`. &quot; +</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1745">
          
          
          <code class="ruby">            &quot;Reason: `#{exc.message}`.&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1746">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1747">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1748">
          
          
          <code class="ruby">    meta[:all_elems_count] = meta[:elems].count</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1749">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1750">
          
          
          <code class="ruby">    # ──────────────────────────────────────────────────────────────────────────</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1751">
          
          
          <code class="ruby">    # ☞ Step 1: Normalize elements</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1752">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1753">
          
          
          <code class="ruby">    elem_erb_excluded_fields = %i(only)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1754">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1755">
          
          
          <code class="ruby">    meta[:elems] = [] unless meta.has_key?(:elems)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1756">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1757">
          
          
          <code class="ruby">    meta[:elems] = meta[:elems].each_with_index.collect do |elem, idx|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1758">
          
          
          <code class="ruby">      elem_identifier = elem[:name] || &quot;src = #{elem[:src]}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1759">
          
          
          <code class="ruby">      info(&quot;\nElement: &quot;, elem_identifier) if verbose</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1760">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1761">
          
          
          <code class="ruby">      # Step 1.1: Validate `only` and determine if the element is selected.</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1762">
          
          
          <code class="ruby">      if elem.has_key?(:only) &amp;&amp; !(elem[:only].is_a?(Hash) || elem[:only].is_a?(String))</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1763">
          
          
          <code class="ruby">        error(&quot;The configuration element `#{elem_identifier}` has invalid &quot; +</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1764">
          
          
          <code class="ruby">              &quot;`only`: it&#39;s not a `Hash`.&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1765">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1766">
          
          
          <code class="ruby">      selected = selected_by_only?(elem[:only], verbose)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1767">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1768">
          
          
          <code class="ruby">      # Step 1.2: Pre-process strings with ERB.</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1769">
          
          
          <code class="ruby">      if selected</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1770">
          
          
          <code class="ruby">        elem.each do |k, v|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1771">
          
          
          <code class="ruby">          unless elem_erb_excluded_fields.include?(k)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1772">
          
          
          <code class="ruby">            elem[k] = ERB.new(v).result(binding)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1773">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1774">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1775">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1776">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1777">
          
          
          <code class="ruby">      # Step 1.3: Validate and normalize `name`, `src`, `dst`, `fs_maps`.</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1778">
          
          
          <code class="ruby">      if selected</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1779">
          
          
          <code class="ruby">        unless elem.has_key?(:src)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1780">
          
          
          <code class="ruby">          error(&quot;Element `#{elem_identifier}` doesn&#39;t contain `src`.&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1781">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1782">
          
          
          <code class="ruby">        elem[:name] = elem[:src] unless elem.has_key?(:name)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1783">
          
          
          <code class="ruby">        unless elem.has_key?(:dst)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1784">
          
          
          <code class="ruby">          error(&quot;Element `#{elem_identifier}` doesn&#39;t contain `dst`.&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1785">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1786">
          
          
          <code class="ruby">        elem[:fs_maps] = []</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1787">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1788">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1789">
          
          
          <code class="ruby">      selected ? elem : nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1790">
          
          
          <code class="ruby">    end.compact</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1791">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1792">
          
          
          <code class="ruby">    # Step 1.4: For each active elem, match the `src` field against the</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1793">
          
          
          <code class="ruby">    #           filesystem and determine filesystem mapping (`fs_maps`).</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1794">
          
          
          <code class="ruby">    meta[:elems].each do |elem|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1795">
          
          
          <code class="ruby">      found = false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1796">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1797">
          
          
          <code class="ruby">      Find.find(elems_base_path)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1798">
          
          
          <code class="ruby">          .select { |ebp| File.file?(ebp) }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1799">
          
          
          <code class="ruby">          .each do |subfile_path|</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1800">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1801">
          
          
          <code class="ruby">        subfile_rel_path = Pathname.new(subfile_path).relative_path_from(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1802">
          
          
          <code class="ruby">                           Pathname.new(elems_base_path)).to_s</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1803">
          
          
          <code class="ruby">        if md = Regexp.new(elem[:src]).match(subfile_rel_path.gsub(/\.tt$/, &#39;&#39;))</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1804">
          
          
          <code class="ruby">          found = true</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1805">
          
          
          <code class="ruby">          dst_path = elem[:dst].gsub(/&lt;([0-9]+)&gt;/) do</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1806">
          
          
          <code class="ruby">            idx = Integer($1)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1807">
          
          
          <code class="ruby">            unless (1..md.length) === idx</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1808">
          
          
          <code class="ruby">              error(&quot;Invalid `dst` for element `#{elem[:name]}`: nothing &quot; +</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1809">
          
          
          <code class="ruby">                    &quot;captured at index `#{idx}`.&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1810">
          
          
          <code class="ruby">            else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1811">
          
          
          <code class="ruby">              md[idx]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1812">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1813">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1814">
          
          
          <code class="ruby">          elem[:fs_maps] &lt;&lt; {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1815">
          
          
          <code class="ruby">            src_path: Pathname.new(subfile_path).expand_path,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1816">
          
          
          <code class="ruby">            dst_path: Pathname.new(dst_path).expand_path</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1817">
          
          
          <code class="ruby">          }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1818">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1819">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1820">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1821">
          
          
          <code class="ruby">      unless found</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1822">
          
          
          <code class="ruby">        warning(&quot;Inconsistency found for elem `#{elem[:name]}`: no file &quot; +</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1823">
          
          
          <code class="ruby">                &quot;matches src: `#{elem[:src]}`.&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1824">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1825">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1826">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1827">
          
          
          <code class="ruby">    # ──────────────────────────────────────────────────────────────────────────</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1828">
          
          
          <code class="ruby">    # ☞ Step 2: Normalize commands</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1829">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1830">
          
          
          <code class="ruby">    command_excluded_erb_fields = [:only]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1831">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1832">
          
          
          <code class="ruby">    meta[:commands] = [] unless meta.has_key?(:commands)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1833">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1834">
          
          
          <code class="ruby">    meta[:commands] = meta[:commands].each_with_index.collect do |spec, idx|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1835">
          
          
          <code class="ruby">      spec[:type] = spec[:type].to_sym</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1836">
          
          
          <code class="ruby">      spec[:name] ||= &quot;type = #{spec[:type]}, index = #{idx}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1837">
          
          
          <code class="ruby">      info(&quot;\nCommand: &quot;, spec[:name]) if verbose</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1838">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1839">
          
          
          <code class="ruby">      selected = selected_by_only?(spec[:only], verbose)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1840">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1841">
          
          
          <code class="ruby">      if selected</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1842">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1843">
          
          
          <code class="ruby">        # Step 2.2: Pre-process strings with ERB.</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1844">
          
          
          <code class="ruby">        spec.each do |key, value|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1845">
          
          
          <code class="ruby">          unless command_excluded_erb_fields.include?(key)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1846">
          
          
          <code class="ruby">            if value.is_a?(String)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1847">
          
          
          <code class="ruby">              spec[key] = ERB.new(value).result(binding)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1848">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1849">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1850">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1851">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1852">
          
          
          <code class="ruby">        # Step 2.3: Validate `type`, `validator`, `executor`.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1853">
          
          
          <code class="ruby">        if !spec.has_key?(:type) ||</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1854">
          
          
          <code class="ruby">           !available_commands.keys.include?(spec[:type])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1855">
          
          
          <code class="ruby">          error(&quot;The command `#{spec[:name]}` has invalid `type`: it&#39;s &quot; +</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1856">
          
          
          <code class="ruby">                &quot;not in `#{available_commands.keys}`.&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1857">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1858">
          
          
          <code class="ruby">        command = available_commands[spec[:type]]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1859">
          
          
          <code class="ruby">        if command.has_key?(:validator) &amp;&amp; !command[:validator].is_a?(Proc)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1860">
          
          
          <code class="ruby">          error(&quot;Invalid validator for command `#{spec[:name]}`: if &quot; +</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1861">
          
          
          <code class="ruby">                &quot;provided it should be a `Proc`.&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1862">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1863">
          
          
          <code class="ruby">        if !command.has_key?(:executor) || !command[:executor].is_a?(Proc)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1864">
          
          
          <code class="ruby">          error(&quot;Invalid executor for command `#{spec[:name]}`: it should &quot; +</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1865">
          
          
          <code class="ruby">                &quot;be a `Proc`.&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1866">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1867">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1868">
          
          
          <code class="ruby">        # Step 2.4: Use type-specific validator if it&#39;s defined.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1869">
          
          
          <code class="ruby">        if command.has_key?(:validator) &amp;&amp; (</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1870">
          
          
          <code class="ruby">             !command[:validator].is_a?(Proc) ||</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1871">
          
          
          <code class="ruby">             !command[:validator].call(spec)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1872">
          
          
          <code class="ruby">           )</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1873">
          
          
          <code class="ruby">          error(&quot;The validator for command `#{spec[:name]}` didn&#39;t pass.&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1874">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1875">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1876">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1877">
          
          
          <code class="ruby">      selected ? spec : nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1878">
          
          
          <code class="ruby">    end.compact</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1879">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1880">
          
          
          <code class="ruby">    # ──────────────────────────────────────────────────────────────────────────</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1881">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1882">
          
          
          <code class="ruby">    # Build the list of excluded files (needed by thor&#39;s `directory(..)`).</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1883">
          
          
          <code class="ruby">    all_files = Set.new(Find.find(elems_base_path)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1884">
          
          
          <code class="ruby">                            .map{|f| Pathname.new(f).expand_path}</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1885">
          
          
          <code class="ruby">                            .select{|f| f.file?})</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1886">
          
          
          <code class="ruby">    src_paths = Set.new(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1887">
          
          
          <code class="ruby">      meta[:elems].collect_concat do |elem|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1888">
          
          
          <code class="ruby">        elem[:fs_maps].map{|m| m[:src_path]}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1889">
          
          
          <code class="ruby">      end)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1890">
          
          
          <code class="ruby">    vars_files = Pathname.glob(vars_path.join(&quot;*&quot;), File::FNM_DOTMATCH)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1891">
          
          
          <code class="ruby">    meta[:system_files]    = Set.new(vars_files &lt;&lt; meta_path)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1892">
          
          
          <code class="ruby">    meta[:excluded_files]  = all_files - src_paths - meta[:system_files]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1893">
          
          
          <code class="ruby">    meta[:all_files_count] = all_files.count</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1894">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1895">
          
          
          <code class="ruby">    meta</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1896">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1897">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1898">
          
          
          <code class="ruby">  # Return whether the provided `only` specification is evaluated as an allow</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1899">
          
          
          <code class="ruby">  # (and not as a deny).</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1900">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1901">
          <span class="hits">1</span>
          
          <code class="ruby">  def selected_by_only?(only, verbose)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1902">
          
          
          <code class="ruby">    selected = if only.is_a?(Hash) # Evaluate `only` has a Hash.</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1903">
          
          
          <code class="ruby">      wants_features = only.has_key?(:features)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1904">
          
          
          <code class="ruby">      wants_vars     = only.has_key?(:vars)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1905">
          
          
          <code class="ruby">      if wants_features</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1906">
          
          
          <code class="ruby">        feat_ok = only[:features].any? do |feature|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1907">
          
          
          <code class="ruby">          case feature</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1908">
          
          
          <code class="ruby">            when Array then feature.all?{|f| has_feature?(f)}</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1909">
          
          
          <code class="ruby">            else            has_feature?(feature)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1910">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1911">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1912">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1913">
          
          
          <code class="ruby">        feat_ok = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1914">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1915">
          
          
          <code class="ruby">      vars_ok = wants_vars ?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1916">
          
          
          <code class="ruby">          only[:vars].any?{|var| !get_var(var, single_match: false).nil?} :</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1917">
          
          
          <code class="ruby">          true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1918">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1919">
          
          
          <code class="ruby">      (!wants_features &amp;&amp; !wants_vars) || (feat_ok &amp;&amp; vars_ok)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1920">
          
          
          <code class="ruby">    elsif only.is_a?(String) # Evaluate `only` has a logic expression.</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1921">
          
          
          <code class="ruby">      Fizzy::LogicParser.new.parse(self, only)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1922">
          
          
          <code class="ruby">    elsif only.nil? # By default, it&#39;s selected.</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1923">
          
          
          <code class="ruby">      selected = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1924">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1925">
          
          
          <code class="ruby">      error(&quot;`#{spec[:name]}` has invalid `only`.&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1926">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1927">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1928">
          
          
          <code class="ruby">    if verbose</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1929">
          
          
          <code class="ruby">      if selected</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1930">
          
          
          <code class="ruby">        if only.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1931">
          
          
          <code class="ruby">          info(&quot; ↳ &quot;, &quot;#{✔} (`only` is empty).&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1932">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1933">
          
          
          <code class="ruby">          info(&quot; ↳ &quot;, &quot;#{✔} (`only` is present and satisfied).&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1934">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1935">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1936">
          
          
          <code class="ruby">        info(&quot; ↳ &quot;, &quot;#{✘} (`only` didn&#39;t match).&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1937">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1938">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1939">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1940">
          
          
          <code class="ruby">    selected</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1941">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1942">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1943">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1944">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1945">
          
          
          <code class="ruby"># ────────────────────────────────────────────────────── Meta elements ← Core ──</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1946">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1947">
          
          
          <code class="ruby"># Manage elements declared in the meta file.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1948">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1949">
          <span class="hits">1</span>
          
          <code class="ruby">module Fizzy::MetaElements</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1950">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1951">
          <span class="hits">1</span>
          
          <code class="ruby">  include Fizzy::IO</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1952">
          <span class="hits">1</span>
          
          <code class="ruby">  include Fizzy::Execution</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1953">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1954">
          
          
          <code class="ruby">  # Return a list of functions capable to apply modifications on the system</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1955">
          
          
          <code class="ruby">  # based on the current elements configuration instance.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1956">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1957">
          
          
          <code class="ruby">  # In particular, an applier work for each element installed.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1958">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1959">
          <span class="hits">1</span>
          
          <code class="ruby">  def elements_appliers</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1960">
          
          
          <code class="ruby">    [ lambda { |elem| # Create parent directories.</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1961">
          
          
          <code class="ruby">        elem[:fs_maps].each do |m|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1962">
          
          
          <code class="ruby">          parent_dir = m[:dst_path].dirname</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1963">
          
          
          <code class="ruby">          if elem.has_key?(:perms)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1964">
          
          
          <code class="ruby">            l_ex_dir_path = f_noex_dir_path = parent_dir</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1965">
          
          
          <code class="ruby">            while !l_ex_dir_path.directory?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1966">
          
          
          <code class="ruby">              f_noex_dir_path = l_ex_dir_path</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1967">
          
          
          <code class="ruby">              l_ex_dir_path   = l_ex_dir_path.dirname</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1968">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1969">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1970">
          
          
          <code class="ruby">            l_ex_dir_path = f_noex_dir_path = nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1971">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1972">
          
          
          <code class="ruby">          # From here, we have the following variable set:</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1973">
          
          
          <code class="ruby">          # - `l_ex_dir_path`: Longest path prefix which points to an existing</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1974">
          
          
          <code class="ruby">          #                    directory.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1975">
          
          
          <code class="ruby">          # - `f_noex_dir_path`: Path of the first directory after the prefix</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1976">
          
          
          <code class="ruby">          #                      which points to an existing dir.</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1977">
          
          
          <code class="ruby">          if !parent_dir.directory?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1978">
          
          
          <code class="ruby">            exec_cmd(&quot;mkdir -p #{parent_dir.shell_escape}&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1979">
          
          
          <code class="ruby">                     as_su: !existing_dir(parent_dir))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1980">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1981">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1982">
          
          
          <code class="ruby">      },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1983">
          
          
          <code class="ruby">      lambda { |elem| # Create a symlink for each elements&#39; `src_path`.</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1984">
          
          
          <code class="ruby">        elem[:fs_maps].each do |m|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1985">
          
          
          <code class="ruby">          tell(&quot;  #{m[:src_path]} ← #{m[:dst_path]}&quot;) if @verbose</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1986">
          
          
          <code class="ruby">          cmd = &quot;ln -s&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1987">
          
          
          <code class="ruby">          should_link = if m[:dst_path].file?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1988">
          
          
          <code class="ruby">            if m[:dst_path].realpath != m[:src_path]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1989">
          
          
          <code class="ruby">              cmd &lt;&lt; &quot; -f&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1990">
          
          
          <code class="ruby">              quiz(&quot;The destination file `#{m[:dst_path]}` already &quot; +</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1991">
          
          
          <code class="ruby">                   &quot;exists. Overwrite&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1992">
          
          
          <code class="ruby">            else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1993">
          
          
          <code class="ruby">              false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1994">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1995">
          
          
          <code class="ruby">          elsif m[:dst_path].directory?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1996">
          
          
          <code class="ruby">            if quiz(&quot;The destination file `#{m[:dst_path]}` is a &quot; +</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1997">
          
          
          <code class="ruby">                    &quot;directory. Delete it&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="1998">
          
          
          <code class="ruby">              exec_cmd(&quot;rm -Rf #{m[:dst_path]}&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1999">
          
          
          <code class="ruby">                       as_su: !existing_dir(m[:dst_path].dirname))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2000">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2001">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2002">
          
          
          <code class="ruby">            # Link does not exist yet.</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2003">
          
          
          <code class="ruby">            true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2004">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2005">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2006">
          
          
          <code class="ruby">          if should_link</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2007">
          
          
          <code class="ruby">            cmd &lt;&lt; &quot; #{m[:src_path].shell_escape}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2008">
          
          
          <code class="ruby">            cmd &lt;&lt; &quot; #{m[:dst_path].shell_escape}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2009">
          
          
          <code class="ruby">            exec_cmd(cmd, as_su: !existing_dir(m[:dst_path].dirname))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2010">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2011">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2012">
          
          
          <code class="ruby">      },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2013">
          
          
          <code class="ruby">      lambda { |elem| # Change perms of the instantiated files (if specified).</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2014">
          
          
          <code class="ruby">        if elem.has_key?(:perms)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2015">
          
          
          <code class="ruby">          elem[:fs_maps].each do |m|</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2016">
          
          
          <code class="ruby">            tell(&quot;Changing permissions of #{m[:src_path]} to &quot; +</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2017">
          
          
          <code class="ruby">                 elem[:perms]) if @verbose</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2018">
          
          
          <code class="ruby">            exec_cmd(&quot;chmod -R #{elem[:perms].shell_escape} &quot; +</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2019">
          
          
          <code class="ruby">                     m[:src_path].shell_escape,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2020">
          
          
          <code class="ruby">                     as_su: !File.owned?(m[:src_path]))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2021">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2022">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2023">
          
          
          <code class="ruby">      }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2024">
          
          
          <code class="ruby">    ]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2025">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2026">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2027">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2028">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2029">
          
          
          <code class="ruby"># ──────────────────────────────────────────────────────── Base ← Sync ← Core ──</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2030">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2031">
          <span class="hits">1</span>
          
          <code class="ruby">module Fizzy::Sync</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2032">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2033">
          <span class="hits">1</span>
          
          <code class="ruby">  class &lt;&lt; self</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2034">
          <span class="hits">1</span>
          
          <code class="ruby">    include Fizzy::IO</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2035">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2036">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2037">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.available</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2038">
          
          
          <code class="ruby">    [ Fizzy::Sync::Local,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2039">
          
          
          <code class="ruby">      Fizzy::Sync::Git</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2040">
          
          
          <code class="ruby">    ]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2041">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2042">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2043">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.others(subject)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2044">
          
          
          <code class="ruby">    subject = subject.class unless subject.is_a?(Class)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2045">
          
          
          <code class="ruby">    result = available</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2046">
          
          
          <code class="ruby">    result.delete(subject)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2047">
          
          
          <code class="ruby">    result</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2048">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2049">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2050">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.enabled(local_dir_path, remote_url)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2051">
          
          
          <code class="ruby">    available.map{|e| e.new(local_dir_path, remote_url)}.select{|e| e.enabled?}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2052">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2053">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2054">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.selected(local_dir_path, remote_url)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2055">
          
          
          <code class="ruby">    enabled(local_dir_path, remote_url).first</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2056">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2057">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2058">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.perform(local_dir_path, remote_url)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2059">
          
          
          <code class="ruby">    synchronizer = selected(local_dir_path, remote_url)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2060">
          
          
          <code class="ruby">    tell(&quot;Using synchronizer: `#{colorize(synchronizer.name, :magenta)}`&quot;, :cyan)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2061">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2062">
          
          
          <code class="ruby">    status   = true</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2063">
          
          
          <code class="ruby">    status &amp;&amp;= synchronizer.update_remote if synchronizer.local_changed?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2064">
          
          
          <code class="ruby">    status &amp;&amp;= synchronizer.update_local  if synchronizer.remote_changed?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2065">
          
          
          <code class="ruby">    status</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2066">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2067">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2068">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2069">
          <span class="hits">1</span>
          
          <code class="ruby">class Fizzy::Sync::Base</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2070">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2071">
          <span class="hits">1</span>
          
          <code class="ruby">  include Fizzy::IO</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2072">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2073">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_reader :name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2074">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2075">
          <span class="hits">1</span>
          
          <code class="ruby">  def initialize(name, local_dir_path, remote_url)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2076">
          
          
          <code class="ruby">    must &quot;synchronizer name&quot;,    name,           be: :not_nil</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2077">
          
          
          <code class="ruby">    must &quot;local directory path&quot;, local_dir_path, be: Pathname</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2078">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2079">
          
          
          <code class="ruby">    @name           = name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2080">
          
          
          <code class="ruby">    @local_dir_path = local_dir_path</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2081">
          
          
          <code class="ruby">    @remote_url     = remote_url</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2082">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2083">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2084">
          
          
          <code class="ruby">  # Check if the current synchronizer is enabled.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2085">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2086">
          
          
          <code class="ruby">  # Note: inheritors should call the `super` method.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2087">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2088">
          
          
          <code class="ruby">  # Example:</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2089">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2090">
          
          
          <code class="ruby">  #   def enabled?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2091">
          
          
          <code class="ruby">  #     my_policy || super</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2092">
          
          
          <code class="ruby">  #   end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2093">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2094">
          <span class="hits">1</span>
          
          <code class="ruby">  def enabled?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2095">
          
          
          <code class="ruby">    return false if !@remote_url.nil? &amp;&amp;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2096">
          
          
          <code class="ruby">                    Fizzy::Sync.others(self).any? { |e|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2097">
          
          
          <code class="ruby">                      @remote_url.start_with?(&quot;#{e.name}:&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2098">
          
          
          <code class="ruby">                    }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2099">
          
          
          <code class="ruby">    return true if default? &amp;&amp; Fizzy::Sync.others(self).</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2100">
          
          
          <code class="ruby">      map  { |e| e.new(@local_dir_path, @remote_url) }.</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2101">
          
          
          <code class="ruby">      all? { |e| !e.enabled? }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2102">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2103">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2104">
          
          
          <code class="ruby">  # Check if the current synchronizer is the default synchronizer.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2105">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2106">
          <span class="hits">1</span>
          
          <code class="ruby">  def default?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2107">
          
          
          <code class="ruby">    self.class == Fizzy::Sync.available.last</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2108">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2109">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2110">
          
          
          <code class="ruby">  # Update local from the remote.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2111">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2112">
          <span class="hits">1</span>
          
          <code class="ruby">  abstract_method :update_local</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2113">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2114">
          
          
          <code class="ruby">  # Update remote from local.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2115">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2116">
          <span class="hits">1</span>
          
          <code class="ruby">  abstract_method :update_remote</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2117">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2118">
          
          
          <code class="ruby">  # Check if local is changed, and now is different from latest remote state.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2119">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2120">
          <span class="hits">1</span>
          
          <code class="ruby">  abstract_method :local_changed?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2121">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2122">
          
          
          <code class="ruby">  # Check if remote is changed, and now is different from latest local state.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2123">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2124">
          <span class="hits">1</span>
          
          <code class="ruby">  abstract_method :remote_changed?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2125">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2126">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2127">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2128">
          
          
          <code class="ruby"># ─────────────────────────────────────────────────────── Local ← Sync ← Core ──</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2129">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2130">
          <span class="hits">1</span>
          
          <code class="ruby">class Fizzy::Sync::Local &lt; Fizzy::Sync::Base</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2131">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2132">
          <span class="hits">1</span>
          
          <code class="ruby">  def initialize(local_dir_path, remote_url)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2133">
          
          
          <code class="ruby">    super(:local, local_dir_path, remote_url)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2134">
          
          
          <code class="ruby">    @remote_path = @remote_url.nil? ? nil : Pathname.new(@remote_url)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2135">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2136">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2137">
          
          
          <code class="ruby">  # Check if the synchronizer is enabled.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2138">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2139">
          <span class="hits">1</span>
          
          <code class="ruby">  def enabled?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2140">
          
          
          <code class="ruby">      ( super ||</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2141">
          
          
          <code class="ruby">        !@remote_path.nil? &amp;&amp; @remote_path.directory? ||</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2142">
          
          
          <code class="ruby">        local_valid_repo?)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2143">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2144">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2145">
          
          
          <code class="ruby">  # Update local from the remote.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2146">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2147">
          <span class="hits">1</span>
          
          <code class="ruby">  def update_local</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2148">
          
          
          <code class="ruby">    # TODO</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2149">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2150">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2151">
          
          
          <code class="ruby">  # Update remote from local.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2152">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2153">
          <span class="hits">1</span>
          
          <code class="ruby">  def update_remote</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2154">
          
          
          <code class="ruby">    # TODO</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2155">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2156">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2157">
          
          
          <code class="ruby">  # Check if local is changed, and now is different from latest remote state.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2158">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2159">
          <span class="hits">1</span>
          
          <code class="ruby">  def local_changed?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2160">
          
          
          <code class="ruby">    # TODO</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2161">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2162">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2163">
          
          
          <code class="ruby">  # Check if remote is changed, and now is different from latest local state.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2164">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2165">
          <span class="hits">1</span>
          
          <code class="ruby">  def remote_changed?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2166">
          
          
          <code class="ruby">    # TODO</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2167">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2168">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2169">
          
          
          <code class="ruby">  # Check if the local directory holds a valid local repository.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2170">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2171">
          <span class="hits">1</span>
          
          <code class="ruby">  def local_valid_repo?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2172">
          
          
          <code class="ruby">    @local_dir_path.directory?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2173">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2174">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2175">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2176">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2177">
          
          
          <code class="ruby"># ───────────────────────────────────────────────────────── Git ← Sync ← Core ──</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2178">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2179">
          <span class="hits">1</span>
          
          <code class="ruby">class Fizzy::Sync::Git &lt; Fizzy::Sync::Base</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2180">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2181">
          <span class="hits">1</span>
          
          <code class="ruby">  include Fizzy::IO</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2182">
          <span class="hits">1</span>
          
          <code class="ruby">  include Fizzy::Execution</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2183">
          <span class="hits">1</span>
          
          <code class="ruby">  include Fizzy::Filesystem</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2184">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2185">
          <span class="hits">1</span>
          
          <code class="ruby">  def initialize(local_dir_path, remote_url)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2186">
          
          
          <code class="ruby">    super(:git, local_dir_path, remote_url)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2187">
          
          
          <code class="ruby">    @remote_normalized_url = normalize_url(@remote_url)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2188">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2189">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2190">
          
          
          <code class="ruby">  # Check if the synchronizer is enabled.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2191">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2192">
          <span class="hits">1</span>
          
          <code class="ruby">  def enabled?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2193">
          
          
          <code class="ruby">    ( super ||</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2194">
          
          
          <code class="ruby">      !@remote_url.nil? &amp;&amp; @remote_url.start_with?(&quot;#{@name}:&quot;) ||</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2195">
          
          
          <code class="ruby">      local_valid_repo?)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2196">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2197">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2198">
          
          
          <code class="ruby">  # Update local from remote.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2199">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2200">
          <span class="hits">1</span>
          
          <code class="ruby">  def update_local</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2201">
          
          
          <code class="ruby">    if local_valid_repo?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2202">
          
          
          <code class="ruby">      # Update existing local from remote, i.e. perform `git pull`.</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2203">
          
          
          <code class="ruby">      tell &quot;Syncing from `origin` to local&quot;, :blue</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2204">
          
          
          <code class="ruby">      status   = perform_commit</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2205">
          
          
          <code class="ruby">      status &amp;&amp;= perform_pull</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2206">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2207">
          
          
          <code class="ruby">      # Update non-existing local from remote, i.e. perform `git clone`.</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2208">
          
          
          <code class="ruby">      perform_clone</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2209">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2210">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2211">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2212">
          
          
          <code class="ruby">  # Update remote from local.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2213">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2214">
          <span class="hits">1</span>
          
          <code class="ruby">  def update_remote</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2215">
          
          
          <code class="ruby">    tell &quot;Syncing from local to `origin`&quot;, :blue</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2216">
          
          
          <code class="ruby">    status   = perform_commit</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2217">
          
          
          <code class="ruby">    status &amp;&amp;= perform_push</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2218">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2219">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2220">
          
          
          <code class="ruby">  # Check if local is changed, and now is different from latest remote state.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2221">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2222">
          <span class="hits">1</span>
          
          <code class="ruby">  def local_changed?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2223">
          
          
          <code class="ruby">    tell &quot;Checking if local repository is changed&quot;, :blue</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2224">
          
          
          <code class="ruby">    return false unless local_valid_repo?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2225">
          
          
          <code class="ruby">    return true  if     working_tree_changes?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2226">
          
          
          <code class="ruby">    return true  if     perform_fetch &amp;&amp; should_push?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2227">
          
          
          <code class="ruby">    false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2228">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2229">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2230">
          
          
          <code class="ruby">  # Check if remote is changed, and now is different from latest local state.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2231">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2232">
          <span class="hits">1</span>
          
          <code class="ruby">  def remote_changed?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2233">
          
          
          <code class="ruby">    tell &quot;Checking if remote repository is changed&quot;, :blue</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2234">
          
          
          <code class="ruby">    return true unless local_valid_repo?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2235">
          
          
          <code class="ruby">    return true if     perform_fetch &amp;&amp; should_pull?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2236">
          
          
          <code class="ruby">    false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2237">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2238">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2239">
          <span class="hits">1</span>
          
          <code class="ruby">protected</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2240">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2241">
          
          
          <code class="ruby">  # Normalize the remote git URL.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2242">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2243">
          <span class="hits">1</span>
          
          <code class="ruby">  def normalize_url(url, default_protocol: :ssh)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2244">
          
          
          <code class="ruby">    return nil if url.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2245">
          
          
          <code class="ruby">    protocols = %i(https ssh)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2246">
          
          
          <code class="ruby">    url = url.gsub(/^#{@name}:/, &quot;&quot;) # Remove VCS name prefix (optional).</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2247">
          
          
          <code class="ruby">    regexp = %r{</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2248">
          
          
          <code class="ruby">      ^</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2249">
          
          
          <code class="ruby">      (?&lt;protocol&gt;#{protocols.map{|p| &quot;#{p}:&quot;}.join(&quot;|&quot;)})?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2250">
          
          
          <code class="ruby">      (?&lt;username&gt;[a-z0-9\-_]+)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2251">
          
          
          <code class="ruby">      \/</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2252">
          
          
          <code class="ruby">      (?&lt;repository&gt;[a-z0-9\-_]+)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2253">
          
          
          <code class="ruby">      $</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2254">
          
          
          <code class="ruby">    }xi</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2255">
          
          
          <code class="ruby">    md = url.match(regexp)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2256">
          
          
          <code class="ruby">    return url unless md</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2257">
          
          
          <code class="ruby">    protocol = (md[:protocol].gsub(/:$/, &quot;&quot;) || default_protocol).to_sym</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2258">
          
          
          <code class="ruby">    case protocol</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2259">
          
          
          <code class="ruby">      when :ssh   then &quot;git@github.com:#{md[:username]}/#{md[:repository]}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2260">
          
          
          <code class="ruby">      when :https then &quot;https://github.com/#{md[:username]}/#{md[:repository]}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2261">
          
          
          <code class="ruby">      else        error(&quot;Invalid protocol for `#{url}`: `#{protocol}` not in &quot; +</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2262">
          
          
          <code class="ruby">                        &quot;`[#{protocols.join(&quot;, &quot;)}]`.&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2263">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2264">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2265">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2266">
          
          
          <code class="ruby">  # Check if the local directory holds a valid git repository.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2267">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2268">
          <span class="hits">1</span>
          
          <code class="ruby">  def local_valid_repo?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2269">
          
          
          <code class="ruby">    @local_dir_path.directory? &amp;&amp; @local_dir_path.join(&quot;.git&quot;).directory?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2270">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2271">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2272">
          
          
          <code class="ruby">  # Get the Working Tree (local) changes.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2273">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2274">
          <span class="hits">1</span>
          
          <code class="ruby">  def working_tree_changes</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2275">
          
          
          <code class="ruby">    error &quot;Invalid local repo: `#{@local_dir_path}`&quot; unless local_valid_repo?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2276">
          
          
          <code class="ruby">    FileUtils.cd(@local_dir_path) do</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2277">
          
          
          <code class="ruby">      return `git status -uall --porcelain`.strip</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2278">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2279">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2280">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2281">
          
          
          <code class="ruby">  # Check if there are some changes in the Working Tree.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2282">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2283">
          <span class="hits">1</span>
          
          <code class="ruby">  def working_tree_changes?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2284">
          
          
          <code class="ruby">    !working_tree_changes.empty?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2285">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2286">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2287">
          
          
          <code class="ruby">  # Get a `Hash` containing information about the local and remote repository.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2288">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2289">
          <span class="hits">1</span>
          
          <code class="ruby">  def info</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2290">
          
          
          <code class="ruby">    error &quot;Invalid local repo: `#{@local_dir_path}`&quot; unless local_valid_repo?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2291">
          
          
          <code class="ruby">    FileUtils.cd(@local_dir_path) do</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2292">
          
          
          <code class="ruby">      local = `git rev-parse @ 2&gt; /dev/null`.strip</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2293">
          
          
          <code class="ruby">      local = nil unless $?.success?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2294">
          
          
          <code class="ruby">      remote = `git rev-parse @{u} 2&gt; /dev/null`.strip</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2295">
          
          
          <code class="ruby">      remote = nil unless $?.success?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2296">
          
          
          <code class="ruby">      base = `git merge-base @ @{u} 2&gt; /dev/null`.strip</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2297">
          
          
          <code class="ruby">      base = nil unless $?.success?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2298">
          
          
          <code class="ruby">      return { local: local, remote: remote, base: base }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2299">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2300">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2301">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2302">
          
          
          <code class="ruby">  # Check if a `pull` operation is needed.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2303">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2304">
          <span class="hits">1</span>
          
          <code class="ruby">  def should_pull?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2305">
          
          
          <code class="ruby">    info[:remote] != info[:base]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2306">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2307">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2308">
          
          
          <code class="ruby">  # Check if a `push` operation is needed.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2309">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2310">
          <span class="hits">1</span>
          
          <code class="ruby">  def should_push?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2311">
          
          
          <code class="ruby">    info[:local] != info[:base]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2312">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2313">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2314">
          
          
          <code class="ruby">  # Get the list of the available remote git repositories.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2315">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2316">
          <span class="hits">1</span>
          
          <code class="ruby">  def remotes</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2317">
          
          
          <code class="ruby">    error &quot;Invalid local repo: `#{@local_dir_path}`&quot; unless local_valid_repo?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2318">
          
          
          <code class="ruby">    FileUtils.cd(@local_dir_path) do</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2319">
          
          
          <code class="ruby">      return `git remote`.split(/\W+/).reject(&amp;:empty?)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2320">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2321">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2322">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2323">
          
          
          <code class="ruby">  # Get the list of the available git branches.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2324">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2325">
          <span class="hits">1</span>
          
          <code class="ruby">  def branches</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2326">
          
          
          <code class="ruby">    error &quot;Invalid local repo: `#{@local_dir_path}`&quot; unless local_valid_repo?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2327">
          
          
          <code class="ruby">    FileUtils.cd(@local_dir_path) do</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2328">
          
          
          <code class="ruby">      return `git branch`.split(/\W+/).reject(&amp;:empty?)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2329">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2330">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2331">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2332">
          
          
          <code class="ruby">  # Add the changes from the Working Tree to the stage.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2333">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2334">
          <span class="hits">1</span>
          
          <code class="ruby">  def perform_add(files: nil, interactive: false)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2335">
          
          
          <code class="ruby">    error &quot;Invalid files `#{files}`.&quot; unless files.nil? || files.is_a?(Array)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2336">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2337">
          
          
          <code class="ruby">    cmd  = [&quot;git&quot;, &quot;add&quot;]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2338">
          
          
          <code class="ruby">    cmd &lt;&lt; &quot;-i&quot;  if     interactive</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2339">
          
          
          <code class="ruby">    cmd &lt;&lt; &quot;-A&quot;  if     files.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2340">
          
          
          <code class="ruby">    cmd &lt;&lt; files unless files.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2341">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2342">
          
          
          <code class="ruby">    error(&quot;Invalid local repo: `#{@local_dir_path}`&quot;) unless local_valid_repo?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2343">
          
          
          <code class="ruby">    exec_cmd(cmd, as_su: !existing_dir(@local_dir_path), chdir: @local_dir_path)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2344">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2345">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2346">
          
          
          <code class="ruby">  # Commit the changes in the Working Tree.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2347">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2348">
          <span class="hits">1</span>
          
          <code class="ruby">  def perform_commit(message: nil)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2349">
          
          
          <code class="ruby">    status = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2350">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2351">
          
          
          <code class="ruby">    if working_tree_changes?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2352">
          
          
          <code class="ruby">      tell &quot;The configuration has the following local changes:\n&quot; +</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2353">
          
          
          <code class="ruby">           &quot;#{colorize(working_tree_changes, :white)}&quot;, :cyan</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2354">
          
          
          <code class="ruby">      if quiz &quot;Do you want to commit them all&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2355">
          
          
          <code class="ruby">        status &amp;&amp;= perform_add # Add from Working Tree to stage.</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2356">
          
          
          <code class="ruby">        if status</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2357">
          
          
          <code class="ruby">          tell(&quot;Performing commit&quot;, :blue)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2358">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2359">
          
          
          <code class="ruby">          message ||= quiz(&quot;Type the commit message&quot;, type: :string)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2360">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2361">
          
          
          <code class="ruby">          cmd  = [&quot;git&quot;, &quot;commit&quot;, &quot;-a&quot;]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2362">
          
          
          <code class="ruby">          cmd &lt;&lt; &quot;--allow-empty-message&quot; if     message.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2363">
          
          
          <code class="ruby">          cmd += [&quot;-m&quot;, message]         unless message.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2364">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2365">
          
          
          <code class="ruby">          error &quot;Invalid local repo: `#{@local_dir_path}`&quot; unless local_valid_repo?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2366">
          
          
          <code class="ruby">          status &amp;&amp;= exec_cmd(cmd,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2367">
          
          
          <code class="ruby">                              as_su: !existing_dir(@local_dir_path),</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2368">
          
          
          <code class="ruby">                              chdir: @local_dir_path)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2369">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2370">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2371">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2372">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2373">
          
          
          <code class="ruby">    status</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2374">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2375">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2376">
          <span class="hits">1</span>
          
          <code class="ruby">  def perform_fetch(remote: nil, branch: nil)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2377">
          
          
          <code class="ruby">    error(&quot;Invalid remote `#{remote}`.&quot;) if remote &amp;&amp; !remotes.include?(remote)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2378">
          
          
          <code class="ruby">    error(&quot;Invalid branch `#{branch}`.&quot;) if branch &amp;&amp; !branches.include?(branch)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2379">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2380">
          
          
          <code class="ruby">    tell(&quot;Fetching information from remote&quot;, :blue)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2381">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2382">
          
          
          <code class="ruby">    cmd  = [&quot;git&quot;, &quot;fetch&quot;]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2383">
          
          
          <code class="ruby">    cmd &lt;&lt; remote.shell_escape unless remote.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2384">
          
          
          <code class="ruby">    cmd &lt;&lt; branch.shell_escape unless branch.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2385">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2386">
          
          
          <code class="ruby">    error(&quot;Invalid local repo: `#{@local_dir_path}`&quot;) unless local_valid_repo?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2387">
          
          
          <code class="ruby">    exec_cmd(cmd, as_su: !existing_dir(@local_dir_path), chdir: @local_dir_path)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2388">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2389">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2390">
          <span class="hits">1</span>
          
          <code class="ruby">  def perform_clone(recursive: true)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2391">
          
          
          <code class="ruby">    tell(&quot;Syncing from remote repository: `#{@remote_normalized_url}`&quot;, :blue)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2392">
          
          
          <code class="ruby">    error(&quot;Invalid url: can&#39;t be empty.&quot;) if @remote_normalized_url.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2393">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2394">
          
          
          <code class="ruby">    parent_dir = @local_dir_path.dirname</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2395">
          
          
          <code class="ruby">    name       = @local_dir_path.basename</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2396">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2397">
          
          
          <code class="ruby">    cmd  = [&quot;git&quot;, &quot;clone&quot;]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2398">
          
          
          <code class="ruby">    cmd &lt;&lt; &quot;--recursive&quot; if recursive</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2399">
          
          
          <code class="ruby">    cmd &lt;&lt; @remote_normalized_url.shell_escape</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2400">
          
          
          <code class="ruby">    cmd &lt;&lt; name.shell_escape</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2401">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2402">
          
          
          <code class="ruby">    exec_cmd(cmd, as_su: !existing_dir(parent_dir), chdir: parent_dir)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2403">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2404">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2405">
          
          
          <code class="ruby">  # Pull from the provided `remote` in the provided `branch`.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2406">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2407">
          <span class="hits">1</span>
          
          <code class="ruby">  def perform_pull(remote: nil, branch: nil, with_submodules: true)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2408">
          
          
          <code class="ruby">    error(&quot;Invalid remote `#{remote}`&quot;) if remote &amp;&amp; !remotes.include?(remote)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2409">
          
          
          <code class="ruby">    error(&quot;Invalid branch `#{branch}`&quot;) if branch &amp;&amp; !branches.include?(branch)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2410">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2411">
          
          
          <code class="ruby">    status = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2412">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2413">
          
          
          <code class="ruby">    if should_pull?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2414">
          
          
          <code class="ruby">      tell(&quot;Performing pull&quot;, :blue)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2415">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2416">
          
          
          <code class="ruby">      cmd  = [&quot;git&quot;, &quot;pull&quot;]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2417">
          
          
          <code class="ruby">      cmd &lt;&lt; remote.shell_escape unless remote.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2418">
          
          
          <code class="ruby">      cmd &lt;&lt; branch.shell_escape unless branch.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2419">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2420">
          
          
          <code class="ruby">      error(&quot;Invalid local repo: `#{@local_dir_path}`&quot;) unless local_valid_repo?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2421">
          
          
          <code class="ruby">      status = exec_cmd(cmd,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2422">
          
          
          <code class="ruby">                        as_su: !existing_dir(@local_dir_path),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2423">
          
          
          <code class="ruby">                        chdir: @local_dir_path)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2424">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2425">
          
          
          <code class="ruby">      if with_submodules</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2426">
          
          
          <code class="ruby">        status &amp;&amp;= exec_cmd(%w(git submodule update --recursive),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2427">
          
          
          <code class="ruby">                            as_su: !existing_dir(@local_dir_path),</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2428">
          
          
          <code class="ruby">                            chdir: @local_dir_path)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2429">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2430">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2431">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2432">
          
          
          <code class="ruby">    status</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2433">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2434">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2435">
          
          
          <code class="ruby">  # Push to the provided `remote` in the provided `branch`.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2436">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2437">
          <span class="hits">1</span>
          
          <code class="ruby">  def perform_push(remote: nil, branch: nil)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2438">
          
          
          <code class="ruby">    error(&quot;Invalid remote `#{remote}`&quot;) if remote &amp;&amp; !remotes.include?(remote)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2439">
          
          
          <code class="ruby">    error(&quot;Invalid branch `#{branch}`&quot;) if branch &amp;&amp; !branches.include?(branch)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2440">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2441">
          
          
          <code class="ruby">    status = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2442">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2443">
          
          
          <code class="ruby">    if should_push?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2444">
          
          
          <code class="ruby">      tell(&quot;Pushing to remote&quot;, :blue)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2445">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2446">
          
          
          <code class="ruby">      cmd  = [&quot;git&quot;, &quot;push&quot;]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2447">
          
          
          <code class="ruby">      cmd &lt;&lt; remote.shell_escape unless remote.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2448">
          
          
          <code class="ruby">      cmd &lt;&lt; branch.shell_escape unless branch.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2449">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2450">
          
          
          <code class="ruby">      error(&quot;Invalid local repo: `#{@local_dir_path}`&quot;) unless local_valid_repo?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2451">
          
          
          <code class="ruby">      status &amp;&amp;= exec_cmd(cmd,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2452">
          
          
          <code class="ruby">                          as_su: !existing_dir(@local_dir_path),</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2453">
          
          
          <code class="ruby">                          chdir: @local_dir_path)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2454">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2455">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2456">
          
          
          <code class="ruby">    status</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2457">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2458">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2459">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2460">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2461">
          
          
          <code class="ruby"># ────────────────────────────────────────────────── Lastpass ← Filters ← Lib ──</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2462">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2463">
          
          
          <code class="ruby">Fizzy::Vars::Filters.define(:lpass, description: &quot;&quot;&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2464">
          
          
          <code class="ruby">LastPass filter allows to retrieve informations stored in a lastpass account</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2465">
          
          
          <code class="ruby">As arguments you can pass:</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2466">
          
          
          <code class="ruby">- #0: A unique name or identifier of the element to be retrieved.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2467">
          
          
          <code class="ruby">- #1 [optional]: What information should be retrieved from the element.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2468">
          
          
          <code class="ruby">                 Defaults to the element&#39;s password.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2469">
          <span class="hits">1</span>
          
          <code class="ruby">&quot;&quot;&quot;) do |args|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2470">
          
          
          <code class="ruby">  args = args.split_by_separator</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2471">
          
          
          <code class="ruby">  name = args[0].shell_escape</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2472">
          
          
          <code class="ruby">  what = args[1] || :password</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2473">
          
          
          <code class="ruby">  what = &quot;--#{what}&quot; unless what.to_s.start_with?(&quot;--&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2474">
          
          
          <code class="ruby">  `lpass show --color=never #{what} #{name}`</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2475">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2476">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2477">
          
          
          <code class="ruby"># ─────────────────────────────────────────────────────────── Base ← Commands ──</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2478">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2479">
          
          
          <code class="ruby"># Base class for all fizzy commands.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2480">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2481">
          <span class="hits">1</span>
          
          <code class="ruby">class Fizzy::BaseCommand &lt; Thor</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2482">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2483">
          <span class="hits">1</span>
          
          <code class="ruby">  include Thor::Actions</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2484">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2485">
          <span class="hits">1</span>
          
          <code class="ruby">  include Fizzy::Environment</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2486">
          <span class="hits">1</span>
          
          <code class="ruby">  include Fizzy::Execution</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2487">
          <span class="hits">1</span>
          
          <code class="ruby">  include Fizzy::Filesystem</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2488">
          <span class="hits">1</span>
          
          <code class="ruby">  include Fizzy::IO</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2489">
          <span class="hits">1</span>
          
          <code class="ruby">  include Fizzy::Vars</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2490">
          <span class="hits">1</span>
          
          <code class="ruby">  include Fizzy::Locals</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2491">
          <span class="hits">1</span>
          
          <code class="ruby">  include Fizzy::MetaInfo</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2492">
          <span class="hits">1</span>
          
          <code class="ruby">  include Fizzy::MetaElements</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2493">
          <span class="hits">1</span>
          
          <code class="ruby">  include Fizzy::MetaCommands</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2494">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2495">
          
          
          <code class="ruby">  # Common options, shared by many commands.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2496">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2497">
          <span class="hits">1</span>
          
          <code class="ruby">  SHARED_OPTIONS = {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2498">
          
          
          <code class="ruby">    verbose: {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2499">
          
          
          <code class="ruby">      default: false,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2500">
          
          
          <code class="ruby">      type:    :boolean,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2501">
          
          
          <code class="ruby">      aliases: :v,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2502">
          
          
          <code class="ruby">      desc:    &quot;Whether the output should be verbose.&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2503">
          
          
          <code class="ruby">    },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2504">
          
          
          <code class="ruby">    run_mode: {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2505">
          
          
          <code class="ruby">      default: &quot;normal&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2506">
          
          
          <code class="ruby">      aliases: :R,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2507">
          
          
          <code class="ruby">      enum:    %w(normal paranoid dry),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2508">
          
          
          <code class="ruby">      desc:    &quot;Ask confirmation for each filesystem operation.&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2509">
          
          
          <code class="ruby">    },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2510">
          
          
          <code class="ruby">    fizzy_dir: {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2511">
          
          
          <code class="ruby">      default: Fizzy::CFG.default_fizzy_dir,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2512">
          
          
          <code class="ruby">      aliases: :F,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2513">
          
          
          <code class="ruby">      desc:    &quot;The root path for the directory internally used by fizzy.&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2514">
          
          
          <code class="ruby">    },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2515">
          
          
          <code class="ruby">    cfg_url: {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2516">
          
          
          <code class="ruby">      default: nil,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2517">
          
          
          <code class="ruby">      aliases: :U,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2518">
          
          
          <code class="ruby">      desc: &quot;The URL to the repository holding config.&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2519">
          
          
          <code class="ruby">    },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2520">
          
          
          <code class="ruby">    cfg_name: {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2521">
          
          
          <code class="ruby">      default: nil,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2522">
          
          
          <code class="ruby">      aliases: :C,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2523">
          
          
          <code class="ruby">      desc:    &quot;The name of the configuration that should be used.&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2524">
          
          
          <code class="ruby">    },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2525">
          
          
          <code class="ruby">    inst_name: {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2526">
          
          
          <code class="ruby">      default: nil,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2527">
          
          
          <code class="ruby">      aliases: :I,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2528">
          
          
          <code class="ruby">      desc:    &quot;The name for the configuration instance to be used.&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2529">
          
          
          <code class="ruby">    },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2530">
          
          
          <code class="ruby">    vars_name: {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2531">
          
          
          <code class="ruby">      default: nil,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2532">
          
          
          <code class="ruby">      aliases: :V,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2533">
          
          
          <code class="ruby">      desc:    &quot;The name for the variables file to be used.&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2534">
          
          
          <code class="ruby">    },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2535">
          
          
          <code class="ruby">    meta_name: {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2536">
          
          
          <code class="ruby">      default: Fizzy::CFG.default_meta_name,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2537">
          
          
          <code class="ruby">      aliases: :M,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2538">
          
          
          <code class="ruby">      desc:    &quot;The name of the meta file.&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2539">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2540">
          
          
          <code class="ruby">  }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2541">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2542">
          <span class="hits">1</span>
          
          <code class="ruby">  class &lt;&lt; self</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2543">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2544">
          <span class="hits">1</span>
          
          <code class="ruby">    include Fizzy::IO</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2545">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2546">
          
          
          <code class="ruby">    # @return a shared option.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2547">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2548">
          <span class="hits">1</span>
          
          <code class="ruby">    def shared_option(name, required: false)</code>
        </li>
      
        <li class="covered" data-hits="31" data-linenumber="2549">
          <span class="hits">31</span>
          
          <code class="ruby">      args = SHARED_OPTIONS[name].dup</code>
        </li>
      
        <li class="covered" data-hits="31" data-linenumber="2550">
          <span class="hits">31</span>
          
          <code class="ruby">      error(&quot;Invalid option `#{name}`: it doesn&#39;t exist.&quot;) if args.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2551">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="31" data-linenumber="2552">
          <span class="hits">31</span>
          
          <code class="ruby">      if required</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="2553">
          <span class="hits">10</span>
          
          <code class="ruby">        args.delete(:default)</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="2554">
          <span class="hits">10</span>
          
          <code class="ruby">        args[:required] = true</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="2555">
          <span class="hits">21</span>
          
          <code class="ruby">      elsif !args.has_key?(:default)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2556">
          
          
          <code class="ruby">        error(&quot;Invalid shared option `#{name}`: doesn&#39;t have a default value.&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2557">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2558">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="31" data-linenumber="2559">
          <span class="hits">31</span>
          
          <code class="ruby">      [name, args]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2560">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2561">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2562">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2563">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2564">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2565">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2566">
          
          
          <code class="ruby"># ──────────────────────────────────────────────────────────── Cfg ← Commands ──</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2567">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2568">
          <span class="hits">1</span>
          
          <code class="ruby">class Fizzy::CfgCommand &lt; Fizzy::BaseCommand</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2569">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2570">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.source_root</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2571">
          
          
          <code class="ruby">    &quot;/&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2572">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2573">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2574">
          <span class="hits">1</span>
          
          <code class="ruby">  method_option(*shared_option(:fizzy_dir))</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2575">
          <span class="hits">1</span>
          
          <code class="ruby">  method_option(*shared_option(:cfg_name,  required: true))</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2576">
          <span class="hits">1</span>
          
          <code class="ruby">  desc(&quot;details&quot;, &quot;Show configuration details.&quot;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2577">
          <span class="hits">1</span>
          
          <code class="ruby">  def details</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2578">
          
          
          <code class="ruby">    # Prepare paths before considering details.</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2579">
          
          
          <code class="ruby">    paths = prepare_storage(options.fizzy_dir,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2580">
          
          
          <code class="ruby">                            valid_meta:   false,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2581">
          
          
          <code class="ruby">                            valid_cfg:    :readonly,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2582">
          
          
          <code class="ruby">                            valid_inst:   false,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2583">
          
          
          <code class="ruby">                            cur_cfg_name: options.cfg_name)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2584">
          
          
          <code class="ruby">    # Print details.</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2585">
          
          
          <code class="ruby">    tell(&quot;Available variable files:&quot;, :cyan)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2586">
          
          
          <code class="ruby">    avail_vars(paths.cur_cfg_vars).each do |path|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2587">
          
          
          <code class="ruby">      name = path.basename(path.extname)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2588">
          
          
          <code class="ruby">      tell(&quot;\t→ #{colorize(name, :magenta)}&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2589">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2590">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2591">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2592">
          <span class="hits">1</span>
          
          <code class="ruby">  method_option(*shared_option(:fizzy_dir))</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2593">
          <span class="hits">1</span>
          
          <code class="ruby">  desc(&quot;cleanup&quot;, &quot;Cleanup the fizzy storage.&quot;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2594">
          <span class="hits">1</span>
          
          <code class="ruby">  def cleanup</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2595">
          
          
          <code class="ruby">    # Prepare paths for cleanup.</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2596">
          
          
          <code class="ruby">    paths = prepare_storage(options.fizzy_dir,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2597">
          
          
          <code class="ruby">                            valid_meta: false,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2598">
          
          
          <code class="ruby">                            valid_cfg:  false,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2599">
          
          
          <code class="ruby">                            valid_inst: false)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2600">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2601">
          
          
          <code class="ruby">    # Perform cleanup.</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2602">
          
          
          <code class="ruby">    status = if quiz(&quot;Remove the fizzy root directory (`#{paths.root}`)&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2603">
          
          
          <code class="ruby">      paths.root.rmtree</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2604">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2605">
          
          
          <code class="ruby">      nil # Cleanup skipped.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2606">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2607">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2608">
          
          
          <code class="ruby">    # Inform user about the cleanup status.</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2609">
          
          
          <code class="ruby">    case status</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2610">
          
          
          <code class="ruby">      when true  then tell(&quot;Successfully cleaned: `#{paths.root}`.&quot;, :green)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2611">
          
          
          <code class="ruby">      when false then error(&quot;Failed to cleanup: `#{paths.root}`.&quot;, :red)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2612">
          
          
          <code class="ruby">      when nil   then warning(&quot;Cleanup skipped.&quot;, ask_continue: false)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2613">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2614">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2615">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2616">
          <span class="hits">1</span>
          
          <code class="ruby">  method_option(*shared_option(:fizzy_dir))</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2617">
          <span class="hits">1</span>
          
          <code class="ruby">  method_option(*shared_option(:cfg_name))</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2618">
          <span class="hits">1</span>
          
          <code class="ruby">  desc(&quot;cd&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2619">
          
          
          <code class="ruby">       &quot;Change directory to the configuration directory &quot; +</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2620">
          
          
          <code class="ruby">       &quot;(useful for extensive filesystem manipulations).&quot;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2621">
          <span class="hits">1</span>
          
          <code class="ruby">  def cd</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2622">
          
          
          <code class="ruby">    # Prepare stuff for changing directory.</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2623">
          
          
          <code class="ruby">    paths = prepare_storage(options.fizzy_dir,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2624">
          
          
          <code class="ruby">                            valid_meta:   false,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2625">
          
          
          <code class="ruby">                            valid_inst:   false,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2626">
          
          
          <code class="ruby">                            valid_cfg:    !options.cfg_name.nil?,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2627">
          
          
          <code class="ruby">                            cur_cfg_name: options.cfg_name)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2628">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2629">
          
          
          <code class="ruby">    # Changing directory.</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2630">
          
          
          <code class="ruby">    dir_path = paths.cur_cfg || paths.cfg</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2631">
          
          
          <code class="ruby">    tell(&quot;Changing directory to: `#{dir_path}`.&quot;, :cyan)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2632">
          
          
          <code class="ruby">    FileUtils.cd(dir_path)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2633">
          
          
          <code class="ruby">    system(get_env!(:SHELL))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2634">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2635">
          
          
          <code class="ruby">    # Inform user about the changing directory status.</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2636">
          
          
          <code class="ruby">    tell(&quot;CD done in: `#{dir_path}`.&quot;, :green)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2637">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2638">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2639">
          <span class="hits">1</span>
          
          <code class="ruby">  method_option(*shared_option(:fizzy_dir))</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2640">
          <span class="hits">1</span>
          
          <code class="ruby">  method_option(*shared_option(:cfg_name))</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2641">
          <span class="hits">1</span>
          
          <code class="ruby">  desc(&quot;edit PATTERN&quot;, &quot;Find the files relative to PATTERN and edit them.&quot;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2642">
          <span class="hits">1</span>
          
          <code class="ruby">  def edit(pattern)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2643">
          
          
          <code class="ruby">    # Prepare stuff for editing.</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2644">
          
          
          <code class="ruby">    paths = prepare_storage(options.fizzy_dir,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2645">
          
          
          <code class="ruby">                            valid_meta:   false,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2646">
          
          
          <code class="ruby">                            valid_inst:   false,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2647">
          
          
          <code class="ruby">                            cur_cfg_name: options.cfg_name)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2648">
          
          
          <code class="ruby">    find_path = (paths.cur_cfg || paths.cfg).join(pattern)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2649">
          
          
          <code class="ruby">    cfg_files = if find_path.exist?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2650">
          
          
          <code class="ruby">      Array[find_path]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2651">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2652">
          
          
          <code class="ruby">      Pathname.glob(&quot;#{find_path}*&quot;, File::FNM_DOTMATCH).to_a</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2653">
          
          
          <code class="ruby">              .select(&amp;:file?)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2654">
          
          
          <code class="ruby">              .reject{|path| path.to_s =~ /\.git/}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2655">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2656">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2657">
          
          
          <code class="ruby">    cfg_files_arg = cfg_files.collect{|path| path.shell_escape}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2658">
          
          
          <code class="ruby">                             .join(&quot; &quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2659">
          
          
          <code class="ruby">                             .strip</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2660">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2661">
          
          
          <code class="ruby">    # Perform edit.</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2662">
          
          
          <code class="ruby">    status = if cfg_files_arg.empty?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2663">
          
          
          <code class="ruby">      warning(&quot;No files matching `#{options.cfg_name}` have been found.&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2664">
          
          
          <code class="ruby">              ask_continue: false)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2665">
          
          
          <code class="ruby">      nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2666">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2667">
          
          
          <code class="ruby">      tell(&quot;Editing configuration file(s): `#{cfg_files_arg}`.&quot;, :cyan)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2668">
          
          
          <code class="ruby">      system(&quot;#{Fizzy::CFG.editor} #{cfg_files_arg}&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2669">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2670">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2671">
          
          
          <code class="ruby">    # Inform user about the editing status.</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2672">
          
          
          <code class="ruby">    case status</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2673">
          
          
          <code class="ruby">      when true  then tell(&quot;Successfully edited: `#{cfg_files_arg}`.&quot;, :green)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2674">
          
          
          <code class="ruby">      when false then error(&quot;Failed to edit: `#{cfg_files_arg}`.&quot;, :red)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2675">
          
          
          <code class="ruby">      when nil   then warning(&quot;Editing skipped.&quot;, ask_continue: false)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2676">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2677">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2678">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2679">
          <span class="hits">1</span>
          
          <code class="ruby">  method_option(*shared_option(:fizzy_dir))</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2680">
          <span class="hits">1</span>
          
          <code class="ruby">  method_option(*shared_option(:cfg_name, required: true))</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2681">
          <span class="hits">1</span>
          
          <code class="ruby">  method_option(*shared_option(:cfg_url))</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2682">
          <span class="hits">1</span>
          
          <code class="ruby">  desc(&quot;sync&quot;, &quot;Synchronize the remote repository with the local one.&quot;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2683">
          <span class="hits">1</span>
          
          <code class="ruby">  def sync</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2684">
          
          
          <code class="ruby">    # Prepare stuff for syncing.</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2685">
          
          
          <code class="ruby">    paths = prepare_storage(options.fizzy_dir,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2686">
          
          
          <code class="ruby">                            valid_meta:   false,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2687">
          
          
          <code class="ruby">                            valid_cfg:    false,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2688">
          
          
          <code class="ruby">                            valid_inst:   false,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2689">
          
          
          <code class="ruby">                            cur_cfg_name: options.cfg_name)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2690">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2691">
          
          
          <code class="ruby">    # Perform sync.</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2692">
          
          
          <code class="ruby">    sync_result = Fizzy::Sync.perform(paths.cur_cfg, options.cfg_url)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2693">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2694">
          
          
          <code class="ruby">    # Inform user about sync status.</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2695">
          
          
          <code class="ruby">    if sync_result</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2696">
          
          
          <code class="ruby">      tell(&quot;Synced to: `#{paths.cur_cfg}`.&quot;, :green)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2697">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2698">
          
          
          <code class="ruby">      error(&quot;Unable to sync.&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2699">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2700">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2701">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2702">
          <span class="hits">1</span>
          
          <code class="ruby">  method_option(*shared_option(:verbose))</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2703">
          <span class="hits">1</span>
          
          <code class="ruby">  method_option(*shared_option(:fizzy_dir))</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2704">
          <span class="hits">1</span>
          
          <code class="ruby">  method_option(*shared_option(:cfg_name,  required: true))</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2705">
          <span class="hits">1</span>
          
          <code class="ruby">  method_option(*shared_option(:inst_name, required: true))</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2706">
          <span class="hits">1</span>
          
          <code class="ruby">  method_option(*shared_option(:vars_name, required: true))</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2707">
          <span class="hits">1</span>
          
          <code class="ruby">  method_option(*shared_option(:meta_name))</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2708">
          <span class="hits">1</span>
          
          <code class="ruby">  desc(&quot;instantiate&quot;, &quot;Create a configuration instance in the current machine.&quot;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2709">
          <span class="hits">1</span>
          
          <code class="ruby">  def instantiate</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2710">
          
          
          <code class="ruby">    # Before instantiation.</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2711">
          
          
          <code class="ruby">    paths = prepare_storage(options.fizzy_dir,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2712">
          
          
          <code class="ruby">                            meta_name:     options.meta_name,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2713">
          
          
          <code class="ruby">                            valid_cfg:     :readonly,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2714">
          
          
          <code class="ruby">                            valid_inst:    false,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2715">
          
          
          <code class="ruby">                            cur_cfg_name:  options.cfg_name,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2716">
          
          
          <code class="ruby">                            cur_inst_name: options.inst_name)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2717">
          
          
          <code class="ruby">    setup_vars(paths.cur_cfg_vars, options.vars_name)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2718">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2719">
          
          
          <code class="ruby">    meta = get_meta(paths.cur_cfg_meta, paths.cur_cfg_vars, paths.cur_cfg,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2720">
          
          
          <code class="ruby">                    options.verbose)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2721">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2722">
          
          
          <code class="ruby">    info(&quot;meta: &quot;, &quot;#{colorize(meta[:elems].count, :green)}/&quot; +</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2723">
          
          
          <code class="ruby">                   &quot;#{meta[:all_elems_count]} elem(s) selected.&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2724">
          
          
          <code class="ruby">    info(&quot;meta: &quot;, &quot;#{colorize(meta[:excluded_files].count, :red)}/&quot; +</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2725">
          
          
          <code class="ruby">                   &quot;#{meta[:all_files_count]} file(s) excluded.&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2726">
          
          
          <code class="ruby">    tell</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2727">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2728">
          
          
          <code class="ruby">    # Create a configuration instance.</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2729">
          
          
          <code class="ruby">    tell(&quot;Creating a configuration instance named `#{options.inst_name}` &quot; +</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2730">
          
          
          <code class="ruby">         &quot;from: `#{paths.cur_cfg}`.&quot;, :blue)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2731">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2732">
          
          
          <code class="ruby">    exclude_pattern = Fizzy::CFG.instantiate_exclude_pattern</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2733">
          
          
          <code class="ruby">    meta[:excluded_files].each do |excluded_file|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2734">
          
          
          <code class="ruby">      exclude_pattern = /#{exclude_pattern}|#{excluded_file}/</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2735">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2736">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2737">
          
          
          <code class="ruby">    begin</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2738">
          
          
          <code class="ruby">      directory(paths.cur_cfg, paths.cur_inst, exclude_pattern: exclude_pattern)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2739">
          
          
          <code class="ruby">    rescue SyntaxError</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2740">
          
          
          <code class="ruby">      error(&quot;Error while processing the template: `#{$fizzy_cur_template}`.&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2741">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2742">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2743">
          
          
          <code class="ruby">    # After instantiation.</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2744">
          
          
          <code class="ruby">    tell(&quot;Created the configuration instance in: `#{paths.cur_inst}`.&quot;, :green)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2745">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2746">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2747">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2748">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2749">
          
          
          <code class="ruby"># ─────────────────────────────────────────────────────────── Inst ← Commands ──</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2750">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2751">
          <span class="hits">1</span>
          
          <code class="ruby">class Fizzy::InstCommand &lt; Fizzy::BaseCommand</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2752">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2753">
          <span class="hits">1</span>
          
          <code class="ruby">  method_option(*shared_option(:fizzy_dir))</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2754">
          <span class="hits">1</span>
          
          <code class="ruby">  method_option(*shared_option(:inst_name))</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2755">
          <span class="hits">1</span>
          
          <code class="ruby">  desc(&quot;cd&quot;, &quot;Change directory to the instance directory &quot; +</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2756">
          
          
          <code class="ruby">             &quot;(useful for extensive filesystem manipulations).&quot;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2757">
          <span class="hits">1</span>
          
          <code class="ruby">  def cd</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2758">
          
          
          <code class="ruby">    # Prepare stuff for changing directory.</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2759">
          
          
          <code class="ruby">    paths = prepare_storage(options.fizzy_dir,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2760">
          
          
          <code class="ruby">                            valid_meta:    false,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2761">
          
          
          <code class="ruby">                            valid_cfg:     false,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2762">
          
          
          <code class="ruby">                            valid_inst:    !options.inst_name.nil?,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2763">
          
          
          <code class="ruby">                            cur_inst_name: options.inst_name)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2764">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2765">
          
          
          <code class="ruby">    # Changing directory.</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2766">
          
          
          <code class="ruby">    dir_path = paths.cur_inst || paths.inst</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2767">
          
          
          <code class="ruby">    tell(&quot;Changing directory to: `#{dir_path}`.&quot;, :cyan)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2768">
          
          
          <code class="ruby">    FileUtils.cd(dir_path)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2769">
          
          
          <code class="ruby">    system get_env!(:SHELL)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2770">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2771">
          
          
          <code class="ruby">    # Inform user about the changing directory status.</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2772">
          
          
          <code class="ruby">    tell(&quot;CD done in: `#{dir_path}`.&quot;, :green)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2773">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2774">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2775">
          <span class="hits">1</span>
          
          <code class="ruby">  method_option(*shared_option(:verbose))</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2776">
          <span class="hits">1</span>
          
          <code class="ruby">  method_option(*shared_option(:run_mode))</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2777">
          <span class="hits">1</span>
          
          <code class="ruby">  method_option(*shared_option(:fizzy_dir))</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2778">
          <span class="hits">1</span>
          
          <code class="ruby">  method_option(*shared_option(:inst_name, required: true))</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2779">
          <span class="hits">1</span>
          
          <code class="ruby">  method_option(*shared_option(:vars_name, required: true))</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2780">
          <span class="hits">1</span>
          
          <code class="ruby">  method_option(*shared_option(:meta_name))</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2781">
          <span class="hits">1</span>
          
          <code class="ruby">  desc(&quot;install&quot;, &quot;Install the current configuration instance in the system.&quot;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2782">
          <span class="hits">1</span>
          
          <code class="ruby">  def install</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2783">
          
          
          <code class="ruby">    # Prepare stuff for performing install.</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2784">
          
          
          <code class="ruby">    @run_mode = options.run_mode.to_sym</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2785">
          
          
          <code class="ruby">    @verbose  = options.verbose</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2786">
          
          
          <code class="ruby">    paths = prepare_storage(options.fizzy_dir,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2787">
          
          
          <code class="ruby">                            valid_cfg:     false,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2788">
          
          
          <code class="ruby">                            meta_name:     options.meta_name,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2789">
          
          
          <code class="ruby">                            cur_inst_name: options.inst_name)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2790">
          
          
          <code class="ruby">    setup_vars(paths.cur_inst_vars, options.vars_name)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2791">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2792">
          
          
          <code class="ruby">    meta = get_meta(paths.cur_inst_meta, paths.cur_inst_vars, paths.cur_inst,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2793">
          
          
          <code class="ruby">                    options.verbose)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2794">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2795">
          
          
          <code class="ruby">    # 1. Install the instance into the system.</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2796">
          
          
          <code class="ruby">    tell(&quot;Installing the configuration instance `#{options.inst_name}` &quot; +</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2797">
          
          
          <code class="ruby">         &quot;into the system.&quot;, :blue)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2798">
          
          
          <code class="ruby">    # 1.1 Install the elements.</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2799">
          
          
          <code class="ruby">    meta[:elems].each do |elem|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2800">
          
          
          <code class="ruby">      tell(&quot;Installing element: `#{elem[:name]}`.&quot;, :cyan)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2801">
          
          
          <code class="ruby">      elements_appliers.each { |applier| applier.call(elem) }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2802">
          
          
          <code class="ruby">      if elem[:notes]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2803">
          
          
          <code class="ruby">        tell(&quot;Notes for `#{elem[:name]}`:&quot;, :yellow)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2804">
          
          
          <code class="ruby">        tell(elem[:notes].split(&quot;\n&quot;).collect { |s| &quot;  #{s}&quot; }.join(&quot;\n&quot;))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2805">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2806">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2807">
          
          
          <code class="ruby">    # 1.2 Install the commands.</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2808">
          
          
          <code class="ruby">    meta[:commands].each do |spec|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2809">
          
          
          <code class="ruby">      tell(&quot;Executing command: `#{spec[:name]}`.&quot;, :cyan)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2810">
          
          
          <code class="ruby">      available_commands[spec[:type]][:executor].call(spec)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2811">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2812">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2813">
          
          
          <code class="ruby">    # Inform the user about installation status.</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2814">
          
          
          <code class="ruby">    tell(&quot;The configuration instance `#{options.inst_name}` has been &quot; +</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2815">
          
          
          <code class="ruby">         &quot;installed into the system&quot;, :green)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2816">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2817">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2818">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2819">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2820">
          
          
          <code class="ruby"># ─────────────────────────────────────────────────────────── Main ← Commands ──</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2821">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2822">
          <span class="hits">1</span>
          
          <code class="ruby">class Fizzy::MainCommand &lt; Fizzy::BaseCommand</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2823">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2824">
          <span class="hits">1</span>
          
          <code class="ruby">  desc(&quot;cfg SUBCOMMAND ...ARGS&quot;, &quot;Manage the fizzy configuration &quot; +</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2825">
          
          
          <code class="ruby">                                 &quot;(without modifying the host system).&quot;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2826">
          <span class="hits">1</span>
          
          <code class="ruby">  subcommand(&quot;cfg&quot;, Fizzy::CfgCommand)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2827">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2828">
          <span class="hits">1</span>
          
          <code class="ruby">  desc(&quot;inst SUBCOMMAND ...ARGS&quot;, &quot;Manage a configuration instance&quot;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2829">
          <span class="hits">1</span>
          
          <code class="ruby">  subcommand(&quot;inst&quot;, Fizzy::InstCommand)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2830">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2831">
          <span class="hits">1</span>
          
          <code class="ruby">  desc(&quot;usage&quot;, &quot;Show how to use fizzy.&quot;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2832">
          <span class="hits">1</span>
          
          <code class="ruby">  def usage</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2833">
          
          
          <code class="ruby">    url = URI.join(Fizzy::CFG.static_files_base_url, &quot;README.md&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2834">
          
          
          <code class="ruby">    res = Net::HTTP.get_response(url)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2835">
          
          
          <code class="ruby">    if res.is_a?(Net::HTTPSuccess)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2836">
          
          
          <code class="ruby">      tell(&quot;\n#{res.body}\n&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2837">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2838">
          
          
          <code class="ruby">      error(&quot;Network error: cannot retrieve `#{url}`.&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2839">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2840">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2841">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2842">
          <span class="hits">1</span>
          
          <code class="ruby">  desc(&quot;version&quot;, &quot;Show fizzy version.&quot;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2843">
          <span class="hits">1</span>
          
          <code class="ruby">  def version</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2844">
          
          
          <code class="ruby">    info &quot;fizzy version&quot;, Fizzy::CFG.version</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2845">
          
          
          <code class="ruby">    info &quot;ruby version&quot;, &quot;ruby #{RUBY_VERSION}p#{RUBY_PATCHLEVEL}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2846">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2847">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2848">
          <span class="hits">1</span>
          
          <code class="ruby">  method_option(*shared_option(:verbose))</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2849">
          <span class="hits">1</span>
          
          <code class="ruby">  method_option(*shared_option(:run_mode))</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2850">
          <span class="hits">1</span>
          
          <code class="ruby">  method_option(*shared_option(:fizzy_dir))</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2851">
          <span class="hits">1</span>
          
          <code class="ruby">  method_option(*shared_option(:cfg_name,  required: true))</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2852">
          <span class="hits">1</span>
          
          <code class="ruby">  method_option(*shared_option(:inst_name, required: true))</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2853">
          <span class="hits">1</span>
          
          <code class="ruby">  method_option(*shared_option(:vars_name, required: true))</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2854">
          <span class="hits">1</span>
          
          <code class="ruby">  method_option(*shared_option(:meta_name))</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2855">
          <span class="hits">1</span>
          
          <code class="ruby">  desc(&quot;quick-install&quot;, &quot;Quickly install a configuration.&quot;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2856">
          <span class="hits">1</span>
          
          <code class="ruby">  def quick_install</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2857">
          
          
          <code class="ruby">    invoke(Fizzy::CfgCommand, &quot;instantiate&quot;, [],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2858">
          
          
          <code class="ruby">           cfg_name:  options.cfg_name,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2859">
          
          
          <code class="ruby">           vars_name: options.vars_name,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2860">
          
          
          <code class="ruby">           inst_name: options.inst_name,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2861">
          
          
          <code class="ruby">           fizzy_dir: options.fizzy_dir,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2862">
          
          
          <code class="ruby">           meta_name: options.meta_name,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2863">
          
          
          <code class="ruby">           verbose:   options.verbose)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2864">
          
          
          <code class="ruby">    invoke(Fizzy::InstCommand, &quot;install&quot;, [],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2865">
          
          
          <code class="ruby">           vars_name: options.vars_name,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2866">
          
          
          <code class="ruby">           inst_name: options.inst_name,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2867">
          
          
          <code class="ruby">           fizzy_dir: options.fizzy_dir,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2868">
          
          
          <code class="ruby">           meta_name: options.meta_name,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2869">
          
          
          <code class="ruby">           run_mode:  options.run_mode,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2870">
          
          
          <code class="ruby">           verbose:   options.verbose)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2871">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2872">
          <span class="hits">1</span>
          
          <code class="ruby">  map :qi =&gt; :quick_install</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2873">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2874">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2875">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2876">
          
          
          <code class="ruby"># ────────────────────────────────────────────────────────────────────── Main ──</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2877">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2878">
          
          
          <code class="ruby"># Entry point.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2879">
          <span class="hits">1</span>
          
          <code class="ruby">Fizzy::MainCommand.start(ARGV) if $0 == __FILE__</code>
        </li>
      
    </ol>
  </pre>
</div>
      
      </div>
    </div>
  </body>
</html>
